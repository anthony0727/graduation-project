cscope 15 $HOME/repo/graduation_portfolio -q 0000000937 0000108271
	@algorithm_handler.hpp

1 #iâdeà
__ALGORITHM_HANDLER_HPP__


2 
	#__ALGORITHM_HANDLER_HPP__


	)

4 
	~<šfÜm©iÚ_hªdËr.hµ
>

6 şas 
	c®gÜ™hm_hªdËr
 {

7 
	mpublic
:

8 
vœtu®
 
	$š™Ÿlize
(
šfÜm©iÚ_hªdËr
 * 
šfÜm©iÚ_±r
) {}

9 
vœtu®
 
	$befÜe_™”©iÚ
(è{
	}
}

10 
vœtu®
 
boŞ
 
	$»que¡_Ãxtchunk
(è{
	}
}

11 
vœtu®
 
	$execu‹_node
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a
 * 
·gem‘a_±r
è{
	}
}

12 
vœtu®
 
	$aá”_™”©iÚ
(è{
	}
}

13 
vœtu®
 
	$fš®ize
(è{
	}
}

	@attribute_handler.hpp

1 #iâdeà
__©Œibu‹_hªdËr_HPP__


2 
	#__©Œibu‹_hªdËr_HPP__


	)

4 
	~<uni¡d.h
>

5 
	~<fú.h
>

6 
	~<©omic
>

7 
	~<veùÜ
>

8 
	~<omp.h
>

9 
	~<şim™s
>

11 
	#BOUNDTYPE_SRC
 
Œue


	)

12 
	#BOUNDTYPE_DST
 
çl£


	)

14 
	#IN
 
Œue


	)

15 
	#OUT
 
çl£


	)

17 
	#OFFSET_BITMAP
 20

	)

18 
	#NUM_VALUES_IN_PAGE
 (
	`size_t
(1è<< 
OFFSET_BITMAP
)

	)

20 
	s©Œibu‹_hªdËr_šfo
 {

21 
	m¡d
::
¡ršg
 
f’ame
;

22 
size_t
 
	msize_v®u‘y³
;

23 
boŞ
 
	mexi¡fe
;

25 
©Œibu‹_hªdËr_šfo
(
¡d
::
¡ršg
 
_f’ame
, 
size_t
 
_size_v®u‘y³
, 
boŞ
 
_exi¡fe
) {

26 
	mf’ame
 = 
_f’ame
;

27 
	msize_v®u‘y³
 = 
_size_v®u‘y³
;

28 
	mexi¡fe
 = 
_exi¡fe
;

32 
	#WORDTYPE
 
size_t


	)

33 
	#WORDTYPP_BYTE
 8

	)

34 
	#WORDRANGE_LOG2
 6

	)

35 
	#WORDFILTER
 63

	)

36 
	#WORDBIT
(
nod’umb”
è(
	`WORDTYPE
(1è<< (Òod’umb”è& 
WORDFILTER
))

	)

38 şas 
	cb™©Œibu‹_hªdËr
 {

39 
	m´iv©e
:

41 
¡d
::
©omic
<
WORDTYPE
> * 
b™¬¿y
;

44 
size_t
 
	msize_¬¿y
;

47 
size_t
 
	mnum_nodes
;

49 
	mpublic
:

50 
	$b™©Œibu‹_hªdËr
(è: 
	$b™¬¿y
(
NULL
) {

53 ~
	$b™©Œibu‹_hªdËr
() {

54 
	}
}

57 
	$ü—‹
(
size_t
 
_num_nodes
) {

58 
size_¬¿y
 = (
_num_nodes
 >> 
WORDRANGE_LOG2
) + 1;

60 
num_nodes
 = 
_num_nodes
;

62 
b™¬¿y
 = 
Ãw
 
¡d
::
©omic
<
WORDTYPE
>[
size_¬¿y
];

64 
	`ş—r
();

65 
	}
}

66 
	$de¡roy
() {

67 
d–‘e
 
b™¬¿y
;

68 
	}
}

71 
	$ş—r
() {

72 
size_t
 
¬¿yšdex
 = 0;‡¼ayšdex < 
size_¬¿y
;‡rrayindex++) {

73 
b™¬¿y
[
¬¿yšdex
] = 0;

75 
	}
}

78 
boŞ
 
	$g‘_b™
(
size_t
 
nod’umb”
) {

79  (
b™¬¿y
[
nod’umb”
 >> 
WORDRANGE_LOG2
] & (
	`WORDTYPE
(1è<< (nod’umb” & 
WORDFILTER
))) != 0;

80 
	}
}

83 
boŞ
 
	$£t_b™
(
size_t
 
nod’umb”
) {

84  (
	`©omic_ãtch_Ü
(&
b™¬¿y
[
nod’umb”
 >> 
WORDRANGE_LOG2
], 
	`WORDBIT
Òod’umb”)è& WORDBITÒod’umb”)è=ğ
	`WORDTYPE
(0);

85 
	}
}

87 
size_t
 
	$g‘_size_¬¿y
() {

88  
size_¬¿y
;

89 
	}
}

92 şas 
	c©Œibu‹_hªdËr
 {

93 
	m´iv©e
:

94 
©Œibu‹_fd
;

95 
	m¡d
::
¡ršg
 
f’ame
;

97 
size_t
 
	msize_v®u‘y³
;

100 
size_t
 
	mnum_nodes
;

101 
size_t
 
	mnum_v®ues
;

102 
size_t
 
	mnum_chunks
;

103 
size_t
 
	mnum_·ges
;

104 
size_t
 
	msize_chunk
;

105 
size_t
 
	msize_Ï¡_chunk
;

107 
size_t
 
	mfœ¡node_id
;

108 
size_t
 
	mÏ¡node_id
;

109 
size_t
 
	mcu¼’t_chunk_id
;

110 
size_t
 
	mÃxt_chunk_id
;

113 
size_t
 
	msize_·ge
;

114 
size_t
 
	msize_Ï¡·ge
;

116 * 
	mdeçuÉ_v®ue
;

117 * 
	m©Œibu‹_±r
;

119 
boŞ
 * 
	m·g–og_±r
;

120 
boŞ
 * 
	m·geæag_±r
;

122 
boŞ
 
	mšmemÜy
;

123 
boŞ
 
	mboundty³
;

124 
boŞ
 
	mexi¡fe
;

125 
boŞ
 
	mwr™efe
;

126 
boŞ
 
	medge_dœeùiÚ
;

127 
	mpublic
:

128 
	$©Œibu‹_hªdËr
(
©Œibu‹_hªdËr_šfo
 
veùÜ_šfo
, 
size_t
 
_num_nodes
, size_ˆ
_num_chunks
, size_ˆ
_num_·ges
, size_ˆ
_num_v®ues
, 
boŞ
 
_edge_dœeùiÚ
) {

130 
f’ame
 = 
veùÜ_šfo
.filename;

133 
size_v®u‘y³
 = 
veùÜ_šfo
.size_valuetype;

136 
num_nodes
 = 
_num_nodes
;

137 
num_chunks
 = 
_num_chunks
;

138 
num_v®ues
 = 
_num_v®ues
;

139 
num_·ges
 = 
_num_·ges
;

140 
size_chunk
 = 
num_v®ues
 * 
size_v®u‘y³
;

141 
size_Ï¡_chunk
 = (
num_nodes
 - (
num_chunks
 - 1è* 
num_v®ues
è* 
size_v®u‘y³
;

143 
fœ¡node_id
 = 0;

144 
Ï¡node_id
 = 
num_v®ues
 - 1;

145 
cu¼’t_chunk_id
 = 
num_chunks
 == 1 ? 0 :‚um_chunks;

148 
size_·ge
 = 
NUM_VALUES_IN_PAGE
 * 
size_v®u‘y³
;

149 
size_Ï¡·ge
 = (
num_nodes
 - (
num_·ges
 - 1è* 
NUM_VALUES_IN_PAGE
è* 
size_v®u‘y³
;

151 
deçuÉ_v®ue
 = 
NULL
;

152 
©Œibu‹_±r
 = 
NULL
;

154 
·g–og_±r
 = 
NULL
;

155 
·geæag_±r
 = 
NULL
;

158 
šmemÜy
 = 
num_chunks
 =ğ1 ? 
Œue
 : 
çl£
;

159 
exi¡fe
 = 
veùÜ_šfo
.existfile;

160 
wr™efe
 = 
çl£
;

161 
edge_dœeùiÚ
 = 
_edge_dœeùiÚ
;

164 ~
	$©Œibu‹_hªdËr
() {

165 
	}
}

167 
	$£t
(
boŞ
 * 
_·geæag_±r
) {

169 
©Œibu‹_±r
 = (*)
	`m®loc
(
size_chunk
);

170 
·g–og_±r
 = (
boŞ
 *)
	`m®loc
(
num_·ges
);

171 
	`mem£t
(
·g–og_±r
, 
çl£
, 
num_·ges
);

173 ià(
exi¡fe
) {

174 
©Œibu‹_fd
 = 
	`İ’
(
f’ame
.
	`c_¡r
(), 
O_RDWR
);

176 ià(
šmemÜy
) {

177 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(
dyÇmic
, 1)

178 
size_t
 
·gešdex
 = 0;…agešdex < 
num_·ges
;…ageindex++) {

179 
	`´—d
(
©Œibu‹_fd
, 
©Œibu‹_±r
 + 
·gešdex
 * 
size_·ge
, size_page,…ageindex * size_page);

182 
	`şo£
(
©Œibu‹_fd
);

186 ià(
šmemÜy
) {

187 ià(
deçuÉ_v®ue
 !ğ
NULL
) {

188 #´agm¨
omp
 
·¿Î–
 

189 * 
v®ue_±r
 = 
©Œibu‹_±r
; v®ue_±¸<‡‰ribu‹_±¸+ 
size_chunk
; v®ue_±¸+ğ
size_v®u‘y³
) {

190 
	`memıy
(
v®ue_±r
, 
deçuÉ_v®ue
, 
size_v®u‘y³
);

195 
©Œibu‹_fd
 = 
	`İ’
(
f’ame
.
	`c_¡r
(), 
O_RDWR
 | 
O_CREAT
 | 
O_TRUNC
);

196 
	`árunÿ‹
(
©Œibu‹_fd
, 
num_nodes
 * 
size_v®u‘y³
);

198 ià(
deçuÉ_v®ue
 !ğ
NULL
 && !
wr™efe
) {

199 * 
v®ue_±r
 = 
©Œibu‹_±r
; v®ue_±¸<‡‰ribu‹_±¸+ 
size_·ge
; v®ue_±¸+ğ
size_v®u‘y³
) {

200 
	`memıy
(
v®ue_±r
, 
deçuÉ_v®ue
, 
size_v®u‘y³
);

203 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(
dyÇmic
, 1)

204 
size_t
 
·ge_id
 = 0;…age_id < 
num_·ges
;…age_id++) {

205 
	`pwr™e
(
©Œibu‹_fd
, 
©Œibu‹_±r
, (
·ge_id
 + 1 !ğ
num_·ges
è? 
size_·ge
 : 
size_Ï¡·ge
,…age_id * size_page);

211 
·geæag_±r
 = 
_·geæag_±r
;

212 
	}
}

214 
	$un£t
() {

215 ià(!
šmemÜy
) {

216 
	`şo£
(
©Œibu‹_fd
);

219 
	`ä“
(
©Œibu‹_±r
);

220 
	`ä“
(
·g–og_±r
);

221 ià(
deçuÉ_v®ue
 !ğ
NULL
è
	`ä“
(default_value);

222 
	}
}

224 
	$»que¡_chunk
(
size_t
 
chunk_id
) {

225 
Ãxt_chunk_id
 = 
chunk_id
;

226 
	}
}

228 
	$exchªge_chunk
() {

229 ià(
šmemÜy
) ;

230 ià(
cu¼’t_chunk_id
 =ğ
Ãxt_chunk_id
) ;

232 ià(
	`is_chunkid_v®id
(
cu¼’t_chunk_id
)) {

233 ià(
wr™efe
è
	`wr™e_chunk
(
cu¼’t_chunk_id
);

236 ià(
	`is_chunkid_v®id
(
Ãxt_chunk_id
)) {

237 
	`»ad_chunk
(
Ãxt_chunk_id
);

239 
	}
}

241 
	$»ad_chunk
(
size_t
 
chunk_id
) {

242 ià(
šmemÜy
) ;

244 
fœ¡node_id
 = 
chunk_id
 * 
num_v®ues
;

245 
Ï¡node_id
 = (
chunk_id
 + 1 =ğ
num_chunks
è? (
num_nodes
 - 1è: (
fœ¡node_id
 + 
num_v®ues
 - 1);

246 
cu¼’t_chunk_id
 = 
chunk_id
;

248 
size_t
 
åage_id
 = 
fœ¡node_id
 >> 
OFFSET_BITMAP
;

249 
size_t
 
Íage_id
 = 
Ï¡node_id
 >> 
OFFSET_BITMAP
;

250 
size_t
 
fe_off£t
 = 
chunk_id
 * 
size_chunk
;

252 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(
dyÇmic
, 1)

253 
size_t
 
·ge_id
 = 
åage_id
;…age_id <ğ
Íage_id
;…age_id++) {

254 ià(
edge_dœeùiÚ
 =ğ
boundty³
 || 
·geæag_±r
[
·ge_id
] =ğ
Œue
) {

255 ià(
deçuÉ_v®ue
 =ğ
NULL
 || 
·g–og_±r
[
·ge_id
] =ğ
Œue
) {

256 
	`´—d
(
©Œibu‹_fd
, 
©Œibu‹_±r
 + (
·ge_id
 - 
åage_id
è* 
size_·ge
, (·ge_id + 1 !ğ
num_·ges
è? size_·g: 
size_Ï¡·ge
, 
fe_off£t
 + (page_id - fpage_id) * size_page);

259 * 
v®ue_±r
 = 
©Œibu‹_±r
 + (
·ge_id
 - 
åage_id
è* 
size_·ge
;

260 * 
v®ue_±r_’d
 = 
v®ue_±r
 + ((
·ge_id
 + 1 !ğ
num_·ges
è? 
size_·ge
 : 
size_Ï¡·ge
);

261 
v®ue_±r
 < 
v®ue_±r_’d
) {

262 
	`memıy
(
v®ue_±r
, 
deçuÉ_v®ue
, 
size_v®u‘y³
);

263 
v®ue_±r
 +ğ
size_v®u‘y³
;

267 
·g–og_±r
[
·ge_id
] = 
Œue
;

270 
	}
}

272 
	$wr™e_chunk
(
size_t
 
chunk_id
) {

273 
size_t
 
åage_id
 = 
fœ¡node_id
 >> 
OFFSET_BITMAP
;

274 
size_t
 
Íage_id
 = 
Ï¡node_id
 >> 
OFFSET_BITMAP
;

275 
size_t
 
fe_off£t
 = 
chunk_id
 * 
size_chunk
;

277 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(
dyÇmic
, 1)

278 
size_t
 
·ge_id
 = 
åage_id
;…age_id <ğ
Íage_id
;…age_id++) {

279 ià(
edge_dœeùiÚ
 =ğ
boundty³
 || 
·geæag_±r
[
·ge_id
] =ğ
Œue
) {

280 
	`pwr™e
(
©Œibu‹_fd
, 
©Œibu‹_±r
 + (
·ge_id
 - 
åage_id
è* 
size_·ge
, (·ge_id + 1 !ğ
num_·ges
è? size_·g: 
size_Ï¡·ge
, 
fe_off£t
 + (page_id - fpage_id) * size_page);

283 
	}
}

285 
	$æush_chunk
() {

286 ià(
	`is_chunkid_v®id
(
cu¼’t_chunk_id
)) {

287 ià(
wr™efe
è
	`wr™e_chunk
(
cu¼’t_chunk_id
);

290 
fœ¡node_id
 = 0;

291 
Ï¡node_id
 = 
num_v®ues
 - 1;

292 
cu¼’t_chunk_id
 = 
num_chunks
;

293 
	}
}

295 
boŞ
 
	$is_chunkid_v®id
(
size_t
 
chunk_id
) {

296  (0 <ğ
chunk_id
 && chunk_id < 
num_chunks
);

297 
	}
}

299 
boŞ
 
	$is_lßd_Ãeded
(
size_t
 
low”_·geid
, size_ˆ
uµ”_·geid
) {

300 ià(!
	`is_chunkid_v®id
(
Ãxt_chunk_id
)è 
çl£
;

301 ià(
edge_dœeùiÚ
 =ğ
boundty³
è 
Œue
;

303 
size_t
 
åage_id
 = (
Ãxt_chunk_id
 * 
num_v®ues
è>> 
OFFSET_BITMAP
;

304 
size_t
 
Íage_id
 = ((
Ãxt_chunk_id
 + 1 =ğ
num_chunks
è? (
num_nodes
 - 1è: (
fœ¡node_id
 + 
num_v®ues
 - 1)è>> 
OFFSET_BITMAP
;

306 ià(
åage_id
 > 
uµ”_·geid
 || 
Íage_id
 < 
low”_·geid
è 
çl£
;

308  
Œue
;

309 
	}
}

315 
size_t
 
	$g‘_fœ¡node_numb”
() {

316  
fœ¡node_id
;

317 
	}
}

319 
size_t
 
	$g‘_Ï¡node_numb”
() {

320  
Ï¡node_id
;

321 
	}
}

323 
boŞ
 
	$is_šmemÜy
() {

324  
šmemÜy
;

325 
	}
}

327 
	$£t_boundty³
(
boŞ
 
_boundty³
) {

328 
boundty³
 = 
_boundty³
;

329 
	}
}

331 
boŞ
 
	$g‘_boundty³
() {

332  
boundty³
;

333 
	}
}

335 
	$£t_wr™efe
(
boŞ
 
_wr™efe
) {

336 
wr™efe
 = 
_wr™efe
;

337 
	}
}

339 
size_t
 
	$g‘_chunk_id
() {

340  
cu¼’t_chunk_id
;

341 
	}
}

347 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

348 
	$g‘_fœ¡20
(
v®u‘y³
 * 
tİli¡
) {

349 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

350 
max20ths
 = 
Ï¡node_id
 - 
fœ¡node_id
 + 1;

351 ià(
max20ths
 > 20) max20ths = 20;

352 
i
 = 0; i < 
max20ths
; i++) {

353 *(
tİli¡
 + 
i
èğ
v®ue_±r
[i];

355 
	}
}

357 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

358 
	$sÜt_chunk
() {

359 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

360 
¡d
::
	`sÜt
(
v®ue_±r
, v®ue_±¸+ (
Ï¡node_id
 - 
fœ¡node_id
 + 1), std::
g»©”
<
v®u‘y³
>());

361 
	}
}

363 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

364 
	$š™Ÿlize_¡¬Šode
(
size_t
 
¡¬Šode
, 
v®u‘y³
 
v®ue
) {

365 ià(
šmemÜy
) {

366 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

367 
v®ue_±r
[
¡¬Šode
] = 
v®ue
;

370 
	`pwr™e
(
©Œibu‹_fd
, &
v®ue
, 
size_v®u‘y³
, 
¡¬Šode
 * size_valuetype);

372 
	}
}

374 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

375 
	$£t_deçuÉ_v®ue
(
v®u‘y³
 
v®ue
) {

376 
v®u‘y³
 * 
v®ue_±r
;

377 ià(
deçuÉ_v®ue
 =ğ
NULL
èdeçuÉ_v®uğ(*)
	`m®loc
(
size_v®u‘y³
);

378 
v®ue_±r
 = (
v®u‘y³
 *)
deçuÉ_v®ue
;

379 *
v®ue_±r
 = 
v®ue
;

381 ià(
šmemÜy
) {

382 ià(
©Œibu‹_±r
 !ğ
NULL
) {

383 
v®ue_±r
 = (
v®u‘y³
 *)
©Œibu‹_±r
;

385 #´agm¨
omp
 
·¿Î–
 

386 
size_t
 
v®ue_id
 = 0; v®ue_id < 
num_v®ues
; value_id++) {

387 
v®ue_±r
[
v®ue_id
] = 
v®ue
;

392 ià(
·g–og_±r
 !ğ
NULL
è
	`mem£t
Õag–og_±r, 
çl£
, 
num_·ges
);

394 
	}
}

396 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

397 
v®u‘y³
 
	$g‘_v®ue
(
size_t
 
nod’umb”
) {

398 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

399  
v®ue_±r
[
nod’umb”
 - 
fœ¡node_id
];

400 
	}
}

402 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

403 
	$£t_v®ue
(
size_t
 
nod’umb”
, 
v®u‘y³
 
v®ue
) {

404 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

405 
v®ue_±r
[
nod’umb”
 - 
fœ¡node_id
] = 
v®ue
;

406 
	}
}

408 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

409 
	$add_v®ue
(
size_t
 
nod’umb”
, 
v®u‘y³
 
v®ue
) {

410 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

411 
v®ue_±r
[
nod’umb”
 - 
fœ¡node_id
] +ğ
v®ue
;

412 
	}
}

414 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

415 
	$sub_v®ue
(
size_t
 
nod’umb”
, 
v®u‘y³
 
v®ue
) {

416 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

417 
v®ue_±r
[
nod’umb”
 - 
fœ¡node_id
] -ğ
v®ue
;

418 
	}
}

420 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

421 
	$lock_£t_uÆock_v®ue
(
size_t
 
nod’umb”
, 
v®u‘y³
 
v®ue
, 
¡d
::
©omic_æag
 * 
lock
) {

422 
lock
->
	`‹¡_ªd_£t
());

423 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

424 
v®ue_±r
[
nod’umb”
 - 
fœ¡node_id
] = 
v®ue
;

425 
lock
->
	`ş—r
();

426 
	}
}

428 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

429 
	$lock_add_uÆock_v®ue
(
size_t
 
nod’umb”
, 
v®u‘y³
 
v®ue
, 
¡d
::
©omic_æag
 * 
lock
) {

430 
lock
->
	`‹¡_ªd_£t
());

431 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

432 
v®ue_±r
[
nod’umb”
 - 
fœ¡node_id
] +ğ
v®ue
;

433 
lock
->
	`ş—r
();

434 
	}
}

436 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

437 
	$lock_sub_uÆock_v®ue
(
size_t
 
nod’umb”
, 
v®u‘y³
 
v®ue
, 
¡d
::
©omic_æag
 * 
lock
) {

438 
lock
->
	`‹¡_ªd_£t
());

439 
v®u‘y³
 * 
v®ue_±r
 = (v®u‘y³ *)
©Œibu‹_±r
;

440 
v®ue_±r
[
nod’umb”
 - 
fœ¡node_id
] -ğ
v®ue
;

441 
lock
->
	`ş—r
();

442 
	}
}

444 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

445 
	$lock_v®ue
(
¡d
::
©omic_æag
 * 
lock
) {

446 
lock
->
	`‹¡_ªd_£t
());

447 
	}
}

449 
	g‹m¶©e
<
ty³Çme
 
	gv®u‘y³
>

450 
	$uÆock_v®ue
(
¡d
::
©omic_æag
 * 
lock
) {

451 
lock
->
	`ş—r
();

452 
	}
}

454 
	$»ad_chunks
(
size_t
 
chunk_id
) {

455 ià(
šmemÜy
) ;

457 
fœ¡node_id
 = 
chunk_id
 * 
num_v®ues
;

458 
Ï¡node_id
 = (
chunk_id
 + 1 =ğ
num_chunks
è? (
num_nodes
 - 1è: (
fœ¡node_id
 + 
num_v®ues
 - 1);

459 
cu¼’t_chunk_id
 = 
chunk_id
;

461 
size_t
 
åage_id
 = 
fœ¡node_id
 >> 
OFFSET_BITMAP
;

462 
size_t
 
Íage_id
 = 
Ï¡node_id
 >> 
OFFSET_BITMAP
;

463 
size_t
 
fe_off£t
 = 
chunk_id
 * 
size_chunk
;

465 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(
dyÇmic
, 1)

466 
size_t
 
·ge_id
 = 
åage_id
;…age_id <ğ
Íage_id
;…age_id++) {

467 
	`´—d
(
©Œibu‹_fd
, 
©Œibu‹_±r
 + (
·ge_id
 - 
åage_id
è* 
size_·ge
, size_·ge, 
fe_off£t
 + (page_id - fpage_id) * size_page);

469 
	}
}

472 şas 
	c©Œibu‹_w¿µ”
 {

473 
	m´iv©e
:

474 
size_t
 
max_memÜy_mb
;

475 
size_t
 
	mnum_nodes
;

476 
size_t
 
	mnum_v®ues
;

477 
size_t
 
	mnum_chunks
;

478 
size_t
 
	mnum_·ges
;

480 
	m¡d
::
veùÜ
<
©Œibu‹_hªdËr
 *> 
veùÜs
;

481 
	m¡d
::
veùÜ
<
b™©Œibu‹_hªdËr
 *> 
b™veùÜs
;

482 
	m¡d
::
veùÜ
<
©Œibu‹_hªdËr_šfo
> 
veùÜ_šfos
;

484 
size_t
 
	msize_tÙ®_v®u‘y³
;

486 
size_t
 
	m¤c_low”bound
;

487 
size_t
 
	m¤c_uµ”bound
;

488 
size_t
 
	md¡_low”bound
;

489 
size_t
 
	md¡_uµ”bound
;

491 
boŞ
 * 
	m·geæag_±r
;

493 
size_t
 
	mlow”_·geid
;

494 
size_t
 
	muµ”_·geid
;

496 
boŞ
 
	medge_dœeùiÚ
;

497 
boŞ
 
	mšmemÜy
;

498 
	mpublic
:

499 
	$©Œibu‹_w¿µ”
() {

502 ~
	$©Œibu‹_w¿µ”
() {

503 
	}
}

505 
	$£t_w¿µ”
(
size_t
 
_max_memÜy_mb
, size_ˆ
_num_nodes
, 
boŞ
 
_edge_dœeùiÚ
) {

506 
šmemÜy
 = 
Œue
;

507 
edge_dœeùiÚ
 = 
_edge_dœeùiÚ
;

509 
max_memÜy_mb
 = 
_max_memÜy_mb
;

510 
num_nodes
 = 
_num_nodes
;

512 
size_tÙ®_v®u‘y³
 = 0;

513 
	}
}

515 
	$un£t_w¿µ”
() {

516 
size_t
 
i
 = 0; i < 
veùÜs
.
	`size
(); i++) {

517 
veùÜs
[
i
]->
	`un£t
();

520 
size_t
 
i
 = 0; i < 
b™veùÜs
.
	`size
(); i++) {

521 
b™veùÜs
[
i
]->
	`de¡roy
();

524 ià(!
šmemÜy
è
	`ä“
(
·geæag_±r
);

525 
veùÜs
.
	`ş—r
();

526 
b™veùÜs
.
	`ş—r
();

527 
	}
}

533 
©Œibu‹_hªdËr
 * 
	$g‘_veùÜ
(
size_t
 
veùÜ_šdex
) {

534  
veùÜs
[
veùÜ_šdex
];

535 
	}
}

537 
	$£t_veùÜ
(
¡d
::
¡ršg
 
f’ame
, 
size_t
 
size_v®u‘y³
, 
boŞ
 
exi¡fe
) {

538 
veùÜ_šfos
.
	`push_back
(
	`©Œibu‹_hªdËr_šfo
(
f’ame
, 
size_v®u‘y³
, 
exi¡fe
));

540 
size_tÙ®_v®u‘y³
 +ğ
size_v®u‘y³
;

541 
	}
}

544 
	$bud_veùÜs
(
size_t
 * 
num_max_chunk
) {

545 
num_v®ues
 = (((
max_memÜy_mb
 * 1024 * 1024 / 
size_tÙ®_v®u‘y³
è>> 
OFFSET_BITMAP
) + 1) << OFFSET_BITMAP;

546 
num_v®ues
 =‚um_v®ue >ğ
num_nodes
 ?‚um_nodes :‚um_values;

548 
num_chunks
 = (
num_nodes
 - 1è/ 
num_v®ues
 + 1;

549 
šmemÜy
 = 
num_chunks
 =ğ1 ? 
Œue
 : 
çl£
;

551 *
num_max_chunk
 = 
num_chunks
;

553 
num_·ges
 = (
num_nodes
 >> 
OFFSET_BITMAP
) + 1;

555 
size_t
 
veùÜ_šdex
 = 0; veùÜ_šdex < 
veùÜ_šfos
.
	`size
(); vector_index++) {

556 
veùÜs
.
	`push_back
(
Ãw
 
	`©Œibu‹_hªdËr
(
veùÜ_šfos
[
veùÜ_šdex
], 
num_nodes
, 
num_chunks
, 
num_·ges
, 
num_v®ues
, 
edge_dœeùiÚ
));

558 
	}
}

561 
	$š™Ÿlize_veùÜs
() {

562 
·geæag_±r
 = (
boŞ
 *)
	`m®loc
(
num_·ges
);

563 
	`mem£t
(
·geæag_±r
, 
çl£
, 
num_·ges
);

564 
low”_·geid
 = 
num_·ges
;

565 
uµ”_·geid
 = -1;

567 
size_t
 
veùÜ_šdex
 = 0; veùÜ_šdex < 
veùÜ_šfos
.
	`size
(); vector_index++) {

568 
veùÜs
[
veùÜ_šdex
]->
	`£t
(
·geæag_±r
);

570 
	}
}

572 
b™©Œibu‹_hªdËr
 * 
	$g‘_b™veùÜ
(
size_t
 
veùÜ_šdex
) {

573  
b™veùÜs
[
veùÜ_šdex
];

574 
	}
}

576 
	$bud_b™veùÜ
() {

577 
b™©Œibu‹_hªdËr
 * 
b™¬¿y_±r
 = 
Ãw
 
	`b™©Œibu‹_hªdËr
();

578 
b™¬¿y_±r
->
	`ü—‹
(
num_nodes
);

580 
b™veùÜs
.
	`push_back
(
b™¬¿y_±r
);

582 
max_memÜy_mb
 -ğ
num_nodes
 / 8 / 1024 / 1024 + 1;

583 
	}
}

589 
	$£t_·geæag
(
size_t
 
fœ¡_nodeid
, size_ˆ
Ï¡_nodeid
) {

590 ià(
šmemÜy
) ;

592 
size_t
 
åage_id
 = 
fœ¡_nodeid
 >> 
OFFSET_BITMAP
;

593 
size_t
 
Íage_id
 = 
Ï¡_nodeid
 >> 
OFFSET_BITMAP
;

595 
size_t
 
šdex_·geæag
 = 
åage_id
; index_·geæag <ğ
Íage_id
; index_pageflag++) {

596 
·geæag_±r
[
šdex_·geæag
] = 
Œue
;

599 ià(
low”_·geid
 > 
åage_id
)†ower_pageid = fpage_id;

600 ià(
uµ”_·geid
 < 
Íage_id
) upper_pageid =†page_id;

601 
	}
}

603 
boŞ
 
	$is_lßd_Ãeded
() {

604 
size_t
 
veùÜ_šdex
 = 0; veùÜ_šdex < 
veùÜs
.
	`size
(); vector_index++) {

605 ià(
veùÜs
[
veùÜ_šdex
]->
	`is_lßd_Ãeded
(
low”_·geid
, 
uµ”_·geid
è=ğ
çl£
)  false;

608  
Œue
;

609 
	}
}

612 
	$exchªge_chunks
() {

613 
size_t
 
veùÜ_šdex
 = 0; veùÜ_šdex < 
veùÜs
.
	`size
(); vector_index++) {

614 
veùÜs
[
veùÜ_šdex
]->
	`exchªge_chunk
();

617 
¤c_low”bound
 = 0;

618 
¤c_uµ”bound
 = 
num_nodes
;

619 
d¡_low”bound
 = 0;

620 
d¡_uµ”bound
 = 
num_nodes
;

622 
size_t
 
veùÜ_šdex
 = 0; veùÜ_šdex < 
veùÜs
.
	`size
(); vector_index++) {

623 
©Œibu‹_hªdËr
 * 
©Œibu‹_±r
 = 
veùÜs
[
veùÜ_šdex
];

624 
size_t
 
low”
 = 
©Œibu‹_±r
->
	`g‘_fœ¡node_numb”
();

625 
size_t
 
uµ”
 = 
©Œibu‹_±r
->
	`g‘_Ï¡node_numb”
();

627 ià(
©Œibu‹_±r
->
	`g‘_boundty³
(è=ğ
BOUNDTYPE_SRC
) {

628 
¤c_low”bound
 = src_low”bound < 
low”
 ?†ower : src_lowerbound;

629 
¤c_uµ”bound
 = src_uµ”bound > 
uµ”
 ? upper : src_upperbound;

632 
d¡_low”bound
 = d¡_low”bound < 
low”
 ?†ower : dst_lowerbound;

633 
d¡_uµ”bound
 = d¡_uµ”bound > 
uµ”
 ? upper : dst_upperbound;

636 
	}
}

639 
	$æush_chunks
() {

640 
size_t
 
veùÜ_šdex
 = 0; veùÜ_šdex < 
veùÜs
.
	`size
(); vector_index++) {

641 ià(!
veùÜs
[
veùÜ_šdex
]->
	`is_šmemÜy
()) {

642 
veùÜs
[
veùÜ_šdex
]->
	`æush_chunk
();

646 
	`mem£t
(
·geæag_±r
, 
çl£
, 
num_·ges
);

647 
low”_·geid
 = 
num_·ges
;

648 
uµ”_·geid
 = -1;

649 
	}
}

655 
boŞ
 
	$is_šmemÜy
() {

656  
šmemÜy
;

657 
	}
}

659 
size_t
 
	$g‘_¤c_low”bound
() {

660  
¤c_low”bound
;

661 
	}
}

663 
size_t
 
	$g‘_¤c_uµ”bound
() {

664  
¤c_uµ”bound
;

665 
	}
}

667 
size_t
 
	$g‘_d¡_low”bound
() {

668  
d¡_low”bound
;

669 
	}
}

671 
size_t
 
	$g‘_d¡_uµ”bound
() {

672  
d¡_uµ”bound
;

673 
	}
}

	@bitarray_handler.hpp

1 #iâdeà
__BITARRAY_HANDLER_HPP__


2 
	#__BITARRAY_HANDLER_HPP__


	)

4 
	~<©omic
>

6 
	#WORDTYPE
 
size_t


	)

7 
	#WORDTYPP_BYTE
 8

	)

8 
	#WORDRANGE_LOG2
 6

	)

9 
	#WORDFILTER
 63

	)

10 
	#WORDBIT
(
nod’umb”
è(
	`WORDTYPE
(1è<< (Òod’umb”è& 
WORDFILTER
))

	)

12 şas 
	cb™¬¿y_hªdËr
 {

13 
	m´iv©e
:

15 
¡d
::
©omic
<
WORDTYPE
> ** 
cu¼_hšdiÿtÜ
;

16 
	m¡d
::
©omic
<
WORDTYPE
> ** 
Ãxt_hšdiÿtÜ
;

18 
	m¡d
::
©omic
<
WORDTYPE
> * 
cu¼_hšdiÿtÜs
;

19 
	m¡d
::
©omic
<
WORDTYPE
> * 
Ãxt_hšdiÿtÜs
;

21 
size_t
 
	msize_Ëv–
;

22 
size_t
 
	msize_·¹™iÚ_š_log2
;

24 
size_t
 
	mnum_nodes
;

26 
	mpublic
:

27 
	$b™¬¿y_hªdËr
(è: 
	`cu¼_hšdiÿtÜ
(
NULL
), 
	`Ãxt_hšdiÿtÜ
(NULL), 
	`cu¼_hšdiÿtÜs
(NULL), 
	`Ãxt_hšdiÿtÜs
(NULL), 
	`size_Ëv–
(1), 
	`size_·¹™iÚ_š_log2
(0), 
	$num_nodes
(0) {

30 ~
	$b™¬¿y_hªdËr
() {

31 
	}
}

34 
	$ü—‹
(
size_t
 
_size_·¹™iÚ_š_log2
, size_ˆ
_num_nodes
) {

35 
size_·¹™iÚ_š_log2
 = 
_size_·¹™iÚ_š_log2
;

36 
num_nodes
 = 
_num_nodes
;

38 ià(
size_·¹™iÚ_š_log2
 == 0) {

39 
size_Ëv–
 = 1;

42 
size_t
 
num_b™s
 = 
num_nodes
;‚um_b™ > 64;‚um_b™ ğÒum_b™ >> 
size_·¹™iÚ_š_log2
è+ 1, 
size_Ëv–
++);

45 
size_t
 
shiá
 = 
WORDRANGE_LOG2
;

46 
size_t
 
size_¬¿y
 = 0;

48 
size_t
 
Ëv–
 = 0;†ev– < 
size_Ëv–
;†evel++) {

49 
size_¬¿y
 +ğ(
num_nodes
 >> 
shiá
) + 1;

50 
shiá
 +ğ
size_·¹™iÚ_š_log2
;

53 
	`´štf
("hšdiÿtÜ…¬t™iÚ %lu†ev– %lu\n", 
size_·¹™iÚ_š_log2
, 
size_Ëv–
);

55 
cu¼_hšdiÿtÜ
 = 
Ãw
 
¡d
::
©omic
<
WORDTYPE
>*[
size_Ëv–
];

56 
Ãxt_hšdiÿtÜ
 = 
Ãw
 
¡d
::
©omic
<
WORDTYPE
>*[
size_Ëv–
];

58 
cu¼_hšdiÿtÜs
 = 
Ãw
 
¡d
::
©omic
<
WORDTYPE
>[
size_¬¿y
];

59 
Ãxt_hšdiÿtÜs
 = 
Ãw
 
¡d
::
©omic
<
WORDTYPE
>[
size_¬¿y
];

61 
	`mem£t
(
cu¼_hšdiÿtÜs
, 0, (
¡d
::
©omic
<
WORDTYPE
>è* 
size_¬¿y
);

62 
	`mem£t
(
Ãxt_hšdiÿtÜs
, 0, (
¡d
::
©omic
<
WORDTYPE
>è* 
size_¬¿y
);

64 
shiá
 = 
WORDRANGE_LOG2
;

65 
size_¬¿y
 = 0;

66 
size_t
 
Ëv–
 = 0;†ev– < 
size_Ëv–
;†evel++) {

67 
cu¼_hšdiÿtÜ
[
Ëv–
] = &
cu¼_hšdiÿtÜs
[
size_¬¿y
];

68 
Ãxt_hšdiÿtÜ
[
Ëv–
] = &
Ãxt_hšdiÿtÜs
[
size_¬¿y
];

70 
size_¬¿y
 +ğ(
num_nodes
 >> 
shiá
) + 1;

71 
shiá
 +ğ
size_·¹™iÚ_š_log2
;

73 
	}
}

74 
	$de¡roy
() {

75 
d–‘e
 
cu¼_hšdiÿtÜs
;

76 
d–‘e
 
Ãxt_hšdiÿtÜs
;

78 
d–‘e
 
cu¼_hšdiÿtÜ
;

79 
d–‘e
 
Ãxt_hšdiÿtÜ
;

80 
	}
}

82 
	$»£t_low”Ëv–
(
size_t
 
¬¿yšdex_fœ¡
, size_ˆ
¬¿yšdex_Ï¡
, size_ˆ
shiá
, size_ˆ
Ëv–
) {

83 ià(
¬¿yšdex_Ï¡
 > (
num_nodes
 >> 
shiá
))‡rrayindex_last = (num_nodes >> shift);

85 
size_t
 
šdex
 = 
¬¿yšdex_fœ¡
; index <ğ
¬¿yšdex_Ï¡
; index++) {

86 ià(
Ãxt_hšdiÿtÜ
[
Ëv–
][
šdex
] != 0) {

87 
Ãxt_hšdiÿtÜ
[
Ëv–
][
šdex
] = 0;

89 ià(
Ëv–
 > 0è
	`»£t_low”Ëv–
(
šdex
 << 
size_·¹™iÚ_š_log2
, ((šdex + 1è<< size_·¹™iÚ_š_log2è- 1, 
shiá
 - size_partition_in_log2,†evel - 1);

92 
	}
}

95 
	$exchªge
() {

96 
¡d
::
©omic
<
size_t
> ** 
‹mp
 = 
cu¼_hšdiÿtÜ
;

97 
cu¼_hšdiÿtÜ
 = 
Ãxt_hšdiÿtÜ
;

98 
Ãxt_hšdiÿtÜ
 = 
‹mp
;

100 
size_t
 
shiá
 = (
size_Ëv–
 - 1è* 
size_·¹™iÚ_š_log2
 + 
WORDRANGE_LOG2
;

101 
size_t
 
size_¬¿y
 = (
num_nodes
 >> 
shiá
);

103 
	`»£t_low”Ëv–
(0, 
size_¬¿y
, 
shiá
, 
size_Ëv–
 - 1);

104 
	}
}

107 
boŞ
 
	$g‘_cu¼_b™
(
size_t
 
nod’umb”
) {

108  (
cu¼_hšdiÿtÜ
[0][
nod’umb”
 >> 
WORDRANGE_LOG2
] & 
	`WORDBIT
(nodenumber)) != 0;

109 
	}
}

110 
boŞ
 
	$g‘_Ãxt_b™
(
size_t
 
nod’umb”
) {

111  (
Ãxt_hšdiÿtÜ
[0][
nod’umb”
 >> 
WORDRANGE_LOG2
] & 
	`WORDBIT
(nodenumber)) != 0;

112 
	}
}

114 
boŞ
 
	$check_low”Ëv–
(
size_t
 
fœ¡_nod’umb”
, size_ˆ
Ï¡_nod’umb”
, size_ˆ
shiá
, size_ˆ
Ëv–
) {

115 
size_t
 
¬¿yšdex_off£t
 = 
shiá
 - 
WORDRANGE_LOG2
;

116 
size_t
 
¬¿yšdex_fœ¡
 = 
fœ¡_nod’umb”
 >> 
shiá
;

117 
size_t
 
¬¿yšdex_Ï¡
 = 
Ï¡_nod’umb”
 >> 
shiá
;

119 
size_t
 
šdex
 = 
¬¿yšdex_fœ¡
 + 1; index < 
¬¿yšdex_Ï¡
; index++) {

120 ià(
cu¼_hšdiÿtÜ
[
Ëv–
][
šdex
]) {

121  
Œue
;

125 
size_t
 
fœ¡_uµ”mask
 = ~(
	`WORDBIT
(
fœ¡_nod’umb”
 >> 
¬¿yšdex_off£t
) - 1);

126 
size_t
 
Ï¡_low”mask
 = ((
	`WORDBIT
(
Ï¡_nod’umb”
 >> 
¬¿yšdex_off£t
) - 1) << 1) + 1;

128 ià(
Ëv–
 != 0) {

129 ià((
fœ¡_nod’umb”
 >> 
¬¿yšdex_off£t
è=ğ(
Ï¡_nod’umb”
 >>‡rrayindex_offset)) {

130 ià((
cu¼_hšdiÿtÜ
[
Ëv–
][
¬¿yšdex_Ï¡
] & ((
Ï¡_low”mask
 >> 1) + 1)) != 0)

131 ià(
	`check_low”Ëv–
(
fœ¡_nod’umb”
, 
Ï¡_nod’umb”
, 
shiá
 - 
size_·¹™iÚ_š_log2
, 
Ëv–
 - 1è=ğ
Œue
) rue;

134 ià(
¬¿yšdex_fœ¡
 =ğ
¬¿yšdex_Ï¡
) {

135 ià((
cu¼_hšdiÿtÜ
[
Ëv–
][
¬¿yšdex_fœ¡
] & ((
fœ¡_uµ”mask
 & (fœ¡_uµ”mask - 1)è& (
Ï¡_low”mask
 >> 1))è!ğ0è 
Œue
;

138 ià(((
cu¼_hšdiÿtÜ
[
Ëv–
][
¬¿yšdex_fœ¡
] & (
fœ¡_uµ”mask
 << 1)è| (cu¼_hšdiÿtÜ[Ëv–][
¬¿yšdex_Ï¡
] & (
Ï¡_low”mask
 >> 1))è!ğ0è 
Œue
;

141 ià((
cu¼_hšdiÿtÜ
[
Ëv–
][
¬¿yšdex_fœ¡
] & (
	`WORDTYPE
(1è<< 
	`__butš_ùzÎ
(
fœ¡_uµ”mask
))) != 0)

142 ià(
	`check_low”Ëv–
(
fœ¡_nod’umb”
, (((fœ¡_nod’umb” >> 
¬¿yšdex_off£t
è+ 1è<<‡¼ayšdex_off£tè- 1, 
shiá
 - 
size_·¹™iÚ_š_log2
, 
Ëv–
 - 1è=ğ
Œue
) rue;

143 ià((
cu¼_hšdiÿtÜ
[
Ëv–
][
¬¿yšdex_Ï¡
] & ((
Ï¡_low”mask
 >> 1) + 1)) != 0)

144 ià(
	`check_low”Ëv–
((
Ï¡_nod’umb”
 >> 
¬¿yšdex_off£t
è<<‡¼ayšdex_off£t,†a¡_nod’umb”, 
shiá
 - 
size_·¹™iÚ_š_log2
, 
Ëv–
 - 1è=ğ
Œue
) rue;

148 ià(
¬¿yšdex_fœ¡
 =ğ
¬¿yšdex_Ï¡
) {

149 ià((
cu¼_hšdiÿtÜ
[0][
¬¿yšdex_fœ¡
] & (
fœ¡_uµ”mask
 & 
Ï¡_low”mask
)è!ğ0è 
Œue
;

152 ià(((
cu¼_hšdiÿtÜ
[0][
¬¿yšdex_fœ¡
] & 
fœ¡_uµ”mask
è| (cu¼_hšdiÿtÜ[0][
¬¿yšdex_Ï¡
] & 
Ï¡_low”mask
)è!ğ0è 
Œue
;

156  
çl£
;

157 
	}
}

160 
boŞ
 
	$g‘_cu¼_b™s
(
size_t
 
fœ¡_nod’umb”
, size_ˆ
Ï¡_nod’umb”
) {

161  
	`check_low”Ëv–
(
fœ¡_nod’umb”
, 
Ï¡_nod’umb”
, (
size_Ëv–
 - 1è* 
size_·¹™iÚ_š_log2
 + 
WORDRANGE_LOG2
, size_level - 1);

162 
	}
}

165 
	$£t_cu¼_b™
(
size_t
 
nod’umb”
) {

166 
size_t
 
Ëv–
 = 0;†ev– < 
size_Ëv–
;†evel++) {

167 ià((
	`©omic_ãtch_Ü
(&
cu¼_hšdiÿtÜ
[
Ëv–
][
nod’umb”
 >> 
WORDRANGE_LOG2
], 
	`WORDBIT
Òod’umb”)è& WORDBITÒod’umb”)è!ğ
	`WORDTYPE
(0)) ;

169 
nod’umb”
 >>ğ
size_·¹™iÚ_š_log2
;

171 
	}
}

172 
	$£t_Ãxt_b™
(
size_t
 
nod’umb”
) {

173 
size_t
 
Ëv–
 = 0;†ev– < 
size_Ëv–
;†evel++) {

174 ià((
Ãxt_hšdiÿtÜ
[
Ëv–
][
nod’umb”
 >> 
WORDRANGE_LOG2
] & 
	`WORDBIT
Òod’umb”)è=ğ
	`WORDTYPE
(0)) {

175 ià((
	`©omic_ãtch_Ü
(&
Ãxt_hšdiÿtÜ
[
Ëv–
][
nod’umb”
 >> 
WORDRANGE_LOG2
], 
	`WORDBIT
Òod’umb”)è& WORDBITÒod’umb”)è!ğ
	`WORDTYPE
(0)) ;

178 
nod’umb”
 >>ğ
size_·¹™iÚ_š_log2
;

180 
	}
}

182 
size_t
 
	$g‘_cu¼_wÜd
(
size_t
 
¬¿yšdex
) {

183  
cu¼_hšdiÿtÜ
[0][
¬¿yšdex
];

184 
	}
}

187 
	$£t_®l_cu¼
() {

188 
size_t
 
Ëv–
 = 0;†ev– < 
size_Ëv–
;†evel++) {

189 
size_t
 
size_¬¿y
 = (
num_nodes
 >> (
size_Ëv–
 * 
size_·¹™iÚ_š_log2
 + 
WORDRANGE_LOG2
)) + 1;

191 
size_t
 
¬¿yšdex
 = 0;‡¼ayšdex < 
size_¬¿y
;‡rrayindex++) {

192 
cu¼_hšdiÿtÜ
[
Ëv–
][
¬¿yšdex
] = 
	`WORDTYPE
(-1);

195 
	}
}

196 
	$£t_®l_Ãxt
() {

197 
size_t
 
Ëv–
 = 0;†ev– < 
size_Ëv–
;†evel++) {

198 
size_t
 
size_¬¿y
 = (
num_nodes
 >> (
size_Ëv–
 * 
size_·¹™iÚ_š_log2
 + 
WORDRANGE_LOG2
)) + 1;

200 
size_t
 
¬¿yšdex
 = 0;‡¼ayšdex < 
size_¬¿y
;‡rrayindex++) {

201 
Ãxt_hšdiÿtÜ
[
Ëv–
][
¬¿yšdex
] = 
	`WORDTYPE
(-1);

204 
	}
}

	@engine.hpp

1 
	~<b™¬¿y_hªdËr.hµ
>

2 
	~<šdex_hªdËr.hµ
>

3 
	~<wiss_hªdËr.hµ
>

4 
	~<®gÜ™hm_hªdËr.hµ
>

5 
	~<tim”_hªdËr.hµ
>

6 
	~<©Œibu‹_hªdËr.hµ
>

8 
	~<th»ad
>

9 
	~<omp.h
>

11 
	~<boo¡/th»ad.hµ
>

12 
	~<boo¡/asio.hµ
>

13 
	~<boo¡/bšd.hµ
>

15 
	~<s¡»am
>

17 
	#IN
 
Œue


	)

18 
	#OUT
 
çl£


	)

22 
	#MASK
 1048575

	)

25 #ifdeà
ANALYSIS_STATIC_HINDICATOR


26 
	#ANALYSIS_STATIC_BASIC


	)

27 
	#ANALYSIS_STATIC_MAIN_BASIC


	)

28 
	#ANALYSIS_STATIC_MAIN_HTIME


	)

33 #ifdeà
ANALYSIS_STATIC_WORKLOAD


34 
	#ANALYSIS_STATIC_BASIC


	)

35 
	#ANALYSIS_STATIC_MAIN_BASIC


	)

36 
	#ANALYSIS_STATIC_MAIN_TIME


	)

37 
	#ANALYSIS_STATIC_WORKER_BASIC


	)

38 
	#ANALYSIS_STATIC_WORKER_COUNT


	)

39 
	#ANALYSIS_STATIC_WORKER_TIME


	)

42 #ifdeà
ANALYSIS_STATIC_BASIC


43 
	#NUM_NODES
 0

	)

44 
	#NUM_EDGES
 1

	)

45 
	#NUM_IOS
 2

	)

47 
	#TIME_PROC
 0

	)

48 
	#TIME_IO
 1

	)

49 
	#TIME_ALLOC
 2

	)

51 
	#TIME_SCAN
 0

	)

52 
	#TIME_RESET
 1

	)

55 
num_maxbufs
;

58 şas 
	c’gše
 {

59 
	m´iv©e
:

60 
šdex_hªdËr
 
šdex
;

61 
b™¬¿y_hªdËr
 
	mb™¬¿y
;

62 
wiss_hªdËr
 
	mwiss
;

63 
šfÜm©iÚ_hªdËr
 
	mšfÜm©iÚ
;

64 
tim”_hªdËr
 
	mtim”
;

65 
	m®gÜ™hm_hªdËr
 &
	m®gÜ™hm
;

66 
	m·¿m‘”_hªdËr
 &
	m·¿m‘”
;

67 
©Œibu‹_w¿µ”
 
	m©Œibu‹
;

69 
boŞ
 * 
	mÃeded_·g–i¡
;

70 
	m¡d
::
veùÜ
<> 
lßded_·g–i¡
;

71 
	m¡d
::
veùÜ
<> 
uÆßded_·g–i¡
;

73 
	m¡d
::
©omic
<> 
num_unfšished_sks
;

75 
	mboo¡
::
asio
::
io_£rviû
 io_service;

76 
	mboo¡
::
asio
::
io_£rviû
::
wÜk
 work;

77 
	mboo¡
::
th»ad_group
 
th»ads
;

79 
	m¡d
::
¡ršg
 
vŞum’ame
;

80 
	m¡d
::
¡ršg
 
f’ame
;

81 
	m¡d
::
¡ršg
 
d©ªame
;

83 
	mcur_™”©iÚ
;

84 
	mmax_™”©iÚ
;

86 
	mnum_th»ads
;

88 
size_t
 
	mmemÜy_tÙ®_mb
;

89 
size_t
 
	mmemÜy_bufãr_mb
;

90 
size_t
 
	mmemÜy_veùÜ_mb
;

92 
size_t
 
	mhšdiÿtÜ_·¹™iÚ
;

94 
boŞ
 
	m£t_´•roûss
;

95 
boŞ
 
	m£t_’gš”un
;

96 
boŞ
 
	m£t_b™¬¿y
;

97 
boŞ
 
	medge_dœeùiÚ
;

99 
size_t
 
	md¡_low”bound
;

100 
size_t
 
	md¡_uµ”bound
;

101 
size_t
 
	m¤c_low”bound
;

102 
size_t
 
	m¤c_uµ”bound
;

104 #ifdeà
ANALYSIS_STATIC_BASIC


105 
size_t
 ** 
	mcouÁ”
;

106 
size_t
 * 
	mcouÁ”_
;

107 ** 
	m¡İw©ch
;

108 * 
	m¡İw©ch_
;

109 
boŞ
 * 
	mth»aded
;

112 #ifdeà
ANALYSIS_STATIC_MAIN_BASIC


113 
size_t
 
	mmaš_th»ad_id
;

116 
	mpublic
:

117 
	$’gše
(
®gÜ™hm_hªdËr
 & 
_®gÜ™hm
, 
·¿m‘”_hªdËr
 & 
_·¿m‘”
è: 
	`wÜk
(
io_£rviû
), 
	`®gÜ™hm
(_®gÜ™hm), 
	$·¿m‘”
(
_·¿m‘”
) {

119 
	`£t_basic_·¿m‘”s
();

121 
num_unfšished_sks
 = 0;

123 
	`omp_£t_num_th»ads
(
num_th»ads
);

125 
i
 = 0; i < 
num_th»ads
; ++i)

127 
th»ads
.
	`ü—‹_th»ad
(
boo¡
::
	`bšd
(&boo¡::
asio
::
io_£rviû
::
run
, &io_service));

130 #ifdeà
ANALYSIS_STATIC_BASIC


131 
couÁ”
 = 
Ãw
 
size_t
*[(
MASK
 + 1)];

132 
couÁ”_
 = 
Ãw
 
size_t
[(
MASK
 + 1) * 3];

133 
¡İw©ch
 = 
Ãw
 *[(
MASK
 + 1)];

134 
¡İw©ch_
 = 
Ãw
 [(
MASK
 + 1) * 3];

136 
i
 = 0; i < (
MASK
 + 1); i++) {

137 
couÁ”
[
i
] = &
couÁ”_
[3 * i];

138 
¡İw©ch
[
i
] = &
¡İw©ch_
[3 * i];

141 
th»aded
 = 
Ãw
 
boŞ
[(
MASK
 + 1)];

143 
	`mem£t
(
couÁ”_
, 0, (
size_t
è* (
MASK
 + 1) * 3);

144 
	`mem£t
(
¡İw©ch_
, 0, (è* (
MASK
 + 1) * 3);

145 
	`mem£t
(
th»aded
, 
çl£
, (
boŞ
è* (
MASK
 + 1));

150 ~
	$’gše
() {

151 
io_£rviû
.
	`¡İ
();

153 
th»ads
.
	`još_®l
();

155 
tim”
.
	`´št_tim–i¡
();

157 #ifdeà
ANALYSIS_STATIC_BASIC


158 
d–‘e
 
couÁ”_
;

159 
d–‘e
 
couÁ”
;

160 
d–‘e
 
¡İw©ch_
;

161 
d–‘e
 
¡İw©ch
;

162 
d–‘e
 
th»aded
;

165 
	}
}

170 
	$£t_basic_·¿m‘”s
() {

171 
vŞum’ame
 = 
·¿m‘”
.
	`g‘_·¿m_¡ršg
("volume", "hp0a");

172 
f’ame
 = 
·¿m‘”
.
	`g‘_·¿m_¡ršg
("file", "livejournalrel");

173 
d©ªame
 = 
·¿m‘”
.
	`g‘_·¿m_¡ršg
("data", "livejournal_.txt");

175 
£t_´•roûss
 = 
·¿m‘”
.
	`g‘_·¿m_št
("´•roûss", 0è=ğ1 ? 
Œue
 : 
çl£
;

176 
£t_’gš”un
 = 
·¿m‘”
.
	`g‘_·¿m_št
("’gš”un", 1è=ğ1 ? 
Œue
 : 
çl£
;

177 
£t_b™¬¿y
 = 
·¿m‘”
.
	`g‘_·¿m_št
("b™¬¿y", 1è=ğ1 ? 
Œue
 : 
çl£
;

178 
edge_dœeùiÚ
 = 
·¿m‘”
.
	`g‘_·¿m_¡ršg
("edgeway", "š"è=ğ"š" ? 
IN
 : 
OUT
;

180 
max_™”©iÚ
 = 
·¿m‘”
.
	`g‘_·¿m_št
("max™”s", 
£t_b™¬¿y
 ? 
INT_MAX
 : 20);

182 
num_th»ads
 = 
·¿m‘”
.
	`g‘_·¿m_št
("th»ads", 
boo¡
::
th»ad
::
	`h¬dw¬e_cÚcu¼’cy
());

184 
memÜy_tÙ®_mb
 = (
size_t
)
·¿m‘”
.
	`g‘_·¿m_št
("memoryuse_mb", 1024);

185 
memÜy_veùÜ_mb
 = 
memÜy_tÙ®_mb
 / 5;

186 
memÜy_bufãr_mb
 = 
memÜy_tÙ®_mb
 * 4 / 5;

188 
hšdiÿtÜ_·¹™iÚ
 = 
·¿m‘”
.
	`g‘_·¿m_št
("hindicator_partition", 10);

190 
num_maxbufs
 = 
memÜy_bufãr_mb
;

191 
	}
}

193 
	$ü—‹_basic_compÚ’ts
() {

195 
šdex
.
	`lßd_g¿phšdex
(
f’ame
);

198 ià(
£t_b™¬¿y
) {

199 ià(
šdex
.
	`g‘_num_nodes
(è< (
	`size_t
(1è<< 
hšdiÿtÜ_·¹™iÚ
)) {

200 
šdex
.
	`uÆßd_g¿phšdex
();

201 
	`ex™
(1);

204 
b™¬¿y
.
	`ü—‹
(
hšdiÿtÜ_·¹™iÚ
, 
šdex
.
	`g‘_num_nodes
());

206 
num_maxbufs
 -ğ(2 * (
šdex
.
	`g‘_num_nodes
(è* (1.0 + 1.0 / (
	`pow
(2, 
hšdiÿtÜ_·¹™iÚ
) - 1))) / 8 / 1048576);

208 
Ãeded_·g–i¡
 = 
Ãw
 
boŞ
[
šdex
.
	`g‘_size_šdex
()];

212 
wiss
.
	`š™Ÿlize_wiss
();

213 
wiss
.
	`mouÁ_vŞume
(
vŞum’ame
);

214 
wiss
.
	`İ’_fe
(
f’ame
);

216 
©Œibu‹
.
	`£t_w¿µ”
(
memÜy_veùÜ_mb
, 
šdex
.
	`g‘_num_nodes
(), 
edge_dœeùiÚ
);

217 
	}
}

219 
	$de¡roy_basic_compÚ’ts
() {

220 
©Œibu‹
.
	`un£t_w¿µ”
();

223 
wiss
.
	`şo£_fe
();

224 
wiss
.
	`dismouÁ_vŞume
();

225 
wiss
.
	`fš®ize_wiss
();

228 ià(
£t_b™¬¿y
) {

229 
b™¬¿y
.
	`de¡roy
();

231 
d–‘e
 
Ãeded_·g–i¡
;

235 
šdex
.
	`uÆßd_g¿phšdex
();

236 
	}
}

240 
	$run
() {

242 #ifdeà
ANALYSIS_STATIC_MAIN_BASIC


243 
¡d
::
¡ršg¡»am
 
ss
;

244 
ss
 << 
¡d
::
this_th»ad
::
	`g‘_id
();

245 
ss
 >> 
maš_th»ad_id
;

247 
maš_th»ad_id
 = maš_th»ad_id & 
MASK
;

249 ià(
th»aded
[
maš_th»ad_id
] =ğ
çl£
èth»aded[maš_th»ad_id] = 
Œue
;

253 ià(
£t_´•roûss
) {

254 
time_’Œy
 
	`
("preprocess");

255 

.
	`¡¬t_time
();

256 
wiss
.
	`š™Ÿlize_wiss
();

257 
wiss
.
	`´•roûssšg
(
vŞum’ame
, 
f’ame
, 
d©ªame
);

258 
wiss
.
	`fš®ize_wiss
();

259 

.
	`¡İ_time
();

260 
tim”
.
	`add_’Œy
(

);

264 ià(!
£t_’gš”un
) ;

267 
time_’Œy
 
	`t
("runtime");

268 
t
.
	`¡¬t_time
();

271 
	`ü—‹_basic_compÚ’ts
();

274 
šfÜm©iÚ
.
num_nodes
 = 
šdex
.
	`g‘_num_nodes
();

275 
šfÜm©iÚ
.
num_th»ads
 =‚um_threads;

276 
šfÜm©iÚ
.
max_™”©iÚ
 = max_iteration;

277 
šfÜm©iÚ
.
b™¬¿y_±r
 = &
b™¬¿y
;

278 
šfÜm©iÚ
.
·¿m‘”_±r
 = &
·¿m‘”
;

279 
šfÜm©iÚ
.
©Œibu‹_±r
 = &
©Œibu‹
;

280 
šfÜm©iÚ
.
wiss_±r
 = &
wiss
;

281 
šfÜm©iÚ
.
šdex_±r
 = &
šdex
;

284 
®gÜ™hm
.
	`š™Ÿlize
(&
šfÜm©iÚ
);

286 
cur_™”©iÚ
 = 0; cur_™”©iÚ < 
max_™”©iÚ
; cur_iteration++) {

287 
šfÜm©iÚ
.
cur_™”©iÚ
 = cur_iteration;

290 
®gÜ™hm
.
	`befÜe_™”©iÚ
();

295 
	`pš·ge
();

298 ià(
lßded_·g–i¡
.
	`size
(è=ğ0 && 
uÆßded_·g–i¡
.size() == 0) ;

300 
num_®loûd
 = 0;

302 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


303 
¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t_1
 = std::chrÚo::sy¡em_şock::
	`now
();

306 ià(
©Œibu‹
.
	`is_šmemÜy
()) {

308 
	`execu‹·ge_th»adpoŞ
(
lßded_·g–i¡
, 0, (îßded_·g–i¡.
	`size
());

311 
num_´oûs£d_uÆßded
 = 0;‚um_´oûs£d_uÆßded < ()
uÆßded_·g–i¡
.
	`size
();‚um_´oûs£d_uÆßded +ğ
num_®loûd
) {

313 
num_®loûd
 = 
	`lßd·ge
(
num_´oûs£d_uÆßded
);

317 
num_unfšished_sks
 > 0);

320 ià(
lßded_·g–i¡
.
	`size
() != 0) {

322 
®gÜ™hm
.
	`»que¡_Ãxtchunk
()) {

323 ià(
©Œibu‹
.
	`is_lßd_Ãeded
(è=ğ
çl£
) ;

325 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


326 
¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t_2
 = std::chrÚo::sy¡em_şock::
	`now
();

329 
©Œibu‹
.
	`exchªge_chunks
();

331 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


332 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®_2
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t_2
;

334 
¡İw©ch
[
maš_th»ad_id
][
TIME_IO
] +ğ
š‹rv®_2
.
	`couÁ
();

338 
	`execu‹·ge_th»adpoŞ
(
lßded_·g–i¡
, 0, (îßded_·g–i¡.
	`size
());

340 
num_unfšished_sks
 > 0);

343 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


344 
¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t_2
 = std::chrÚo::sy¡em_şock::
	`now
();

347 
©Œibu‹
.
	`æush_chunks
();

349 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


350 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®_2
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t_2
;

352 
¡İw©ch
[
maš_th»ad_id
][
TIME_IO
] +ğ
š‹rv®_2
.
	`couÁ
();

355 
i
 = 0; i < ()
lßded_·g–i¡
.
	`size
(); i++) {

356 
wiss
.
	`uÅš_·ge
(
šdex
.
	`g‘_·geid
(
lßded_·g–i¡
[
i
]), index.
	`g‘_bufãršdex
(loaded_pagelist[i]));

360 
num_´oûs£d_uÆßded
 = 0;‚um_´oûs£d_uÆßded < ()
uÆßded_·g–i¡
.
	`size
();‚um_´oûs£d_uÆßded +ğ
num_®loûd
) {

362 
num_®loûd
 = 
	`lßd·ge
(
num_´oûs£d_uÆßded
);

364 
num_unfšished_sks
 > 0);

366 
®gÜ™hm
.
	`»que¡_Ãxtchunk
()) {

367 ià(
©Œibu‹
.
	`is_lßd_Ãeded
(è=ğ
çl£
) ;

369 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


370 
¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t_2
 = std::chrÚo::sy¡em_şock::
	`now
();

373 
©Œibu‹
.
	`exchªge_chunks
();

375 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


376 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®_2
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t_2
;

378 
¡İw©ch
[
maš_th»ad_id
][
TIME_IO
] +ğ
š‹rv®_2
.
	`couÁ
();

382 
	`execu‹·ge_th»adpoŞ
(
uÆßded_·g–i¡
, 
num_´oûs£d_uÆßded
,‚um_´oûs£d_uÆßded + 
num_®loûd
);

384 
num_unfšished_sks
 > 0);

387 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


388 
¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t_2
 = std::chrÚo::sy¡em_şock::
	`now
();

391 
©Œibu‹
.
	`æush_chunks
();

393 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


394 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®_2
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t_2
;

396 
¡İw©ch
[
maš_th»ad_id
][
TIME_IO
] +ğ
š‹rv®_2
.
	`couÁ
();

399 
i
 = 
num_´oûs£d_uÆßded
; i <‚um_´oûs£d_uÆßded + 
num_®loûd
; i++) {

400 
wiss
.
	`»Ëa£_·ge
(
šdex
.
	`g‘_·geid
(
uÆßded_·g–i¡
[
i
]), index.
	`g‘_bufãršdex
(unloaded_pagelist[i]));

405 #ifdeà
ANALYSIS_STATIC_MAIN_TIME


406 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®_1
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t_1
;

408 
¡İw©ch
[
maš_th»ad_id
][
TIME_ALLOC
] +ğ
š‹rv®_1
.
	`couÁ
();

415 
®gÜ™hm
.
	`aá”_™”©iÚ
();

417 
šdex
.
	`ş—r_·gem‘a
();

420 ià(
£t_b™¬¿y
) {

422 #ifdeà
ANALYSIS_STATIC_MAIN_HTIME


423 
¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t
 = std::chrÚo::sy¡em_şock::
	`now
();

426 
b™¬¿y
.
	`exchªge
();

428 #ifdeà
ANALYSIS_STATIC_MAIN_HTIME


429 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t
;

431 
¡İw©ch
[
maš_th»ad_id
][
TIME_RESET
] +ğ
š‹rv®
.
	`couÁ
();

436 #ifdeà
ANALYSIS_STATIC_BASIC


437 
i
 = 0; i < (
MASK
 + 1); i++) {

438 ià(
th»aded
[
i
] =ğ
Œue
) {

439 
j
 = 0; j < 3; j++) {

440 
	`´štf
("%d %d %d %lu\n", 
i
, 
j
, 
cur_™”©iÚ
, 
couÁ”
[i][j]);

441 
couÁ”
[
i
][
j
] = 0;

443 
j
 = 3; j < 6; j++) {

444 
	`´štf
("%d %d %d %lf\n", 
i
, 
j
, 
cur_™”©iÚ
, 
¡İw©ch
[i][j - 3]);

445 
¡İw©ch
[
i
][
j
 - 3] = 0.0;

454 
®gÜ™hm
.
	`fš®ize
();

457 
	`de¡roy_basic_compÚ’ts
();

460 
t
.
	`¡İ_time
();

462 
tim”
.
	`add_’Œy
(
t
);

463 
	}
}

466 
	$pš·ge
() {

467 
bËsize
 = 
šdex
.
	`g‘_size_šdex
();

468 * 
·g•Œ
 = 
NULL
;

471 
lßded_·g–i¡
.
	`ş—r
();

472 
uÆßded_·g–i¡
.
	`ş—r
();

474 ià(
£t_b™¬¿y
) {

476 #ifdeà
ANALYSIS_STATIC_MAIN_HTIME


477 
¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t
 = std::chrÚo::sy¡em_şock::
	`now
();

481 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(
dyÇmic
, 1)

482 
bËšdex
 = 0;abËšdex < 
bËsize
;ableindex++) {

483 
·gešfo
…agešfØğ
šdex
.
	`g‘_·gešfo
(
bËšdex
);

486 
Ãeded_·g–i¡
[
bËšdex
] = 
b™¬¿y
.
	`g‘_cu¼_b™s
(
·gešfo
.
fœ¡_nodeid
,…agešfo.
Ï¡_nodeid
);

489 #ifdeà
ANALYSIS_STATIC_MAIN_HTIME


490 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t
;

492 
¡İw©ch
[
maš_th»ad_id
][
TIME_SCAN
] +ğ
š‹rv®
.
	`couÁ
();

498 
bËšdex
 = 0;abËšdex < 
bËsize
;ableindex++) {

499 ià(
£t_b™¬¿y
 && !
Ãeded_·g–i¡
[
bËšdex
]) ;

502 
wiss
.
	`pš_·ge
(
šdex
.
	`g‘_·geid
(
bËšdex
), &
·g•Œ
);

505 ià(
·g•Œ
 =ğ
NULL
) {

506 
uÆßded_·g–i¡
.
	`push_back
(
bËšdex
);

510 
lßded_·g–i¡
.
	`push_back
(
bËšdex
);

512 
©Œibu‹
.
	`£t_·geæag
(
šdex
.
	`g‘_fœ¡_nodeid
(
bËšdex
), index.
	`g‘_Ï¡_nodeid
(tableindex));

516 
šdex
.
	`£t_bufãršdex
(
bËšdex
, 
·g•Œ
);

518 
	}
}

521 
execu‹·ge_th»adpoŞ
(
¡d
::
veùÜ
<> & 
·g–i¡
, 
¡¬tšdex
, 
¡İšdex
) {

522 ià(
	gedge_dœeùiÚ
 =ğ
IN
) {

523 
d¡_low”bound
 = 
©Œibu‹
.
g‘_d¡_low”bound
();

524 
	gd¡_uµ”bound
 = 
©Œibu‹
.
g‘_d¡_uµ”bound
();

525 
	g¤c_low”bound
 = 
©Œibu‹
.
g‘_¤c_low”bound
();

526 
	g¤c_uµ”bound
 = 
©Œibu‹
.
g‘_¤c_uµ”bound
();

529 
	gd¡_low”bound
 = 
©Œibu‹
.
g‘_¤c_low”bound
();

530 
	gd¡_uµ”bound
 = 
©Œibu‹
.
g‘_¤c_uµ”bound
();

531 
	g¤c_low”bound
 = 
©Œibu‹
.
g‘_d¡_low”bound
();

532 
	g¤c_uµ”bound
 = 
©Œibu‹
.
g‘_d¡_uµ”bound
();

536 
	gšdex
 = 
¡¬tšdex
; index < 
	g¡İšdex
; index++) {

537 
	gnum_unfšished_sks
++;

540 
	gio_£rviû
.
po¡
(
boo¡
::
bšd
(&
’gše
::
hªdËr_lßded
, 
this
, 
·g–i¡
[
šdex
]));

545 
	$hªdËr_lßded
(
bËšdex
) {

547 #ifdeà
ANALYSIS_STATIC_WORKER_BASIC


548 
size_t
 
th»ad_id
;

549 
¡d
::
¡ršg¡»am
 
ss
;

550 
ss
 << 
¡d
::
this_th»ad
::
	`g‘_id
();

551 
ss
 >> 
th»ad_id
;

553 
th»ad_id
 =h»ad_id & 
MASK
;

555 ià(
th»aded
[
th»ad_id
] =ğ
çl£
èth»aded[th»ad_id] = 
Œue
;

558 #ifdeà
ANALYSIS_STATIC_WORKER_TIME


559 
¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t
 = std::chrÚo::sy¡em_şock::
	`now
();

563 
·gešfo
…agešfØğ
šdex
.
	`g‘_·gešfo
(
bËšdex
);

564 * 
·ge_±r
 = 
šdex
.
	`g‘_bufãršdex
(
bËšdex
);

565 
cÚÃùedsize
 = 
šdex
.
	`g‘_cÚÃùedsize
(
bËšdex
);

566 
·gem‘a
 * 
·gem‘a_±r
 = 
šdex
.
	`g‘_·gem‘a_±r
(
bËšdex
);

569 * 
adjli¡_±r
 = 
NULL
;

570 
Ëngth
 = 0;

572 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


573 
size_t
 
num_nodes
 = 0;

574 
size_t
 
num_edges
 = 0;

577 ià(
©Œibu‹
.
	`is_šmemÜy
(è=ğ
Œue
) {

578 
nodešdex
 = 
·gešfo
.
fœ¡_nodeid
;‚odešdex <ğ·gešfo.
Ï¡_nodeid
;‚odeindex++) {

579 ià(!
£t_b™¬¿y
 || 
b™¬¿y
.
	`g‘_cu¼_b™
(
nodešdex
)) {

580 
Ëngth
 = 
wiss
.
	`g‘_»cÜd
(
·ge_±r
, 
nodešdex
 - 
·gešfo
.
fœ¡_nodeid
, (**)&
adjli¡_±r
è/ (
EDGETYPE
);

582 
®gÜ™hm
.
	`execu‹_node
(
nodešdex
, 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a_±r
);

584 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


585 
num_nodes
++;

586 
num_edges
 +ğ(
size_t
)
Ëngth
;

591 ià(
£t_b™¬¿y
 && (
nodešdex
 & 
WORDFILTER
) == WORDFILTER) {

592 
nodešdex
 =‚odešdex + 1;‚odešdex < 
·gešfo
.
Ï¡_nodeid
;‚odeindex += 64) {

593 ià(
b™¬¿y
.
	`g‘_cu¼_wÜd
(
nodešdex
 >> 
WORDRANGE_LOG2
) != 0) {

598 
nodešdex
--;

602 
wiss
.
	`uÅš_·ge
(
·gešfo
.
·ge_id
, 
·ge_±r
);

605 
Œack_low”
 = 
·gešfo
.
fœ¡_nodeid
 < 
d¡_low”bound
 ? dst_lowerbound :…ageinfo.first_nodeid;

606 
Œack_uµ”
 = 
·gešfo
.
Ï¡_nodeid
 > 
d¡_uµ”bound
 ? dst_upperbound :…ageinfo.last_nodeid;

607 * 
fœ¡šdex
 = 
NULL
;

608 * 
Ï¡šdex
 = 
NULL
;

610 
nodešdex
 = 
Œack_low”
;‚odešdex <ğ
Œack_uµ”
;‚odeindex++) {

611 ià(!
£t_b™¬¿y
 || 
b™¬¿y
.
	`g‘_cu¼_b™
(
nodešdex
)) {

612 
Ëngth
 = 
wiss
.
	`g‘_»cÜd
(
·ge_±r
, 
nodešdex
 - 
·gešfo
.
fœ¡_nodeid
, (**)&
adjli¡_±r
è/ (
EDGETYPE
);

614 
fœ¡šdex
 = 
¡d
::
	`low”_bound
(
adjli¡_±r
,‡djli¡_±¸+ 
Ëngth
, ()
¤c_low”bound
);

615 
Ï¡šdex
 = 
¡d
::
	`uµ”_bound
(
adjli¡_±r
,‡djli¡_±¸+ 
Ëngth
, ()
¤c_uµ”bound
);

617 
®gÜ™hm
.
	`execu‹_node
(
nodešdex
, 
fœ¡šdex
, 
Ï¡šdex
 - fœ¡šdex, 
cÚÃùedsize
, 
·gem‘a_±r
);

619 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


620 
num_nodes
++;

621 
num_edges
 +ğ(
size_t
)(
Ï¡šdex
 - 
fœ¡šdex
);

626 ià(
£t_b™¬¿y
 && (
nodešdex
 & 
WORDFILTER
) == WORDFILTER) {

627 
nodešdex
 =‚odešdex + 1;‚odešdex < 
Œack_uµ”
;‚odeindex += 64) {

628 ià(
b™¬¿y
.
	`g‘_cu¼_wÜd
(
nodešdex
 >> 
WORDRANGE_LOG2
) != 0) {

633 
nodešdex
--;

638 
num_unfšished_sks
--;

640 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


641 
couÁ”
[
th»ad_id
][
NUM_NODES
] +ğ
num_nodes
;

642 
couÁ”
[
th»ad_id
][
NUM_EDGES
] +ğ
num_edges
;

645 #ifdeà
ANALYSIS_STATIC_WORKER_TIME


646 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t
;

648 
¡İw©ch
[
th»ad_id
][
TIME_PROC
] +ğ
š‹rv®
.
	`couÁ
();

651 
	}
}

653 
execu‹·ge_·¿Î–
(
¡d
::
veùÜ
<> & 
·g–i¡
, 
¡¬tšdex
, 
¡İšdex
) {

654 ià(
	gedge_dœeùiÚ
 =ğ
IN
) {

655 
d¡_low”bound
 = 
©Œibu‹
.
g‘_d¡_low”bound
();

656 
	gd¡_uµ”bound
 = 
©Œibu‹
.
g‘_d¡_uµ”bound
();

657 
	g¤c_low”bound
 = 
©Œibu‹
.
g‘_¤c_low”bound
();

658 
	g¤c_uµ”bound
 = 
©Œibu‹
.
g‘_¤c_uµ”bound
();

661 
	gd¡_low”bound
 = 
©Œibu‹
.
g‘_¤c_low”bound
();

662 
	gd¡_uµ”bound
 = 
©Œibu‹
.
g‘_¤c_uµ”bound
();

663 
	g¤c_low”bound
 = 
©Œibu‹
.
g‘_d¡_low”bound
();

664 
	g¤c_uµ”bound
 = 
©Œibu‹
.
g‘_d¡_uµ”bound
();

668 #´agm¨
omp
 
·¿Î–
 
scheduË
(
dyÇmic
, 1)

669 
	gidx
 = 
¡¬tšdex
; idx < 
	g¡İšdex
; idx++) {

671 #ifdeà
ANALYSIS_STATIC_WORKER_BASIC


672 
size_t
 
	gth»ad_id
;

673 
	g¡d
::
¡ršg¡»am
 
ss
;

674 
	gss
 << 
	g¡d
::
this_th»ad
::
g‘_id
();

675 
	gss
 >> 
	gth»ad_id
;

677 
	gth»ad_id
 = 
th»ad_id
 & 
MASK
;

679 ià(
	gth»aded
[
th»ad_id
] =ğ
çl£
è
th»aded
[th»ad_id] = 
Œue
;

682 #ifdeà
ANALYSIS_STATIC_WORKER_TIME


683 
	g¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t
 = 
¡d
::chrÚo::sy¡em_şock::
now
();

687 
	gbËšdex
 = 
·g–i¡
[
idx
];

688 
·gešfo
 
	g·gešfo
 = 
šdex
.
g‘_·gešfo
(
bËšdex
);

689 * 
	g·ge_±r
 = 
šdex
.
g‘_bufãršdex
(
bËšdex
);

690 
	gcÚÃùedsize
 = 
šdex
.
g‘_cÚÃùedsize
(
bËšdex
);

691 
·gem‘a
 * 
	g·gem‘a_±r
 = 
šdex
.
g‘_·gem‘a_±r
(
bËšdex
);

694 * 
	gadjli¡_±r
 = 
NULL
;

695 
	gËngth
 = 0;

697 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


698 
size_t
 
	gnum_nodes
 = 0;

699 
size_t
 
	gnum_edges
 = 0;

702 ià(
	g©Œibu‹
.
is_šmemÜy
(è=ğ
Œue
) {

703 
nodešdex
 = 
·gešfo
.
fœ¡_nodeid
; 
	gnodešdex
 <ğ·gešfo.
Ï¡_nodeid
;‚odeindex++) {

704 ià(!
	g£t_b™¬¿y
 || 
	gb™¬¿y
.
g‘_cu¼_b™
(
nodešdex
)) {

705 
	gËngth
 = 
wiss
.
g‘_»cÜd
(
·ge_±r
, 
nodešdex
 - 
·gešfo
.
fœ¡_nodeid
, (**)&
adjli¡_±r
è/ (
	gEDGETYPE
);

707 
	g®gÜ™hm
.
execu‹_node
(
nodešdex
, 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a_±r
);

709 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


710 
	gnum_nodes
++;

711 
	gnum_edges
 +ğ(
size_t
)
Ëngth
;

716 ià(
	g£t_b™¬¿y
 && (
	gnodešdex
 & 
	gWORDFILTER
è=ğ
WORDFILTER
) {

717 
nodešdex
 =‚odešdex + 1; 
	gnodešdex
 < 
	g·gešfo
.
	gÏ¡_nodeid
;‚odeindex += 64) {

718 ià(
b™¬¿y
.
g‘_cu¼_wÜd
(
nodešdex
 >> 
WORDRANGE_LOG2
) != 0) {

723 
	gnodešdex
--;

727 
	gwiss
.
uÅš_·ge
(
·gešfo
.
·ge_id
, 
·ge_±r
);

730 
	gŒack_low”
 = 
·gešfo
.
fœ¡_nodeid
 < 
d¡_low”bound
 ? dst_lowerbound :…ageinfo.first_nodeid;

731 
	gŒack_uµ”
 = 
·gešfo
.
Ï¡_nodeid
 > 
d¡_uµ”bound
 ? dst_upperbound :…ageinfo.last_nodeid;

732 * 
	gfœ¡šdex
 = 
NULL
;

733 * 
	gÏ¡šdex
 = 
NULL
;

735 
	gnodešdex
 = 
Œack_low”
;‚odešdex <ğ
Œack_uµ”
;‚odeindex++) {

736 ià(!
	g£t_b™¬¿y
 || 
	gb™¬¿y
.
g‘_cu¼_b™
(
nodešdex
)) {

737 
	gËngth
 = 
wiss
.
g‘_»cÜd
(
·ge_±r
, 
nodešdex
 - 
·gešfo
.
fœ¡_nodeid
, (**)&
adjli¡_±r
è/ (
	gEDGETYPE
);

739 
	gfœ¡šdex
 = 
¡d
::
low”_bound
(
adjli¡_±r
,‡djli¡_±¸+ 
Ëngth
, ()
¤c_low”bound
);

740 
	gÏ¡šdex
 = 
¡d
::
uµ”_bound
(
adjli¡_±r
,‡djli¡_±¸+ 
Ëngth
, ()
¤c_uµ”bound
);

742 
	g®gÜ™hm
.
execu‹_node
(
nodešdex
, 
fœ¡šdex
, 
Ï¡šdex
 - fœ¡šdex, 
cÚÃùedsize
, 
·gem‘a_±r
);

744 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


745 
	gnum_nodes
++;

746 
	gnum_edges
 +ğ(
size_t
)(
Ï¡šdex
 - 
fœ¡šdex
);

751 ià(
	g£t_b™¬¿y
 && (
	gnodešdex
 & 
	gWORDFILTER
è=ğ
WORDFILTER
) {

752 
nodešdex
 =‚odešdex + 1; 
	gnodešdex
 < 
	gŒack_uµ”
;‚odeindex += 64) {

753 ià(
b™¬¿y
.
g‘_cu¼_wÜd
(
nodešdex
 >> 
WORDRANGE_LOG2
) != 0) {

758 
	gnodešdex
--;

764 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


765 
	gcouÁ”
[
th»ad_id
][
NUM_NODES
] +ğ
num_nodes
;

766 
	gcouÁ”
[
th»ad_id
][
NUM_EDGES
] +ğ
num_edges
;

769 #ifdeà
ANALYSIS_STATIC_WORKER_TIME


770 
	g¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®
 = 
¡d
::chrÚo::
sy¡em_şock
::
now
(è- 
¡¬t
;

772 
	g¡İw©ch
[
th»ad_id
][
TIME_PROC
] +ğ
š‹rv®
.
couÁ
();

779 
	$lßd·ge
(
num_´oûs£d_uÆßded
) {

780 
li¡size
 = ()
uÆßded_·g–i¡
.
	`size
();

781 
bËšdex
;

782 * 
·g•Œ
 = 
NULL
;

785 
wiss
.
	`g‘_ä“size
() < 1);

788 
num_®loûd
 = 
wiss
.
	`»£rve_®loc_·ges
(&
uÆßded_·g–i¡
[
num_´oûs£d_uÆßded
], 
šdex
.
	`g‘_bufãršdex_±r
(), 
li¡size
 -‚um_processed_unloaded);

791 
num_po¡ed_uÆßded
 = 0;‚um_po¡ed_uÆßded < 
num_®loûd
;‚um_posted_unloaded++) {

792 
bËšdex
 = 
uÆßded_·g–i¡
[
num_´oûs£d_uÆßded
 + 
num_po¡ed_uÆßded
];

793 
·g•Œ
 = 
šdex
.
	`g‘_bufãršdex
(
bËšdex
);

796 
wiss
.
	`»£rve_lock_·ge
(
šdex
.
	`g‘_·geid
(
bËšdex
), &
·g•Œ
);

798 
©Œibu‹
.
	`£t_·geæag
(
šdex
.
	`g‘_fœ¡_nodeid
(
bËšdex
), index.
	`g‘_Ï¡_nodeid
(tableindex));

800 
num_unfšished_sks
++;

803 
io_£rviû
.
	`po¡
(
boo¡
::
	`bšd
(&
’gše
::
hªdËr_uÆßded
, 
this
, 
bËšdex
));

806  
num_®loûd
;

807 
	}
}

810 
	$hªdËr_uÆßded
(
bËšdex
) {

812 #ifdeà
ANALYSIS_STATIC_WORKER_BASIC


813 
size_t
 
th»ad_id
;

814 
¡d
::
¡ršg¡»am
 
ss
;

815 
ss
 << 
¡d
::
this_th»ad
::
	`g‘_id
();

816 
ss
 >> 
th»ad_id
;

818 
th»ad_id
 =h»ad_id & 
MASK
;

820 ià(
th»aded
[
th»ad_id
] =ğ
çl£
èth»aded[th»ad_id] = 
Œue
;

823 #ifdeà
ANALYSIS_STATIC_WORKER_TIME


824 
¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t
 = std::chrÚo::sy¡em_şock::
	`now
();

828 
·gešfo
…agešfØğ
šdex
.
	`g‘_·gešfo
(
bËšdex
);

829 * 
·ge_±r
 = 
šdex
.
	`g‘_bufãršdex
(
bËšdex
);

830 
cÚÃùedsize
 = 
šdex
.
	`g‘_cÚÃùedsize
(
bËšdex
);

831 
·gem‘a
 * 
·gem‘a_±r
 = 
šdex
.
	`g‘_·gem‘a_±r
(
bËšdex
);

834 
	`´—d
(
wiss
.
	`g‘_devaddr
(), 
·ge_±r
, 
PAGESIZE
, ()((()
·gešfo
.
·ge_id
) * PAGESIZE));

836 #ifdeà
ANALYSIS_STATIC_WORKER_TIME


837 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®_1
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t
;

839 
¡İw©ch
[
th»ad_id
][
TIME_IO
] +ğ
š‹rv®_1
.
	`couÁ
();

842 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


843 
couÁ”
[
th»ad_id
][
NUM_IOS
] += 1;

845 
size_t
 
num_nodes
 = 0;

846 
size_t
 
num_edges
 = 0;

849 ià(
©Œibu‹
.
	`is_šmemÜy
(è=ğ
Œue
) {

851 * 
adjli¡_±r
 = 
NULL
;

852 
Ëngth
 = 0;

854 
nodešdex
 = 
·gešfo
.
fœ¡_nodeid
;‚odešdex <ğ·gešfo.
Ï¡_nodeid
;‚odeindex++) {

855 ià(!
£t_b™¬¿y
 || 
b™¬¿y
.
	`g‘_cu¼_b™
(
nodešdex
)) {

856 
Ëngth
 = 
wiss
.
	`g‘_»cÜd
(
·ge_±r
, 
nodešdex
 - 
·gešfo
.
fœ¡_nodeid
, (**)&
adjli¡_±r
è/ (
EDGETYPE
);

858 
®gÜ™hm
.
	`execu‹_node
(
nodešdex
, 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a_±r
);

860 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


861 
num_nodes
++;

862 
num_edges
 +ğ(
size_t
)
Ëngth
;

867 ià(
£t_b™¬¿y
 && (
nodešdex
 & 
WORDFILTER
) == WORDFILTER) {

868 
nodešdex
 =‚odešdex + 1;‚odešdex < 
·gešfo
.
Ï¡_nodeid
;‚odeindex += 64) {

869 ià(
b™¬¿y
.
	`g‘_cu¼_wÜd
(
nodešdex
 >> 
WORDRANGE_LOG2
) != 0) {

874 
nodešdex
--;

878 
wiss
.
	`»Ëa£_·ge
(
·gešfo
.
·ge_id
, 
·ge_±r
);

881 
num_unfšished_sks
--;

883 #ifdeà
ANALYSIS_STATIC_WORKER_COUNT


884 
couÁ”
[
th»ad_id
][
NUM_NODES
] +ğ
num_nodes
;

885 
couÁ”
[
th»ad_id
][
NUM_EDGES
] +ğ
num_edges
;

888 #ifdeà
ANALYSIS_STATIC_WORKER_TIME


889 
¡d
::
chrÚo
::
du¿tiÚ
<> 
š‹rv®_2
 = std::chrÚo::
sy¡em_şock
::
	`now
(è- 
¡¬t
;

891 
¡İw©ch
[
th»ad_id
][
TIME_PROC
] +ğ
š‹rv®_2
.
	`couÁ
();

894 
	}
}

	@index_handler.hpp

1 #iâdeà
__INDEX_HANDLER_HPP__


2 
	#__INDEX_HANDLER_HPP__


	)

4 
	~<s¡»am
>

5 
	~<veùÜ
>

6 
	~<©omic
>

8 
	s·gešfo
 {

9 
	m·ge_id
;

10 
	mfœ¡_nodeid
;

11 
	mÏ¡_nodeid
;

14 
	s·gem‘a
 {

15 
	m¡d
::
©omic_æag
 
lock
;

16 * 
	m´e_»suÉ
;

17 
	mnum_Ëngth
;

18 
	mnum_couÁ
;

21 şas 
	cšdex_hªdËr
 {

22 
	m´iv©e
:

24 
·gešfo
 * 
g¿phšdex
;

25 
·gem‘a
 ** 
	mg¿phm‘a_±r
;

26 
·gem‘a
 * 
	mg¿phm‘a
;

27 ** 
	mbufãršdex
;

28 * 
	mcÚÃùedsize
;

31 
	m¡d
::
¡ršg
 
f’ame
;

32 
	msize_šdex
;

33 
	mnum_nodes
;

35 
	mpublic
:

36 
	$šdex_hªdËr
() {

39 ~
	$šdex_hªdËr
() {

40 
	}
}

42 
¡d
::
¡ršg
 
	$f’ame_g¿phšfo
() {

43 
¡d
::
¡ršg¡»am
 
ss
;

44 
ss
 << 
f’ame
;

45 
ss
 << ".graphinfo";

46  
ss
.
	`¡r
();

47 
	}
}

49 
	g¡d
::
¡ršg
 
	$f’ame_g¿phšdex
() {

50 
¡d
::
¡ršg¡»am
 
ss
;

51 
ss
 << 
f’ame
;

52 
ss
 << ".graphindex";

53  
ss
.
	`¡r
();

54 
	}
}

56 
	$lßd_g¿phšdex
(
¡d
::
¡ršg
 
_f’ame
) {

57 
f’ame
 = 
_f’ame
;

59 
FILE
 * 
å
 = 
NULL
;

62 
å
 = 
	`fİ’
(
	`f’ame_g¿phšfo
().
	`c_¡r
(), "rb");

64 
	`ä—d
(&
size_šdex
, (), 1, 
å
);

65 
	`ä—d
(&
num_nodes
, (), 1, 
å
);

67 
	`fşo£
(
å
);

70 
g¿phšdex
 = 
Ãw
 
·gešfo
[
size_šdex
];

72 
å
 = 
	`fİ’
(
	`f’ame_g¿phšdex
().
	`c_¡r
(), "rb");

74 
	`ä—d
(
g¿phšdex
, (
·gešfo
), 
size_šdex
, 
å
);

76 
	`fşo£
(
å
);

79 
g¿phm‘a_±r
 = 
Ãw
 
·gem‘a
*[
size_šdex
];

80 
g¿phm‘a
 = 
Ãw
 
·gem‘a
[
size_šdex
];

83 
bufãršdex
 = 
Ãw
 *[
size_šdex
];

86 
šdex
 = 0; index < 
size_šdex
; index++) {

87 
g¿phm‘a
[
šdex
].
lock
.
	`ş—r
();

88 
g¿phm‘a
[
šdex
].
´e_»suÉ
 = 
NULL
;

89 
g¿phm‘a
[
šdex
].
num_Ëngth
 = 0;

90 
g¿phm‘a
[
šdex
].
num_couÁ
 = 0;

94 
cÚÃùedsize
 = 
Ãw
 [
size_šdex
];

96 
	`mem£t
(
cÚÃùedsize
, 0, 
size_šdex
 * ());

97 
šdex
 = 1; index < 
size_šdex
;) {

98 
¡¬t_šdex
 = 
šdex
 - 1;

99 
Ï¡_šdex
 = 
šdex
;

101 ; 
Ï¡_šdex
 < 
size_šdex
;†ast_index++) {

102 ià(
g¿phšdex
[
Ï¡_šdex
].
fœ¡_nodeid
 != graphindex[last_index - 1].first_nodeid) {

107 
i
 = 
¡¬t_šdex
; i < 
Ï¡_šdex
; i++) {

108 
cÚÃùedsize
[
i
] = 
Ï¡_šdex
 - 
¡¬t_šdex
;

109 
g¿phm‘a_±r
[
i
] = &
g¿phm‘a
[
¡¬t_šdex
];

112 
šdex
 = 
Ï¡_šdex
 + 1;

115 ià(
cÚÃùedsize
[
size_šdex
 - 1] == 0) {

116 
cÚÃùedsize
[
size_šdex
 - 1] = 1;

117 
g¿phm‘a_±r
[
size_šdex
 - 1] = &
g¿phm‘a
[size_index - 1];

119 
	}
}

121 
	$uÆßd_g¿phšdex
() {

122 
d–‘e
 
g¿phm‘a_±r
;

123 
d–‘e
 
g¿phm‘a
;

124 
d–‘e
 
g¿phšdex
;

125 
d–‘e
 
bufãršdex
;

126 
d–‘e
 
cÚÃùedsize
;

127 
	}
}

129 
	$ş—r_·gem‘a
() {

130 
šdex
 = 1; index < 
size_šdex
; index++) {

131 
g¿phm‘a
[
šdex
].
num_Ëngth
 = 0;

132 
g¿phm‘a
[
šdex
].
num_couÁ
 = 0;

134 
	}
}

136 
	$g‘_size_šdex
() {

137  
size_šdex
;

138 
	}
}

140 
	$g‘_num_nodes
() {

141  
num_nodes
;

142 
	}
}

144 
	$g‘_fœ¡_nodeid
(
bËšdex
) {

145  
g¿phšdex
[
bËšdex
].
fœ¡_nodeid
;

146 
	}
}

148 
	$g‘_Ï¡_nodeid
(
bËšdex
) {

149  
g¿phšdex
[
bËšdex
].
Ï¡_nodeid
;

150 
	}
}

152 
	$g‘_·geid
(
bËšdex
) {

153  
g¿phšdex
[
bËšdex
].
·ge_id
;

154 
	}
}

156 
·gešfo
 
	$g‘_·gešfo
(
bËšdex
) {

157  
g¿phšdex
[
bËšdex
];

158 
	}
}

160 
	$g‘_cÚÃùedsize
(
bËšdex
) {

161  
cÚÃùedsize
[
bËšdex
];

162 
	}
}

164 
·gem‘a
 * 
	$g‘_·gem‘a_±r
(
bËšdex
) {

165  
g¿phm‘a_±r
[
bËšdex
];

166 
	}
}

168 * 
	$g‘_bufãršdex
(
bËšdex
) {

169  
bufãršdex
[
bËšdex
];

170 
	}
}

172 
	$£t_bufãršdex
(
bËšdex
, * 
±r
) {

173 
bufãršdex
[
bËšdex
] = 
±r
;

174 
	}
}

176 ** 
	$g‘_bufãršdex_±r
() {

177  
bufãršdex
;

178 
	}
}

	@information_handler.hpp

1 #iâdeà
__INFORMATION_HANDLER_HPP__


2 
	#__INFORMATION_HANDLER_HPP__


	)

4 
	~<b™¬¿y_hªdËr.hµ
>

5 
	~<·¿m‘”_hªdËr.hµ
>

6 
	~<©Œibu‹_hªdËr.hµ
>

8 
	sšfÜm©iÚ_hªdËr
 {

9 
b™¬¿y_hªdËr
 * 
	mb™¬¿y_±r
;

10 
·¿m‘”_hªdËr
 * 
	m·¿m‘”_±r
;

11 
©Œibu‹_w¿µ”
 * 
	m©Œibu‹_±r
;

12 
wiss_hªdËr
 * 
	mwiss_±r
;

13 
šdex_hªdËr
 * 
	mšdex_±r
;

15 
	mnum_nodes
;

16 
	mnum_th»ads
;

17 
	mcur_™”©iÚ
;

18 
	mmax_™”©iÚ
;

	@parameter_handler.hpp

1 #iâdeà
__PARAMETER_HANDLER_HPP__


2 
	#__PARAMETER_HANDLER_HPP__


	)

4 
	~<¡ršg
>

5 
	~<veùÜ
>

7 şas 
	c·¿m‘”_hªdËr
 {

8 
	m¬gc
;

9 ** 
	m¬gv
;

11 
	mpublic
:

12 
	$·¿m‘”_hªdËr
(
_¬gc
, ** 
_¬gv
) {

13 
¬gc
 = 
_¬gc
;

14 
¬gv
 = 
_¬gv
;

17 
	$g‘_·¿m_št
(cÚ¡ * 
·¿m‘”_Çme
, 
deçuÉ_v®ue
) {

18 
commªd_šdex
 = 0; commªd_šdex < 
¬gc
 - 1; command_index++) {

19 ià(
	`¡rcmp
(
¬gv
[
commªd_šdex
], 
·¿m‘”_Çme
) == 0) {

20  
	`©oi
(
¬gv
[
commªd_šdex
 + 1]);

24  
deçuÉ_v®ue
;

25 
	}
}

27 
	g¡d
::
¡ršg
 
	$g‘_·¿m_¡ršg
(cÚ¡ * 
·¿m‘”_Çme
, 
¡d
::
¡ršg
 
deçuÉ_v®ue
) {

28 
commªd_šdex
 = 0; commªd_šdex < 
¬gc
 - 1; command_index++) {

29 ià(
	`¡rcmp
(
¬gv
[
commªd_šdex
], 
·¿m‘”_Çme
) == 0) {

30  
¡d
::
	`¡ršg
(
¬gv
[
commªd_šdex
 + 1]);

34  
deçuÉ_v®ue
;

35 
	}
}

	@template.cpp

1 
	~<c¡dio
>

2 
	~<c¡dlib
>

3 
	~<c¡ršg
>

4 
	~<io¡»am
>

5 
	~<’gše.hµ
>

9 şas 
	c‹mp_®gÜ™hm
 : 
public
 
®gÜ™hm_hªdËr
 {

10 
´iv©e
:

11 
šfÜm©iÚ_hªdËr
 * 
šfÜm©iÚ_±r
;

13 
©Œibu‹_w¿µ”
 * 
	m©Œibu‹_±r
;

14 
b™¬¿y_hªdËr
 * 
	mb™¬¿y_±r
;

15 
·¿m‘”_hªdËr
 * 
	m·¿m‘”_±r
;

16 
wiss_hªdËr
 * 
	mwiss_±r
;

17 
šdex_hªdËr
 * 
	mšdex_±r
;

19 
time_’Œy
 
	mt
;

21 * 
	mpivÙ_block
;

22 
	mnum_blocks
;

23 
	mpublic
:

24 
	$‹mp_®gÜ™hm
(è: 
	`®gÜ™hm_hªdËr
(), 
	`t
("engine") {

27 ~
	$‹mp_®gÜ™hm
() {

28 
	}
}

30 
	$š™Ÿlize
(
šfÜm©iÚ_hªdËr
 * 
_šfÜm©iÚ_±r
) {

31 
t
.
	`¡¬t_time
();

34 
šfÜm©iÚ_±r
 = 
_šfÜm©iÚ_±r
;

36 
©Œibu‹_±r
 = 
šfÜm©iÚ_±r
->attribute_ptr;

37 
b™¬¿y_±r
 = 
šfÜm©iÚ_±r
->bitarray_ptr;

38 
·¿m‘”_±r
 = 
šfÜm©iÚ_±r
->parameter_ptr;

39 
wiss_±r
 = 
šfÜm©iÚ_±r
->wiss_ptr;

40 
šdex_±r
 = 
šfÜm©iÚ_±r
->index_ptr;

45 
pivÙ_block
 = 
Ãw
 [
PAGESIZE
];

48 
num_blocks
 = 
šdex_±r
->
	`g‘_size_šdex
();

50 
block_šdex
 = 0; block_šdex < 
num_blocks
; block_index++) {

52 
	`´—d
(
wiss_±r
->
	`g‘_devaddr
(), 
pivÙ_block
, 
PAGESIZE
, ()((()
šdex_±r
->
	`g‘_·geid
(
block_šdex
)) * PAGESIZE));

54 * 
adjli¡_±r
 = 
NULL
;

55 
Ëngth
 = 0;

57 
nodešdex
 = 
šdex_±r
->
	`g‘_fœ¡_nodeid
(
block_šdex
);‚odešdex <ğšdex_±r->
	`g‘_Ï¡_nodeid
(block_index);‚odeindex++) {

60 
Ëngth
 = 
wiss_±r
->
	`g‘_»cÜd
(
pivÙ_block
, 
nodešdex
 - 
šdex_±r
->
	`g‘_fœ¡_nodeid
(
block_šdex
), (**)&
adjli¡_±r
è/ (
EDGETYPE
);

68 
	`execu‹_node
(
nodešdex
, 
adjli¡_±r
, 
Ëngth
, 
šdex_±r
->
	`g‘_cÚÃùedsize
(
block_šdex
), index_±r->
	`g‘_·gem‘a_±r
(block_index));

71 
	}
}

73 
	$befÜe_™”©iÚ
() {

74 
	}
}

76 
boŞ
 
	$»que¡_Ãxtchunk
() {

77  
çl£
;

78 
	}
}

80 
	$execu‹_node
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a
 * 
·gem‘a_±r
) {

81 
	}
}

83 
	$aá”_™”©iÚ
() {

84 
	}
}

86 
	$fš®ize
() {

87 
t
.
	`¡İ_time
();

88 
	}
}

91 
	$maš
(
¬gc
, ** 
¬gv
) {

92 
·¿m‘”_hªdËr
 
	`·¿m
(
¬gc
, 
¬gv
);

94 
‹mp_®gÜ™hm
 
®g
;

95 
’gše
 
	`e
(
®g
, 
·¿m
);

97 
e
.
	`run
();

100 
	}
}

	@test.cpp

1 
	~<c¡dio
>

2 
	~<c¡dlib
>

3 
	~<c¡ršg
>

4 
	~<io¡»am
>

6 
	#EDGETYPE
 

	)

8 
boŞ
 
	$Ëss_edge
(
EDGETYPE
 
i
, EDGETYPE 
j
) {

9  
i
 < 
j
;

10 
	}
}

12 
	$g‘_node_id
(
EDGETYPE
 
ev
) {

13  
ev
;

14 
	}
}

16 
	~<’gše.hµ
>

17 
	~<m­
>

18 
	#bfs_ty³
 
boŞ


	)

19 
	#pg_ty³
 

	)

20 
	#wcc_ty³
 

	)

21 
	#dfs_ty³
 

	)

24 
	#scÜe_ty³
 

	)

25 
	#weight
 1

	)

26 
	#hscÜe
 0

	)

28 
	#nÙvis™ed
 -1

	)

29 
	#ev®u©ed
 -2

	)

31 
usšg
 
Çme¥aû
 
	g¡d
;

33 şas 
	cŒŸngËcouÁ_®gÜ™hm
 : 
public
 
®gÜ™hm_hªdËr
 {

34 
´iv©e
:

35 
šfÜm©iÚ_hªdËr
 * 
šfÜm©iÚ_±r
;

37 
©Œibu‹_w¿µ”
 * 
	m©Œibu‹_±r
;

38 
b™¬¿y_hªdËr
 * 
	mb™¬¿y_±r
;

39 
·¿m‘”_hªdËr
 * 
	m·¿m‘”_±r
;

40 
wiss_hªdËr
 * 
	mwiss_±r
;

41 
šdex_hªdËr
 * 
	mšdex_±r
;

43 
time_’Œy
 
	mt
;

45 * 
	mpivÙ_block
;

46 
	mnum_blocks
;

47 cÚ¡ 
	mmax_blocks
 = 3000;

48 
	mblock_idx
 = 0;

50 * 
	mchdli¡_±r
 = 
NULL
;

51 
	mchdli¡_Ën
 = 0;

53 
	mn_id
;

55 
	m©omic
<> 
	mŒŸngËcouÁ
;

57 
	mpublic
:

58 
	$ŒŸngËcouÁ_®gÜ™hm
(è: 
	`®gÜ™hm_hªdËr
(), 
	`t
("engine") {

61 ~
	$ŒŸngËcouÁ_®gÜ™hm
() {

62 
	}
}

64 
	$š™Ÿlize
(
šfÜm©iÚ_hªdËr
 * 
_šfÜm©iÚ_±r
) {

65 
t
.
	`¡¬t_time
();

68 
šfÜm©iÚ_±r
 = 
_šfÜm©iÚ_±r
;

70 
©Œibu‹_±r
 = 
šfÜm©iÚ_±r
->attribute_ptr;

71 
b™¬¿y_±r
 = 
šfÜm©iÚ_±r
->bitarray_ptr;

72 
·¿m‘”_±r
 = 
šfÜm©iÚ_±r
->parameter_ptr;

73 
wiss_±r
 = 
šfÜm©iÚ_±r
->wiss_ptr;

74 
šdex_±r
 = 
šfÜm©iÚ_±r
->index_ptr;

76 
ŒŸngËcouÁ
 = 0;

78 
pivÙ_block
 = 
Ãw
 [
PAGESIZE
 * 
max_blocks
];

80 
num_blocks
 = 
šdex_±r
->
	`g‘_size_šdex
();

82 
	`´—d
(
wiss_±r
->
	`g‘_devaddr
(), 
pivÙ_block
, 
PAGESIZE
, ()((()
šdex_±r
->
	`g‘_·geid
(
block_idx
)) * PAGESIZE));

83 
	}
}

85 
	$befÜe_™”©iÚ
() {

86 if(
block_idx
 < 
num_blocks
 - 1) {

87 if(
block_idx
 > 
max_blocks
 - 1) {

88 
block_idx
 +ğ
max_blocks
 - 1;

91 if(
šdex_±r
->
	`g‘_Ï¡_nodeid
(
block_idx
è< 
n_id
) {

92 
block_idx
++;

93 
	`´—d
(
wiss_±r
->
	`g‘_devaddr
(), 
pivÙ_block
, 
PAGESIZE
, ()((()
šdex_±r
->
	`g‘_·geid
(
block_idx
)) * PAGESIZE));

96 
chdli¡_Ën
 = 
wiss_±r
->
	`g‘_»cÜd
(
pivÙ_block
, 
n_id
 - 
šdex_±r
->
	`g‘_fœ¡_nodeid
(
block_idx
), (**)&
chdli¡_±r
è/ (
EDGETYPE
);

98 
	}
}

100 
boŞ
 
	$»que¡_Ãxtchunk
() {

101  
çl£
;

102 
	}
}

104 
size_t
 
	$couÁ_š‹r£ùiÚ
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
¡¬t
) {

105 
c_idx
 = 0;

106 
a_idx
 = 
¡¬t
;

107 
size_t
 
út
 = 0;

109 
a_idx
 < 
Ëngth
 && 
c_idx
 < 
chdli¡_Ën
) {

110 
size_t
 
d¡
 = 
chdli¡_±r
[
c_idx
];

111 
size_t
 
a
 = 
adjli¡_±r
[
a_idx
];

112 if(
a
 =ğ
d¡
) {

113 
út
++;

114 
a_idx
++; 
c_idx
++;

116 
c_idx
 +ğ
a
 < 
d¡
;

117 
a_idx
 +ğ
a
 > 
d¡
;

120 
	}
}

122 
	$execu‹_node
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a
 * 
·gem‘a_±r
) {

123 
couÁ
 = 0;

124 if(
noid_id
 < 
chdli¡_±r
[
chdli¡_Ën
 - 1]) {

125 
i
 = 0; i < 
Ëngth
; i++) {

126 if(
adjli¡_±r
[
i
] > 
node_id
) {

127 
couÁ
 +ğ
	`couÁ_š‹r£ùiÚ
(
node_id
, 
adjli¡_±r
, 
Ëngth
, 
i
);

131 
	`©omic_ãtch_add
(&
ŒŸngËcouÁ
, 
couÁ
);

132 
	}
}

135 
	$aá”_™”©iÚ
() {

136 
n_idx
++;

137 
	}
}

139 
	$fš®ize
() {

140 
t
.
	`¡İ_time
();

141 
cout
 << "ŒŸngËcouÁ : " << 
ŒŸngËcouÁ
 << 
’dl
;

142 
	}
}

145 şas 
	cdfs_®gÜ™hm
 : 
public
 
®gÜ™hm_hªdËr
{

146 
´iv©e
:

147 
šfÜm©iÚ_hªdËr
 * 
šfÜm©iÚ_±r
;

149 
©Œibu‹_w¿µ”
 * 
	m©Œibu‹_±r
;

150 
b™¬¿y_hªdËr
 * 
	mb™¬¿y_±r
;

151 
·¿m‘”_hªdËr
 * 
	m·¿m‘”_±r
;

153 
size_t
 
	m¡¬Šode
;

155 
b™©Œibu‹_hªdËr
 * 
	mšput_©Œibu‹
;

156 
©Œibu‹_hªdËr
 * 
	mÃxt_©Œibu‹
;

157 
©Œibu‹_hªdËr
 * 
	m™”_©Œibu‹
;

159 
size_t
 
	mnum_max_chunks
;

160 
size_t
 
	mÃxt_šputchunk
;

161 
size_t
 
	mÃxt_ouutchunk
;

162 
size_t
 
	mcu¼’t_chunk
;

164 
	m¡d
::
©omic
<> 
tÙ®_vis™šg_nodes
;

165 
	m¡d
::
©omic
<> 
tİ_¡ack
;

166 
	m¡d
::
veùÜ
<> 
vis™šg_log
;

167 
boŞ
 
	mexecu‹d
;

168 
boŞ
 
	mi¥ush
;

170 
time_’Œy
 
	mt
;

172 
	mpublic
:

173 
	$dfs_®gÜ™hm
(è: 
	`®gÜ™hm_hªdËr
(), 
	`t
("engine") {

176 ~
	$dfs_®gÜ™hm
() {

177 
	}
}

178 
	$š™Ÿlize
(
šfÜm©iÚ_hªdËr
 * 
_šfÜm©iÚ_±r
) {

179 
	`´štf
("init start\n");

180 
t
.
	`¡¬t_time
();

183 
šfÜm©iÚ_±r
 = 
_šfÜm©iÚ_±r
;

185 
©Œibu‹_±r
 = 
šfÜm©iÚ_±r
->attribute_ptr;

186 
b™¬¿y_±r
 = 
šfÜm©iÚ_±r
->bitarray_ptr;

187 
·¿m‘”_±r
 = 
šfÜm©iÚ_±r
->parameter_ptr;

189 
©Œibu‹_±r
->
	`bud_b™veùÜ
();

191 
šput_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_b™veùÜ
(0);

193 
©Œibu‹_±r
->
	`£t_veùÜ
("‹¡veùÜ1.txt", (), 
çl£
);

194 
©Œibu‹_±r
->
	`£t_veùÜ
("‹¡veùÜ2.txt", (), 
çl£
);

198 
©Œibu‹_±r
->
	`bud_veùÜs
(&
num_max_chunks
);

200 
Ãxt_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(0);

201 
™”_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(1);

203 
©Œibu‹_±r
->
	`š™Ÿlize_veùÜs
();

207 
¡¬Šode
 = 
·¿m‘”_±r
->
	`g‘_·¿m_št
("root", 0);

208 
šput_©Œibu‹
->
	`£t_b™
(
¡¬Šode
);

209 
b™¬¿y_±r
->
	`£t_cu¼_b™
(
¡¬Šode
);

210 
tİ_¡ack
 = 1;

211 
Ãxt_©Œibu‹
->
£t_v®ue
<>(()
tİ_¡ack
, 
¡¬Šode
);

212 
	`´štf
("init complete\n");

213 
	}
}

215 
boŞ
 
	$»que¡_Ãxtchunk
() {

216 if(
Ãxt_šputchunk
 =ğ
num_max_chunks
) {

217 
Ãxt_šputchunk
 = 0;

218 if(
tİ_¡ack
 > 0) {

219 if(!
execu‹d
 && 
tİ_¡ack
 > 0) {

220 
tİ_¡ack
--;

221 if(
tİ_¡ack
 < 
Ãxt_©Œibu‹
->
	`g‘_fœ¡node_numb”
()) {

222 
Ãxt_©Œibu‹
->
	`»que¡_chunk
(--
cu¼’t_chunk
);

223 
Ãxt_©Œibu‹
->
	`exchªge_chunk
();

226 
b™¬¿y_±r
->
	`£t_Ãxt_b™
(
Ãxt_©Œibu‹
->
g‘_v®ue
<
dfs_ty³
>(
tİ_¡ack
));

228 
execu‹d
 = 
çl£
;

229  
çl£
;

231 
™”_©Œibu‹
->
	`»que¡_chunk
(
Ãxt_šputchunk
);

232 
Ãxt_šputchunk
++;

233  
Œue
;

234 
	}
}

237 
	$befÜe_™”©iÚ
() {

238 
tÙ®_vis™šg_nodes
 = 0;

239 
	}
}

241 
	$execu‹_node
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a
 * 
·gem‘a_±r
) {

242 if(
Ãxt_©Œibu‹
->
g‘_v®ue
<
dfs_ty³
>(
tİ_¡ack
è!ğ
node_id
) ;

244 
tİ_¡ack
--;

245 
execu‹d
 = 
Œue
;

247 
vis™šg_nodes
 = 0;

248 
Ï¡_v®ue
 = -1;

250 
šdex
 = 0; index < 
Ëngth
; index++) {

251 if(!
šput_©Œibu‹
->
	`g‘_b™
(
adjli¡_±r
[
šdex
])) {

252 
šput_©Œibu‹
->
	`£t_b™
(
adjli¡_±r
[
šdex
]);

253 if(
tİ_¡ack
+1 > 
Ãxt_©Œibu‹
->
	`g‘_Ï¡node_numb”
()) {

254 
Ãxt_©Œibu‹
->
	`»que¡_chunk
(++
cu¼’t_chunk
);

255 
Ãxt_©Œibu‹
->
	`exchªge_chunk
();

257 
Ãxt_©Œibu‹
->
	`£t_v®ue
(++
tİ_¡ack
, 
adjli¡_±r
[
šdex
]);

258 
vis™šg_nodes
++;

259 
Ï¡_v®ue
 = 
adjli¡_±r
[
šdex
];

262 if(
tİ_¡ack
 > 0) {

263 
b™¬¿y_±r
->
	`£t_Ãxt_b™
(
Ãxt_©Œibu‹
->
g‘_v®ue
<
dfs_ty³
>(
tİ_¡ack
));

265 
	`©omic_ãtch_add
(&
tÙ®_vis™šg_nodes
, 
vis™šg_nodes
);

266 
	}
}

268 
	gtÙ®_sum
 = 0;

269 
	$aá”_™”©iÚ
() {

270 
vis™šg_log
.
	`push_back
(
tÙ®_vis™šg_nodes
.
	`lßd
());

271 
tÙ®_sum
 +ğ
tÙ®_vis™šg_nodes
.
	`lßd
();

272 
	}
}

275 
	$fš®ize
() {

276 
t
.
	`¡İ_time
();

278 
	`´štf
("tÙ® : %d\n",
tÙ®_sum
);

280 
FILE
 * 
å
 = 
	`fİ’
(
·¿m‘”_±r
->
	`g‘_·¿m_¡ršg
("fe", "‹¡_»suÉ.txt").
	`c_¡r
(), "at");

282 
	`årštf
(
å
, "¡¬Šod%d\n", ()
¡¬Šode
);

283 
i
 = 0; i < ()
vis™šg_log
.
	`size
(); i++) {

284 
	`årštf
(
å
, " %d i‹¿tiÚ vis™ed %d‚odes\n", 
i
, 
vis™šg_log
[i]);

286 
	`årštf
(
å
, "tim¥’ˆ%lf\n\n", 
t
.
	`ruÁime
().
	`couÁ
());

288 
	`fşo£
(
å
);

289 
	}
}

294 şas 
	cbfs_®gÜ™hm
 : 
public
 
®gÜ™hm_hªdËr
 {

295 
´iv©e
:

296 
šfÜm©iÚ_hªdËr
 * 
šfÜm©iÚ_±r
;

298 
©Œibu‹_w¿µ”
 * 
	m©Œibu‹_±r
;

299 
b™¬¿y_hªdËr
 * 
	mb™¬¿y_±r
;

300 
·¿m‘”_hªdËr
 * 
	m·¿m‘”_±r
;

302 
size_t
 
	m¡¬Šode
;

304 
b™©Œibu‹_hªdËr
 * 
	mšput_©Œibu‹
;

306 
	m¡d
::
©omic
<> 
tÙ®_vis™šg_nodes
;

307 
	m¡d
::
veùÜ
<> 
vis™šg_log
;

309 
time_’Œy
 
	mt
;

310 
	mpublic
:

311 
	$bfs_®gÜ™hm
(è: 
	`®gÜ™hm_hªdËr
(), 
	`t
("engine") {

314 ~
	$bfs_®gÜ™hm
() {

315 
	}
}

317 
	$š™Ÿlize
(
šfÜm©iÚ_hªdËr
 * 
_šfÜm©iÚ_±r
) {

318 
t
.
	`¡¬t_time
();

321 
šfÜm©iÚ_±r
 = 
_šfÜm©iÚ_±r
;

323 
©Œibu‹_±r
 = 
šfÜm©iÚ_±r
->attribute_ptr;

324 
b™¬¿y_±r
 = 
šfÜm©iÚ_±r
->bitarray_ptr;

325 
·¿m‘”_±r
 = 
šfÜm©iÚ_±r
->parameter_ptr;

328 
©Œibu‹_±r
->
	`bud_b™veùÜ
();

331 
šput_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_b™veùÜ
(0);

334 
¡¬Šode
 = 
·¿m‘”_±r
->
	`g‘_·¿m_št
("root", 0);

335 
šput_©Œibu‹
->
	`£t_b™
(
¡¬Šode
);

336 
b™¬¿y_±r
->
	`£t_cu¼_b™
(
¡¬Šode
);

337 
	}
}

339 
	$befÜe_™”©iÚ
() {

340 
tÙ®_vis™šg_nodes
 = 0;

341 
	}
}

343 
boŞ
 
	$»que¡_Ãxtchunk
() {

344  
çl£
;

345 
	}
}

347 
	$execu‹_node
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a
 * 
·gem‘a_±r
) {

348 
vis™šg_nodes
 = 0;

350 
šdex
 = 0; index < 
Ëngth
; index++) {

351 ià(!
šput_©Œibu‹
->
	`g‘_b™
(
adjli¡_±r
[
šdex
])) {

352 ià(
šput_©Œibu‹
->
	`£t_b™
(
adjli¡_±r
[
šdex
])) {

353 
b™¬¿y_±r
->
	`£t_Ãxt_b™
(
adjli¡_±r
[
šdex
]);

354 
vis™šg_nodes
++;

359 
	`©omic_ãtch_add
(&
tÙ®_vis™šg_nodes
, 
vis™šg_nodes
);

360 
	}
}

362 
	$aá”_™”©iÚ
() {

363 
vis™šg_log
.
	`push_back
(
tÙ®_vis™šg_nodes
.
	`lßd
());

364 
	}
}

366 
	$fš®ize
() {

367 
t
.
	`¡İ_time
();

369 
FILE
 * 
å
 = 
	`fİ’
(
·¿m‘”_±r
->
	`g‘_·¿m_¡ršg
("fe", "‹¡_»suÉ.txt").
	`c_¡r
(), "at");

371 
	`årštf
(
å
, "¡¬Šod%d\n", ()
¡¬Šode
);

372 
i
 = 0; i < ()
vis™šg_log
.
	`size
(); i++) {

373 
	`årštf
(
å
, " %d i‹¿tiÚ vis™ed %d‚odes\n", 
i
, 
vis™šg_log
[i]);

375 
	`årštf
(
å
, "tim¥’ˆ%lf\n\n", 
t
.
	`ruÁime
().
	`couÁ
());

377 
	`fşo£
(
å
);

378 
	}
}

384 şas 
	ca¡¬_®gÜ™hm
 : 
public
 
®gÜ™hm_hªdËr
 {

385 
´iv©e
:

386 
šfÜm©iÚ_hªdËr
 * 
šfÜm©iÚ_±r
;

388 
©Œibu‹_w¿µ”
 * 
	m©Œibu‹_±r
;

389 
b™¬¿y_hªdËr
 * 
	mb™¬¿y_±r
;

390 
·¿m‘”_hªdËr
 * 
	m·¿m‘”_±r
;

392 
©Œibu‹_hªdËr
 * 
	mnode_©Œibu‹
 ;

393 
©Œibu‹_hªdËr
 * 
	mgscÜe_©Œibu‹
;

394 
©Œibu‹_hªdËr
 * 
	mÿmeäom_©Œibu‹
;

396 
size_t
 
	mnum_max_chunks
;

397 
size_t
 
	mÃxt_šputchunk
;

398 
size_t
 
	mÃxt_ouutchunk
;

400 
size_t
 
	m¡¬t
;

401 
size_t
 
	mgßl
;

402 
	mÃxt_nodeid
 = 
nÙvis™ed
;

404 
	muµ”bound
 = -1;

406 
	m¡d
::
veùÜ
<
size_t
> 
shÜ‹¡_·th
;

408 
time_’Œy
 
	mt
;

410 
	mpublic
:

412 
	$a¡¬_®gÜ™hm
(è: 
	`®gÜ™hm_hªdËr
(), 
	`t
("engine") {

415 ~
	$a¡¬_®gÜ™hm
() {

416 
	}
}

417 
	$š™Ÿlize
(
šfÜm©iÚ_hªdËr
 * 
_šfÜm©iÚ_±r
) {

419 
¡d
::
cout
 << "š™" << std::
’dl
;

420 
t
.
	`¡¬t_time
();

423 
šfÜm©iÚ_±r
 = 
_šfÜm©iÚ_±r
;

425 
©Œibu‹_±r
 = 
šfÜm©iÚ_±r
->attribute_ptr;

426 
b™¬¿y_±r
 = 
šfÜm©iÚ_±r
->bitarray_ptr;

427 
·¿m‘”_±r
 = 
šfÜm©iÚ_±r
->parameter_ptr;

430 
©Œibu‹_±r
->
	`£t_veùÜ
("‹¡veùÜ1.txt", (), 
çl£
);

431 
©Œibu‹_±r
->
	`£t_veùÜ
("‹¡veùÜ2.txt", (
scÜe_ty³
), 
çl£
);

432 
©Œibu‹_±r
->
	`£t_veùÜ
("‹¡veùÜ3.txt", (
size_t
), 
çl£
);

433 
©Œibu‹_±r
->
	`bud_veùÜs
(&
num_max_chunks
);

435 
Ãxt_šputchunk
 = 0;

436 
Ãxt_ouutchunk
 = 0;

441 
node_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(0);

442 
gscÜe_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(1);

443 
ÿmeäom_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(2);

446 
¡¬t
 = 
·¿m‘”_±r
->
	`g‘_·¿m_št
("root", 2);

447 
gßl
 = 
·¿m‘”_±r
->
	`g‘_·¿m_št
("goal", 3);

449 
b™¬¿y_±r
->
	`£t_cu¼_b™
(
¡¬t
);

451 
node_©Œibu‹
->
	`£t_deçuÉ_v®ue
(
nÙvis™ed
);

452 
node_©Œibu‹
->
	`£t_wr™efe
(
Œue
);

454 
gscÜe_©Œibu‹
->
	`£t_deçuÉ_v®ue
(0);

455 
gscÜe_©Œibu‹
->
	`£t_wr™efe
(
Œue
);

457 
ÿmeäom_©Œibu‹
->
	`£t_deçuÉ_v®ue
(0);

458 
ÿmeäom_©Œibu‹
->
	`£t_wr™efe
(
Œue
);

460 
©Œibu‹_±r
->
	`š™Ÿlize_veùÜs
();

462 
shÜ‹¡_·th
.
	`push_back
(
gßl
);

463 
uµ”bound
 = 
¡¬t
;

465 
¡d
::
cout
 << "max chunk : " << 
num_max_chunks
 << std::
’dl
;

466 
	}
}

467 
	$befÜe_™”©iÚ
() {

469 if(
¡¬t
 =ğ
gßl
) {

470 
¡d
::
cout
 << "¡¬ˆªd gßÈ¬equ®" << std::
’dl
;

471 
	`ex™
(1);

474 
Ãxt_nodeid
 = 
nÙvis™ed
;

475 
	}
}

477 
boŞ
 
	$»que¡_Ãxtchunk
() {

479 ià(
Ãxt_šputchunk
 =ğ
num_max_chunks
) {

480 
Ãxt_šputchunk
 = 0;

481 
Ãxt_ouutchunk
++;

483 ià(
Ãxt_ouutchunk
 =ğ
num_max_chunks
) {

484 
Ãxt_ouutchunk
 = 0;

486  
çl£
;

491 
node_©Œibu‹
->
	`»que¡_chunk
(
Ãxt_šputchunk
);

492 
gscÜe_©Œibu‹
->
	`»que¡_chunk
(
Ãxt_šputchunk
);

493 
ÿmeäom_©Œibu‹
->
	`»que¡_chunk
(
Ãxt_šputchunk
);

495 
Ãxt_šputchunk
++;

497  
Œue
;

498 
	}
}

499 
	$execu‹_node
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a
 * 
·gem‘a_±r
) {

501 
scÜe_ty³
 
fscÜe
 = 0;

502 
scÜe_ty³
 
gscÜe
 = 0;

505 if(
node_id
 > 
uµ”bound
) upperbound =‚ode_id;

507 if(
node_id
 >ğ
node_©Œibu‹
->
	`g‘_fœ¡node_numb”
(è&&‚ode_id <ğnode_©Œibu‹->
	`g‘_Ï¡node_numb”
()) {

510 
node_©Œibu‹
->
£t_v®ue
<>(
node_id
, 
ev®u©ed
);

511 
gscÜe
 = 
gscÜe_©Œibu‹
->
g‘_v®ue
<
scÜe_ty³
>(
node_id
è+ 
weight
;

514 
šdex
 = 0 ; index < 
Ëngth
 ; index++) {

516 
ÃighbÜ_id
 = 
adjli¡_±r
[
šdex
];

517 if(
ÃighbÜ_id
 > 
uµ”bound
) upperbound =‚eighbor_id;

519 if(
ÃighbÜ_id
 >ğ
node_©Œibu‹
->
	`g‘_fœ¡node_numb”
(è&&‚eighbÜ_id <ğnode_©Œibu‹->
	`g‘_Ï¡node_numb”
()) {

521 if(
node_©Œibu‹
->
g‘_v®ue
<>(
ÃighbÜ_id
è=ğ
ev®u©ed
) ;

523 if(
node_©Œibu‹
->
g‘_v®ue
<>(
ÃighbÜ_id
è=ğ
nÙvis™ed
) {

525 
fscÜe
 = 
gscÜe
 + 
hscÜe
;

527 
node_©Œibu‹
->
£t_v®ue
<>(
ÃighbÜ_id
, 
fscÜe
);

529 } if(
gscÜe
 >ğ
gscÜe_©Œibu‹
->
g‘_v®ue
<
scÜe_ty³
>(
ÃighbÜ_id
)) ;

531 
gscÜe_©Œibu‹
->
£t_v®ue
<
scÜe_ty³
>(
ÃighbÜ_id
, 
gscÜe
);

533 
ÿmeäom_©Œibu‹
->
£t_v®ue
<
size_t
>(
ÃighbÜ_id
, 
node_id
);

537 
tmp_fscÜe
 = 
INT_MAX
;

538 
v®ue
 = 0;

539 
v®ue_id
 = 
uµ”bound
;

541  ; 
v®ue_id
 > 0 ; value_id--) {

543 if(
v®ue_id
 >ğ
node_©Œibu‹
->
	`g‘_fœ¡node_numb”
()) {

545 
v®ue
 = 
node_©Œibu‹
->
g‘_v®ue
<>(
v®ue_id
);

547 if(
v®ue
 > 0 && v®u<ğ
tmp_fscÜe
) {

549 
tmp_fscÜe
 = 
v®ue
;

550 
Ãxt_nodeid
 = 
v®ue_id
;

555 
	}
}

557 
	$aá”_™”©iÚ
() {

560 if(
Ãxt_nodeid
 =ğ
nÙvis™ed
) {

562 
¡d
::
cout
 << "nÙ cÚÃùed" << std::
’dl
;

564 } if(
Ãxt_nodeid
 =ğ
gßl
) {

566 
¡d
::
cout
 << "found gßl!" << std::
’dl
;

570 
b™¬¿y_±r
->
	`£t_Ãxt_b™
(
Ãxt_nodeid
);

573 
	}
}

575 
	$fš®ize
() {

577 
FILE
 * 
å
 = 
	`fİ’
(
·¿m‘”_±r
->
	`g‘_·¿m_¡ršg
("fe", "‹¡_»suÉ.txt").
	`c_¡r
(), "at");

578 
size_t
 
j
 = 0;

580 
size_t
 
i
 = 
gßl
 ; i =ğ
¡¬t
 ; i = 
j
) {

581 
j
 = 
ÿmeäom_©Œibu‹
->
g‘_v®ue
<
size_t
>(
i
);

582 
shÜ‹¡_·th
.
	`push_back
(
j
);

585 if(
shÜ‹¡_·th
.
	`size
() <= 2) {

586 
	`årštf
(
å
, "not connected");

587 
	`årštf
(
å
, "\n");

589 
i
 = 
shÜ‹¡_·th
.
	`size
() - 1 ; i > 0 ; i--) {

590 
	`årštf
(
å
, "%lu -> ", 
shÜ‹¡_·th
[
i
]);

594 
t
.
	`¡İ_time
();

596 
	`årštf
(
å
, "im¥’ˆ%lf\n\n", 
t
.
	`ruÁime
().
	`couÁ
());

597 
	}
}

603 şas 
	cundœeù_wcc_®gÜ™hm
 : 
public
 
®gÜ™hm_hªdËr
 {

604 
´iv©e
:

605 
šfÜm©iÚ_hªdËr
 * 
šfÜm©iÚ_±r
;

607 
©Œibu‹_w¿µ”
 * 
	m©Œibu‹_±r
;

608 
b™¬¿y_hªdËr
 * 
	mb™¬¿y_±r
;

609 
·¿m‘”_hªdËr
 * 
	m·¿m‘”_±r
;

611 
size_t
 
	m¡¬Šode
;

613 
©Œibu‹_hªdËr
 * 
	mÏb–_©Œibu‹
;

615 
size_t
 
	mnum_max_chunks
;

616 
size_t
 
	mÃxt_šputchunk
;

617 
size_t
 
	mcu¼_¬¿yšdex
;

618 
size_t
 
	mnum_nodes
;

620 
boŞ
 
	mchªged
=
çl£
;

622 
	m¡d
::
©omic
<> 
tÙ®_vis™šg_nodes
;

623 
time_’Œy
 
	mt
;

624 
	mpublic
:

625 
	$undœeù_wcc_®gÜ™hm
(è: 
	`®gÜ™hm_hªdËr
(), 
	`t
("engine") {

628 ~
	$undœeù_wcc_®gÜ™hm
() {

629 
	}
}

631 
	$š™Ÿlize
(
šfÜm©iÚ_hªdËr
 * 
_šfÜm©iÚ_±r
) {

632 
t
.
	`¡¬t_time
();

635 
šfÜm©iÚ_±r
 = 
_šfÜm©iÚ_±r
;

637 
©Œibu‹_±r
 = 
šfÜm©iÚ_±r
->attribute_ptr;

638 
b™¬¿y_±r
 = 
šfÜm©iÚ_±r
->bitarray_ptr;

639 
·¿m‘”_±r
 = 
šfÜm©iÚ_±r
->parameter_ptr;

642 
©Œibu‹_±r
->
	`£t_veùÜ
("‹¡veùÜ1.txt", (
wcc_ty³
), 
Œue
);

643 
©Œibu‹_±r
->
	`bud_veùÜs
(&
num_max_chunks
);

646 
Ïb–_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(0);

650 
Ïb–_©Œibu‹
->
	`£t_wr™efe
(
Œue
);

651 
Ïb–_©Œibu‹
->
£t_deçuÉ_v®ue
<
wcc_ty³
>(0);

653 
©Œibu‹_±r
->
	`š™Ÿlize_veùÜs
();

656 
size_t
 
chunk_šdex
 = 0; chunk_šdex < 
num_max_chunks
; chunk_index++) {

657 
Ïb–_©Œibu‹
->
	`»ad_chunks
(
chunk_šdex
);

658 
node_id
 = 
Ïb–_©Œibu‹
->
	`g‘_fœ¡node_numb”
();‚ode_id <ğÏb–_©Œibu‹->
	`g‘_Ï¡node_numb”
();‚ode_id++) {

659 
b™¬¿y_±r
->
	`£t_cu¼_b™
(
node_id
);

660 
Ïb–_©Œibu‹
->
£t_v®ue
<
wcc_ty³
>(
node_id
,(wcc_type)(node_id));

664 
num_nodes
 = 
šfÜm©iÚ_±r
->num_nodes;

665 
	`´štf
("initialize complete...\n");

666 
	}
}

668 
	$befÜe_™”©iÚ
() {

670 
tÙ®_vis™šg_nodes
=0;

671 
	}
}

674 
boŞ
 
	$»que¡_Ãxtchunk
() {

675 if(
Ãxt_šputchunk
 =ğ
num_max_chunks
){

676 
Ãxt_šputchunk
=0;

677  
çl£
;

680 
Ïb–_©Œibu‹
->
	`»que¡_chunk
(
Ãxt_šputchunk
);

681 
Ãxt_šputchunk
++;

683  
Œue
;

686 
	}
}

688 
	$execu‹_node
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a
 * 
·gem‘a_±r
) {

689 
vis™šg_nodes
=0;

692 
šdex
 = 0; index < 
Ëngth
; index++) {

693 if(
Ïb–_©Œibu‹
->
g‘_v®ue
<
wcc_ty³
>(
node_id
è>†ab–_©Œibu‹->g‘_v®ue<wcc_ty³>(
adjli¡_±r
[
šdex
])){

694 
Ïb–_©Œibu‹
->
£t_v®ue
<
wcc_ty³
>(
node_id
,†ab–_©Œibu‹->
g‘_v®ue
<wcc_ty³>(
adjli¡_±r
[
šdex
]));

695 
b™¬¿y_±r
->
	`£t_Ãxt_b™
(
node_id
);

696 
vis™šg_nodes
++;

699 if(
Ïb–_©Œibu‹
->
g‘_v®ue
<
wcc_ty³
>(
node_id
è<†ab–_©Œibu‹->g‘_v®ue<wcc_ty³>(
adjli¡_±r
[
šdex
])){

700 
Ïb–_©Œibu‹
->
£t_v®ue
<
wcc_ty³
>(
adjli¡_±r
[
šdex
],†ab–_©Œibu‹->
g‘_v®ue
<wcc_ty³>(
node_id
));

701 
b™¬¿y_±r
->
	`£t_Ãxt_b™
(
adjli¡_±r
[
šdex
]);

702 
vis™šg_nodes
++;

709 
	`©omic_ãtch_add
(&
tÙ®_vis™šg_nodes
, 
vis™šg_nodes
);

710 
	}
}

712 
	$aá”_™”©iÚ
() {

715 
	}
}

717 
	$fš®ize
() {

718 
t
.
	`¡İ_time
();

720 
m­
<, > 
wcc_m­
;

721 
m­
<, >::
™”©Ü
 
™
;

722 
size_Úe_compÚ’t
 = 0;

723 
tÙ®_compÚ’t
 = 0;

724 
size_t
 
chunk_šdex
 = 0; chunk_šdex < 
num_max_chunks
; chunk_index++) {

725 
Ïb–_©Œibu‹
->
	`»ad_chunks
(
chunk_šdex
);

726 
size_t
 
node_id
 = 
Ïb–_©Œibu‹
->
	`g‘_fœ¡node_numb”
();‚ode_id <ğÏb–_©Œibu‹->
	`g‘_Ï¡node_numb”
();‚ode_id++) {

727 
wcc_m­
[
Ïb–_©Œibu‹
->
g‘_v®ue
<
wcc_ty³
>(
node_id
)]++;

731 
™
=
wcc_m­
.
	`begš
(); iˆ!ğwcc_m­.
	`’d
(); it++){

732 
tÙ®_compÚ’t
++;

733 if(
™
->
£cÚd
 == 1)

734 
size_Úe_compÚ’t
++;

737 
FILE
 * 
å
 = 
	`fİ’
(
·¿m‘”_±r
->
	`g‘_·¿m_¡ršg
("fe", "‹¡_»suÉ.txt").
	`c_¡r
(), "at");

740 
	`årštf
(
å
, "tÙ®_compÚ’t : %d\n", 
tÙ®_compÚ’t
);

741 
	`årštf
(
å
, "sizÚcompÚ’ˆ: %d\n", 
size_Úe_compÚ’t
);

742 
	`årštf
(
å
, "numb” oàcompÚ’t w™houˆcompÚ’t who£ size ¬1 : %d\n",
tÙ®_compÚ’t
- 
size_Úe_compÚ’t
);

743 
	`årštf
(
å
, "tim¥’ˆ%lf\n\n", 
t
.
	`ruÁime
().
	`couÁ
());

745 
	`fşo£
(
å
);

748 
	`´štf
("tÙ®_compÚ’t : %d\n", 
tÙ®_compÚ’t
);

749 
	`´štf
("sizÚcompÚ’ˆ: %d\n", 
size_Úe_compÚ’t
);

750 
	`´štf
Ğ"numb” oàcompÚ’t w™houˆcompÚ’t who£ size ¬1 : %d\n",
tÙ®_compÚ’t
- 
size_Úe_compÚ’t
);

751 
	`´štf
("tim¥’ˆ%lf\n\n", 
t
.
	`ruÁime
().
	`couÁ
());

754 
	}
}

767 şas 
	cwcc_®gÜ™hm
 : 
public
 
®gÜ™hm_hªdËr
 {

768 
´iv©e
:

769 
šfÜm©iÚ_hªdËr
 * 
šfÜm©iÚ_±r
;

771 
©Œibu‹_w¿µ”
 * 
	m©Œibu‹_±r
;

772 
b™¬¿y_hªdËr
 * 
	mb™¬¿y_±r
;

773 
·¿m‘”_hªdËr
 * 
	m·¿m‘”_±r
;

775 
size_t
 
	m¡¬Šode
;

777 
b™©Œibu‹_hªdËr
 * 
	mchªged_©Œibu‹
;

778 
©Œibu‹_hªdËr
 * 
	mÏb–_©Œibu‹
;

780 
size_t
 
	mnum_max_chunks
;

781 
size_t
 
	mÃxt_šputchunk
;

782 
size_t
 
	mcu¼_¬¿yšdex
;

783 
size_t
 
	mnum_nodes
;

785 
boŞ
 
	mchªged
=
çl£
;

787 
	m¡d
::
©omic
<> 
tÙ®_vis™šg_nodes
;

788 
time_’Œy
 
	mt
;

789 
	mpublic
:

790 
	$wcc_®gÜ™hm
(è: 
	`®gÜ™hm_hªdËr
(), 
	`t
("engine") {

793 ~
	$wcc_®gÜ™hm
() {

794 
	}
}

796 
	$š™Ÿlize
(
šfÜm©iÚ_hªdËr
 * 
_šfÜm©iÚ_±r
) {

797 
t
.
	`¡¬t_time
();

800 
šfÜm©iÚ_±r
 = 
_šfÜm©iÚ_±r
;

802 
©Œibu‹_±r
 = 
šfÜm©iÚ_±r
->attribute_ptr;

803 
b™¬¿y_±r
 = 
šfÜm©iÚ_±r
->bitarray_ptr;

804 
·¿m‘”_±r
 = 
šfÜm©iÚ_±r
->parameter_ptr;

807 
©Œibu‹_±r
->
	`bud_b™veùÜ
();

808 
©Œibu‹_±r
->
	`£t_veùÜ
("‹¡veùÜ1.txt", (
wcc_ty³
), 
Œue
);

809 
©Œibu‹_±r
->
	`bud_veùÜs
(&
num_max_chunks
);

812 
chªged_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_b™veùÜ
(0);

813 
Ïb–_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(0);

817 
Ïb–_©Œibu‹
->
	`£t_wr™efe
(
Œue
);

818 
Ïb–_©Œibu‹
->
£t_deçuÉ_v®ue
<
wcc_ty³
>(0);

820 
©Œibu‹_±r
->
	`š™Ÿlize_veùÜs
();

823 
size_t
 
chunk_šdex
 = 0; chunk_šdex < 
num_max_chunks
; chunk_index++) {

824 
Ïb–_©Œibu‹
->
	`»ad_chunks
(
chunk_šdex
);

825 
node_id
 = 
Ïb–_©Œibu‹
->
	`g‘_fœ¡node_numb”
();‚ode_id <ğÏb–_©Œibu‹->
	`g‘_Ï¡node_numb”
();‚ode_id++) {

826 
b™¬¿y_±r
->
	`£t_cu¼_b™
(
node_id
);

827 
Ïb–_©Œibu‹
->
£t_v®ue
<
wcc_ty³
>(
node_id
,(wcc_type)(node_id));

831 
num_nodes
 = 
šfÜm©iÚ_±r
->num_nodes;

832 
	`´štf
("initialize complete...\n");

833 
	}
}

835 
	$befÜe_™”©iÚ
() {

837 
tÙ®_vis™šg_nodes
=0;

838 
	}
}

841 
boŞ
 
	$»que¡_Ãxtchunk
() {

842 if(
Ãxt_šputchunk
 =ğ
num_max_chunks
){

843 
Ãxt_šputchunk
=0;

844  
çl£
;

847 
Ïb–_©Œibu‹
->
	`»que¡_chunk
(
Ãxt_šputchunk
);

848 
Ãxt_šputchunk
++;

850  
Œue
;

853 
	}
}

855 
	$execu‹_node
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a
 * 
·gem‘a_±r
) {

856 
vis™šg_nodes
=0;

859 
šdex
 = 0; index < 
Ëngth
; index++) {

860 if(
Ïb–_©Œibu‹
->
g‘_v®ue
<
wcc_ty³
>(
node_id
è>†ab–_©Œibu‹->g‘_v®ue<wcc_ty³>(
adjli¡_±r
[
šdex
])){

861 
Ïb–_©Œibu‹
->
£t_v®ue
<
wcc_ty³
>(
node_id
,†ab–_©Œibu‹->
g‘_v®ue
<wcc_ty³>(
adjli¡_±r
[
šdex
]));

862 
b™¬¿y_±r
->
	`£t_Ãxt_b™
(
node_id
);

864 
chªged_©Œibu‹
->
	`£t_b™
(
node_id
);

865 
chªged
=
Œue
;

866 
vis™šg_nodes
++;

869 if(
Ïb–_©Œibu‹
->
g‘_v®ue
<
wcc_ty³
>(
node_id
è<†ab–_©Œibu‹->g‘_v®ue<wcc_ty³>(
adjli¡_±r
[
šdex
])){

870 
Ïb–_©Œibu‹
->
£t_v®ue
<
wcc_ty³
>(
adjli¡_±r
[
šdex
],†ab–_©Œibu‹->
g‘_v®ue
<wcc_ty³>(
node_id
));

871 
b™¬¿y_±r
->
	`£t_Ãxt_b™
(
adjli¡_±r
[
šdex
]);

872 
chªged_©Œibu‹
->
	`£t_b™
(
adjli¡_±r
[
šdex
]);

873 
chªged
=
Œue
;

874 
vis™šg_nodes
++;

881 
	`©omic_ãtch_add
(&
tÙ®_vis™šg_nodes
, 
vis™šg_nodes
);

882 
	}
}

884 
	$aá”_™”©iÚ
() {

885 if(
tÙ®_vis™šg_nodes
==0){

886 if(
chªged
){

887 
chªged
=
çl£
;

888 
node
=0;‚ode<
num_nodes
;‚ode++){

889 if(!
chªged_©Œibu‹
->
	`g‘_b™
(
node
)){

890 
b™¬¿y_±r
->
	`£t_Ãxt_b™
(
node
);

895 
chªged_©Œibu‹
->
	`ş—r
();

899 
	}
}

901 
	$fš®ize
() {

902 
t
.
	`¡İ_time
();

904 
m­
<, > 
wcc_m­
;

905 
m­
<, >::
™”©Ü
 
™
;

906 
size_Úe_compÚ’t
 = 0;

907 
tÙ®_compÚ’t
 = 0;

908 
size_t
 
chunk_šdex
 = 0; chunk_šdex < 
num_max_chunks
; chunk_index++) {

909 
Ïb–_©Œibu‹
->
	`»ad_chunks
(
chunk_šdex
);

910 
size_t
 
node_id
 = 
Ïb–_©Œibu‹
->
	`g‘_fœ¡node_numb”
();‚ode_id <ğÏb–_©Œibu‹->
	`g‘_Ï¡node_numb”
();‚ode_id++) {

911 
wcc_m­
[
Ïb–_©Œibu‹
->
g‘_v®ue
<
wcc_ty³
>(
node_id
)]++;

915 
™
=
wcc_m­
.
	`begš
(); iˆ!ğwcc_m­.
	`’d
(); it++){

916 
tÙ®_compÚ’t
++;

917 if(
™
->
£cÚd
 == 1)

918 
size_Úe_compÚ’t
++;

922 
FILE
 * 
å
 = 
	`fİ’
(
·¿m‘”_±r
->
	`g‘_·¿m_¡ršg
("fe", "‹¡_»suÉ.txt").
	`c_¡r
(), "at");

925 
	`årštf
(
å
, "tÙ®_compÚ’t : %d\n", 
tÙ®_compÚ’t
);

926 
	`årštf
(
å
, "sizÚcompÚ’ˆ: %d\n", 
size_Úe_compÚ’t
);

927 
	`årštf
(
å
, "numb” oàcompÚ’t w™houˆcompÚ’t who£ size ¬1 : %d\n",
tÙ®_compÚ’t
- 
size_Úe_compÚ’t
);

928 
	`årštf
(
å
, "tim¥’ˆ%lf\n\n", 
t
.
	`ruÁime
().
	`couÁ
());

930 
	`fşo£
(
å
);

932 
	`´štf
("tÙ®_compÚ’t : %d\n", 
tÙ®_compÚ’t
);

933 
	`´štf
("sizÚcompÚ’ˆ: %d\n", 
size_Úe_compÚ’t
);

934 
	`´štf
Ğ"numb” oàcompÚ’t w™houˆcompÚ’t who£ size ¬1 : %d\n",
tÙ®_compÚ’t
- 
size_Úe_compÚ’t
);

935 
	`´štf
("tim¥’ˆ%lf\n\n", 
t
.
	`ruÁime
().
	`couÁ
());

938 
	}
}

941 şas 
	cpg_®gÜ™hm
 : 
public
 
®gÜ™hm_hªdËr
 {

942 
´iv©e
:

943 
šfÜm©iÚ_hªdËr
 * 
šfÜm©iÚ_±r
;

945 
©Œibu‹_w¿µ”
 * 
	m©Œibu‹_±r
;

946 
b™¬¿y_hªdËr
 * 
	mb™¬¿y_±r
;

947 
·¿m‘”_hªdËr
 * 
	m·¿m‘”_±r
;

949 
©Œibu‹_hªdËr
 * 
	mšput_©Œibu‹
;

950 
©Œibu‹_hªdËr
 * 
	mouut_©Œibu‹
;

951 
©Œibu‹_hªdËr
 * 
	moutdeg»e_©Œibu‹
;

953 
size_t
 
	mnum_max_chunks
;

954 
size_t
 
	mÃxt_šputchunk
;

955 
size_t
 
	mÃxt_ouutchunk
;

957 
	mš™Ÿl_´v®ue
;

958 
	mdam³d_´v®ue
;

960 
boŞ
 
	mfœ¡_™”©iÚ
;

961 
boŞ
 
	mÏ¡_™”©iÚ
;

963 
time_’Œy
 
	mt
;

964 
	mpublic
:

965 
	$pg_®gÜ™hm
(è: 
	`®gÜ™hm_hªdËr
(), 
	`t
("engine") {

968 ~
	$pg_®gÜ™hm
() {

969 
	}
}

971 
	$š™Ÿlize
(
šfÜm©iÚ_hªdËr
 * 
_šfÜm©iÚ_±r
) {

972 
t
.
	`¡¬t_time
();

975 
šfÜm©iÚ_±r
 = 
_šfÜm©iÚ_±r
;

977 
©Œibu‹_±r
 = 
šfÜm©iÚ_±r
->attribute_ptr;

978 
b™¬¿y_±r
 = 
šfÜm©iÚ_±r
->bitarray_ptr;

979 
·¿m‘”_±r
 = 
šfÜm©iÚ_±r
->parameter_ptr;

982 
©Œibu‹_±r
->
	`£t_veùÜ
("‹¡veùÜ1.txt", (
pg_ty³
), 
çl£
);

983 
©Œibu‹_±r
->
	`£t_veùÜ
("‹¡veùÜ2.txt", (
pg_ty³
), 
çl£
);

984 
©Œibu‹_±r
->
	`£t_veùÜ
(
·¿m‘”_±r
->
	`g‘_·¿m_¡ršg
("outdeg»efe", "yahoo.šdeg»e"), (), 
Œue
);

985 
©Œibu‹_±r
->
	`bud_veùÜs
(&
num_max_chunks
);

987 
Ãxt_šputchunk
 = 0;

988 
Ãxt_ouutchunk
 = 0;

991 
š™Ÿl_´v®ue
 = 1.0à/ 
šfÜm©iÚ_±r
->
num_nodes
;

992 
dam³d_´v®ue
 = 
š™Ÿl_´v®ue
 * 0.15f;

995 
šput_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(0);

996 
ouut_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(1);

997 
outdeg»e_©Œibu‹
 = 
©Œibu‹_±r
->
	`g‘_veùÜ
(2);

999 
šput_©Œibu‹
->
	`£t_boundty³
(
BOUNDTYPE_SRC
);

1000 
šput_©Œibu‹
->
	`£t_wr™efe
(
çl£
);

1001 
šput_©Œibu‹
->
£t_deçuÉ_v®ue
<
pg_ty³
>(0.0);

1003 
outdeg»e_©Œibu‹
->
	`£t_boundty³
(
BOUNDTYPE_DST
);

1004 
outdeg»e_©Œibu‹
->
	`£t_wr™efe
(
çl£
);

1006 
ouut_©Œibu‹
->
	`£t_boundty³
(
BOUNDTYPE_DST
);

1007 
ouut_©Œibu‹
->
	`£t_wr™efe
(
Œue
);

1009 
©Œibu‹_±r
->
	`š™Ÿlize_veùÜs
();

1010 
	}
}

1012 
	$befÜe_™”©iÚ
() {

1013 
fœ¡_™”©iÚ
 = 
šfÜm©iÚ_±r
->
cur_™”©iÚ
 == 0;

1014 
Ï¡_™”©iÚ
 = 
šfÜm©iÚ_±r
->
cur_™”©iÚ
 =ğ(šfÜm©iÚ_±r->
max_™”©iÚ
 - 1);

1015 
	}
}

1017 
boŞ
 
	$»que¡_Ãxtchunk
() {

1019 ià(
Ãxt_šputchunk
 =ğ
num_max_chunks
) {

1020 
Ãxt_šputchunk
 = 0;

1021 
Ãxt_ouutchunk
++;

1023 ià(
Ãxt_ouutchunk
 =ğ
num_max_chunks
) {

1024 
Ãxt_ouutchunk
 = 0;

1026  
çl£
;

1031 
šput_©Œibu‹
->
	`»que¡_chunk
(
Ãxt_šputchunk
);

1032 
outdeg»e_©Œibu‹
->
	`»que¡_chunk
(
Ãxt_ouutchunk
);

1033 
ouut_©Œibu‹
->
	`»que¡_chunk
(
Ãxt_ouutchunk
);

1035 
Ãxt_šputchunk
++;

1037  
Œue
;

1038 
	}
}

1040 
	$execu‹_node
(
node_id
, * 
adjli¡_±r
, 
Ëngth
, 
cÚÃùedsize
, 
·gem‘a
 * 
·gem‘a_±r
) {

1041 
sum
 = 0.0;

1043 
šdex
 = 0; index < 
Ëngth
; index++) {

1044 
sum
 +ğ
šput_©Œibu‹
->
g‘_v®ue
<
pg_ty³
>(
adjli¡_±r
[
šdex
]);

1047 
outdeg»e
 = 
outdeg»e_©Œibu‹
->
g‘_v®ue
<>(
node_id
);

1049 ià(
cÚÃùedsize
 > 1) {

1050 
ouut_©Œibu‹
->
lock_v®ue
<
pg_ty³
>(&
·gem‘a_±r
->
lock
);

1052 ià(
·gem‘a_±r
->
num_couÁ
 == 0) {

1053 
ouut_©Œibu‹
->
£t_v®ue
<
pg_ty³
>(
node_id
, ((
fœ¡_™”©iÚ
 ? 
š™Ÿl_´v®ue
 : 
dam³d_´v®ue
è+ 0.85 * 
sum
è/ (
Ï¡_™”©iÚ
 ? 1 : 
outdeg»e
));

1054 
·gem‘a_±r
->
num_couÁ
++;

1057 
ouut_©Œibu‹
->
add_v®ue
<
pg_ty³
>(
node_id
, (0.85 * 
sum
è/ (
Ï¡_™”©iÚ
 ? 1 : 
outdeg»e
));

1059 
ouut_©Œibu‹
->
uÆock_v®ue
<
pg_ty³
>(&
·gem‘a_±r
->
lock
);

1063 ià(
šput_©Œibu‹
->
	`g‘_chunk_id
() == 0) {

1064 
ouut_©Œibu‹
->
£t_v®ue
<
pg_ty³
>(
node_id
, ((
fœ¡_™”©iÚ
 ? 
š™Ÿl_´v®ue
 : 
dam³d_´v®ue
è+ 0.85 * 
sum
è/ ((
Ï¡_™”©iÚ
 || 
outdeg»e
 == 0) ? 1 : outdegree));

1067 
ouut_©Œibu‹
->
add_v®ue
<
pg_ty³
>(
node_id
, (0.85 * 
sum
è/ ((
Ï¡_™”©iÚ
 || 
outdeg»e
 == 0) ? 1 : outdegree));

1070 
	}
}

1072 
	$aá”_™”©iÚ
() {

1073 
©Œibu‹_hªdËr
 * 
_±r
 = 
šput_©Œibu‹
;

1074 
šput_©Œibu‹
 = 
ouut_©Œibu‹
;

1075 
ouut_©Œibu‹
 = 
_±r
;

1077 
šput_©Œibu‹
->
	`£t_boundty³
(
BOUNDTYPE_SRC
);

1078 
šput_©Œibu‹
->
	`£t_wr™efe
(
çl£
);

1080 
ouut_©Œibu‹
->
	`£t_boundty³
(
BOUNDTYPE_DST
);

1081 
ouut_©Œibu‹
->
	`£t_wr™efe
(
Œue
);

1082 
	}
}

1084 
	$fš®ize
() {

1085 
t
.
	`¡İ_time
();

1087 
pg_ty³
 
tİli¡
[40];

1088 
	`mem£t
(
tİli¡
, 0, 40 * (
pg_ty³
));

1090 
size_t
 
chunk_šdex
 = 0; chunk_šdex < 
num_max_chunks
; chunk_index++) {

1091 
šput_©Œibu‹
->
	`»ad_chunks
(
chunk_šdex
);

1093 
šput_©Œibu‹
->
sÜt_chunk
<
pg_ty³
>();

1095 
šput_©Œibu‹
->
g‘_fœ¡20
<
pg_ty³
>(&
tİli¡
[20]);

1097 
¡d
::
	`sÜt
(
tİli¡
,İli¡ + 40, std::
g»©”
<>());

1100 
FILE
 * 
å
 = 
	`fİ’
(
·¿m‘”_±r
->
	`g‘_·¿m_¡ršg
("fe", "‹¡_»suÉ.txt").
	`c_¡r
(), "at");

1101 
	`årštf
(
å
, "\npagerank„esult\n");

1102 
size_t
 
i
 = 0; i < 20; i++) {

1103 
	`årštf
(
å
, "%lu\t%.9lf\n", 
i
, 
tİli¡
[i]);

1105 
	`årštf
(
å
, "tim¥’ˆ%lf\n\n", 
t
.
	`ruÁime
().
	`couÁ
());

1106 
	`fşo£
(
å
);

1107 
	}
}

1110 
	$maš
(
¬gc
, ** 
¬gv
) {

1111 
·¿m‘”_hªdËr
 
	`·¿m
(
¬gc
, 
¬gv
);

1112 
¡d
::
¡ršg
 
·¿m_®gÜ™hm
 = 
·¿m
.
	`g‘_·¿m_¡ršg
("algorithm", "wcc");

1114 ià(
·¿m_®gÜ™hm
 == "bfs"){

1115 
bfs_®gÜ™hm
 
®g
;

1116 
’gše
 
	`e
(
®g
, 
·¿m
);

1118 
e
.
	`run
();

1120 ià(
·¿m_®gÜ™hm
 == "wcc"){

1121 
wcc_®gÜ™hm
 
®g
;

1122 
’gše
 
	`e
(
®g
, 
·¿m
);

1124 
e
.
	`run
();

1126 ià(
·¿m_®gÜ™hm
 == "undirect_wcc") {

1127 
undœeù_wcc_®gÜ™hm
 
®g
;

1128 
’gše
 
	`e
(
®g
, 
·¿m
);

1130 
e
.
	`run
();

1132 ià(
·¿m_®gÜ™hm
 == "astar") {

1133 
a¡¬_®gÜ™hm
 
®g
;

1134 
’gše
 
	`e
(
®g
, 
·¿m
);

1136 
e
.
	`run
();

1139 ià(
·¿m_®gÜ™hm
 == "pg") {

1140 
pg_®gÜ™hm
 
®g
;

1141 
’gše
 
	`e
(
®g
, 
·¿m
);

1143 
e
.
	`run
();

1145 ià(
·¿m_®gÜ™hm
 == "dfs") {

1146 
dfs_®gÜ™hm
 
®g
;

1147 
’gše
 
	`e
(
®g
, 
·¿m
);

1149 
e
.
	`run
();

1153 
	}
}

	@timer_handler.hpp

1 #iâdeà
__TIMER_HANDLER_HPP__


2 
	#__TIMER_HANDLER_HPP__


	)

4 
	~<chrÚo
>

5 
	~<m­
>

6 
	~<©omic
>

8 
	stime_couÁ
 {

9 
	mtime
;

10 
size_t
 
	mcouÁ
;

12 
time_couÁ
(
_time
) {

13 
	mtime
 = 
_time
;

14 
	mcouÁ
 = 0;

16 }
	ttime_couÁ
;

18 
	stime_’Œy
 {

19 
	m¡d
::
¡ršg
 
tim’ame
;

21 
	m¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t
;

22 
	m¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡İ
;

24 
time_’Œy
(
¡d
::
¡ršg
 
_tim’ame
) {

25 
tim’ame
 = 
_tim’ame
;

28 
¡¬t_time
() {

29 
	m¡¬t
 = 
¡d
::
chrÚo
::
sy¡em_şock
::
now
();

32 
¡İ_time
() {

33 
	m¡İ
 = 
¡d
::
chrÚo
::
sy¡em_şock
::
now
();

36 
	m¡d
::
chrÚo
::
du¿tiÚ
<> 
ruÁime
() {

37  
¡İ
 - 
¡¬t
;

39 }
	ttime_’Œy
;

41 şas 
	ctim”_hªdËr
 {

42 
	m´iv©e
:

43 
¡d
::
m­
<¡d::
¡ršg
, 
	mtime_couÁ
> 
	mtim–i¡
;

44 
	m¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡¬t
;

45 
	m¡d
::
chrÚo
::
sy¡em_şock
::
time_pošt
 
¡İ
;

46 
	m¡d
::
chrÚo
::
du¿tiÚ
<> 
ruÂšg_time
;

47 
	m¡d
::
©omic_æag
 
æag
;

49 
	mpublic
:

50 
	$tim”_hªdËr
() {

51 
æag
.
	`ş—r
();

54 
	$add_’Œy
(
time_’Œy
 
’Œy
) {

55 
æag
.
	`‹¡_ªd_£t
());

57 
¡d
::
m­
<¡d::
¡ršg
, 
time_couÁ
>::
™”©Ü
 
™r
 = 
tim–i¡
.
	`fšd
(
’Œy
.
tim’ame
);

59 ià(
™r
 =ğ
tim–i¡
.
	`’d
()) {

60 
tim–i¡
.
	`š£¹
(
¡d
::
·œ
<¡d::
¡ršg
, 
time_couÁ
>(
’Œy
.
tim’ame
, 
	`time_couÁ
ÓÁry.
	`ruÁime
().
	`couÁ
())));

63 
™r
->
£cÚd
.
time
 +ğ
’Œy
.
	`ruÁime
().
	`couÁ
();

64 
™r
->
£cÚd
.
couÁ
++;

67 
æag
.
	`ş—r
();

68 
	}
}

70 
	$´št_tim–i¡
() {

71 
	`´štf
("timename\ttimevalue\n");

72 
¡d
::
m­
<¡d::
¡ršg
, 
time_couÁ
>::
™”©Ü
 
™r
 = 
tim–i¡
.
	`begš
(); iŒ !ğtim–i¡.
	`’d
(); itr++) {

73 
	`´štf
(" %s\t%lf\t%lu\n", 
™r
->
fœ¡
.
	`c_¡r
(), iŒ->
£cÚd
.
time
, iŒ->£cÚd.
couÁ
);

75 
	}
}

	@trianglecounting.cpp

48 
	~<¡ršg
>

49 
	~<veùÜ
>

55 
	#SUPPORT_DELETIONS
 1

	)

56 
	#GRAPHCHI_DISABLE_COMPRESSION


	)

59 
	~"g¿phchi_basic_šşudes.hµ
"

60 
	~"’gše/dyÇmic_g¿phs/g¿phchi_dyÇmicg¿ph_’gše.hµ
"

61 
	~"’gše/auxd©a/deg»e_d©a.hµ
"

62 
	~"´•roûssšg/ut/Üd”bydeg»e.hµ
"

64 
usšg
 
Çme¥aû
 
	gg¿phchi
;

72 
ušt32_t
 
	tV”‹xD©aTy³
;

73 
ušt32_t
 
	tEdgeD©aTy³
;

79 
şass
 
	gOuutV”‹xC®lback
 : 
public
 
VC®lback
<
V”‹xD©aTy³
> {

80 
public
:

81 
vœtu®
 
ÿÎback
(
vid_t
 
v”‹x_id
, 
V”‹xD©aTy³
 &
v®ue
) {

82 ià(
	gv®ue
 > 0)

83 
	g¡d
::
cout
 << 
v”‹x_id
 << " " << 
v®ue
 << 
¡d
::
’dl
;

91 
	gg¿bbed_edges
 = 0;

95 
šlše
 
boŞ
 
	$fšdadj_lš—r
(
vid_t
 * 
d©achunk
, 
size_t
 
n
, vid_ˆ
rg‘
) {

96 
i
=0; i<()
n
; i++) {

97 ià(
d©achunk
[
i
] =ğ
rg‘
è 
Œue
;

98 ià(
d©achunk
[
i
] > 
rg‘
è 
çl£
;

100  
çl£
;

101 
	}
}

104 
šlše
 
boŞ
 
	$fšdadj
(
vid_t
 * 
d©achunk
, 
size_t
 
n
, vid_ˆ
rg‘
) {

105 ià(
n
<32è 
	`fšdadj_lš—r
(
d©achunk
,‚, 
rg‘
);

106 
size_t
 
lo
 = 0;

107 
size_t
 
hi
 = 
n
;

108 
size_t
 
m
 = 
lo
 + (
hi
-lo)/2;

109 
hi
>
lo
) {

110 
vid_t
 
‘o
 = 
d©achunk
[
m
];

111 ià(
rg‘
 =ğ
‘o
) {

112  
Œue
;

114 ià(
rg‘
 > 
‘o
) {

115 
lo
 = 
m
+1;

117 
hi
 = 
m
;

119 
m
 = 
lo
 + (
hi
-lo)/2;

121  
çl£
;

122 
	}
}

126 
	sd’£_adj
 {

127 
	mcouÁ
;

128 
vid_t
 * 
	madjli¡
;

130 
d’£_adj
(è{ 
	madjli¡
 = 
NULL
; }

131 
d’£_adj
(
_couÁ
, 
vid_t
 * 
_adjli¡
è: 
couÁ
(_couÁ), 
adjli¡
(_adjlist) {

138 şas 
	cadjli¡_cÚš”
 {

139 
	m¡d
::
veùÜ
<
d’£_adj
> 
adjs
;

140 
mu‹x
 
	mm
;

141 
	mpublic
:

142 
vid_t
 
pivÙ_¡
, 
	mpivÙ_’
;

144 
	$adjli¡_cÚš”
() {

145 
pivÙ_¡
 = 0;

146 
pivÙ_’
 = 0;

149 
	$ş—r
() {

150 
¡d
::
veùÜ
<
d’£_adj
>::
™”©Ü
 
™
=
adjs
.
	`begš
(); iˆ!ğadjs.
	`’d
(); ++it) {

151 ià(
™
->
adjli¡
 !ğ
NULL
) {

152 
	`ä“
(
™
->
adjli¡
);

153 
™
->
adjli¡
 = 
NULL
;

156 
adjs
.
	`ş—r
();

157 
pivÙ_¡
 = 
pivÙ_’
;

158 
	}
}

163 
	$ex‹nd_pivÙ¿nge
(
vid_t
 
’
) {

164 
	`as£¹
(
’
>=
pivÙ_’
);

165 
pivÙ_’
 = 
’
;

166 
adjs
.
	`»size
(
pivÙ_’
 - 
pivÙ_¡
);

167 
	}
}

172 
g¿b_adj
(
g¿phchi_v”‹x
<
ušt32_t
, ušt32_t> &
v
) {

173 if(
is_pivÙ
(
v
.
id
())) {

174 
	gncouÁ
 = 
v
.
num_edges
();

176 
	gv
.
sÜt_edges_šdœeù
();

179 
	gaùcouÁ
 = 0;

180 
vid_t
 
	gÏ¡vid
 = 0;

181 
	gi
=0; i<
	gncouÁ
; i++) {

182 ià(
	gv
.
edge
(
i
)->
	gv”‹xid
 > v.
id
(è&& v.edge(i)->v”‹xid !ğ
Ï¡vid
)

183 
aùcouÁ
++;

184 
	gÏ¡vid
 = 
v
.
edge
(
i
)->
v”‹x_id
();

189 
d’£_adj
 
	gdadj
 = d’£_adj(
aùcouÁ
, (
vid_t
*è
ÿÎoc
((vid_t),‡ctcount));

190 
	gaùcouÁ
 = 0;

191 
	gÏ¡vid
 = 0;

192 
	gi
=0; i<
	gncouÁ
; i++) {

193 ià(
	gv
.
edge
(
i
)->
	gv”‹xid
 > v.
id
(è&& v.edge(i)->v”‹xid !ğ
Ï¡vid
) {

194 
dadj
.
adjli¡
[
aùcouÁ
++] = 
v
.
edge
(
i
)->
v”‹x_id
();

196 
	gÏ¡vid
 = 
v
.
edge
(
i
)->
v”‹x_id
();

198 
as£¹
(
dadj
.
couÁ
 =ğ
aùcouÁ
);

199 
	gadjs
[
v
.
id
(è- 
pivÙ_¡
] = 
dadj
;

200 
as£¹
(
v
.
id
(è- 
pivÙ_¡
 < 
adjs
.
size
());

201 
__sync_add_ªd_ãtch
(&
g¿bbed_edges
, 
aùcouÁ
);

202  
	gaùcouÁ
;

207 
	$acouÁ
(
vid_t
 
pivÙ
) {

208  
adjs
[
pivÙ
 - 
pivÙ_¡
].
couÁ
;

209 
	}
}

215 
š‹r£ùiÚ_size
(
g¿phchi_v”‹x
<
ušt32_t
, ušt32_t> &
v
, 
vid_t
 
pivÙ
, 
¡¬t_i
) {

216 
as£¹
(
is_pivÙ
(
pivÙ
));

217 
	gcouÁ
 = 0;

218 ià(
	gpivÙ
 > 
	gv
.
id
()) {

219 
	gd’£_adj
 &
	gdadj
 = 
adjs
[
pivÙ
 - 
pivÙ_¡
];

220 
	gvc
 = 
v
.
num_edges
();

226 ià(
	gdadj
.
	gcouÁ
 < 32 * (
	gvc
 - 
	g¡¬t_i
)) {

228 
as£¹
(
v
.
edge
(
¡¬t_i
)->
v”‹x_id
(è=ğ
pivÙ
);

229 
	gi1
 = 0;

230 
	gi2
 = 
¡¬t_i
+1;

231 
	gÃdges
 = 
v
.
num_edges
();

233 
	gi1
 < 
	gdadj
.
	gcouÁ
 && 
	gi2
 < 
	gÃdges
) {

234 
vid_t
 
	gd¡
 = 
v
.
edge
(
i2
)->
v”‹xid
;

235 
vid_t
 
	ga
 = 
dadj
.
adjli¡
[
i1
];

236 ià(
	ga
 =ğ
d¡
) {

238 
v
.
edge
(
i2
)->
£t_d©a
(v.edge(i2)->
g‘_d©a
() + 1);

239 
	gcouÁ
++;

240 
	gi1
++; 
	gi2
++;

243 
	gi1
 +ğ
a
 < 
d¡
;

244 
	gi2
 +ğ
a
 > 
d¡
;

251 
vid_t
 
	gÏ¡vid
 = 0;

252 
	gi
=
¡¬t_i
+1; i < 
	gvc
; i++) {

253 
vid_t
 
	gnb
 = 
v
.
edge
(
i
)->
v”‹xid
;

254 ià(
	gnb
 > 
	gpivÙ
 &&‚b !ğ
Ï¡vid
) {

255 
m©ch
 = 
fšdadj
(
dadj
.
adjli¡
, dadj.
couÁ
, 
nb
);

256 
	gcouÁ
 +ğ
m©ch
;

257 ià(
	gm©ch
 > 0) {

259 
	gv
.
edge
(
i
)->
£t_d©a
(
v
.edge(i)->
g‘_d©a
() + 1);

262 
	gÏ¡vid
 = 
nb
;

266  
	gcouÁ
;

269 
šlše
 
boŞ
 
	$is_pivÙ
(
vid_t
 
vid
) {

270  
vid
 >ğ
pivÙ_¡
 && vid < 
pivÙ_’
;

271 
	}
}

274 
adjli¡_cÚš”
 * 
	gadjcÚš”
;

282 
	gTrŸngËCouÁšgProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

288 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

290 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

291 
adjcÚš”
->
g¿b_adj
(
v
);

293 
ušt32_t
 
	gŞdcouÁ
 = 
v
.
g‘_d©a
();

294 
ušt32_t
 
	gÃwcouÁs
 = 0;

296 
	gv
.
sÜt_edges_šdœeù
();

298 
vid_t
 
	gÏ¡vid
 = 0;

305 
	gi
=0; i<
	gv
.
num_edges
(); i++) {

306 
	gg¿phchi_edge
<
	gušt32_t
> * 
	ge
 = 
v
.
edge
(
i
);

307 ià(
	ge
->
	gv”‹xid
 > 
	gv
.
id
(è&&ƒ->v”‹xid >ğ
adjcÚš”
->
pivÙ_¡
) {

308 
as£¹
(!
is_d–‘ed_edge_v®ue
(
e
->
g‘_d©a
()));

309 ià(
	ge
->
	gv”‹xid
 !ğ
Ï¡vid
) {

310 ià(
adjcÚš”
->
is_pivÙ
(
e
->
v”‹xid
)) {

311 
ušt32_t
 
pivÙ_ŒŸngË_couÁ
 = 
adjcÚš”
->
š‹r£ùiÚ_size
(
v
, 
e
->
v”‹xid
, 
i
);

312 
	gÃwcouÁs
 +ğ
pivÙ_ŒŸngË_couÁ
;

315 ià(
	gpivÙ_ŒŸngË_couÁ
 =ğ0 && 
e
->
g‘_d©a
() == 0) {

317 
v
.
»move_edge
(
i
);

320 
	ge
->
£t_d©a
(
e
->
g‘_d©a
(è+ 
pivÙ_ŒŸngË_couÁ
);

326 
	gÏ¡vid
 = 
e
->
v”‹xid
;

328 
as£¹
(
ÃwcouÁs
 >= 0);

331 ià(
	gÃwcouÁs
 > 0) {

332 
	gv
.
£t_d©a
(
ŞdcouÁ
 + 
ÃwcouÁs
);

339 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

340 
ÃwcouÁs
 = 0;

342 
	gi
=0; i < 
	gv
.
num_edges
(); i++) {

343 
	gg¿phchi_edge
<
	gušt32_t
> * 
	ge
 = 
v
.
edge
(
i
);

344 ià(
	ge
->
	gv”‹xid
 < 
	gv
.
id
()) {

345 
	gÃwcouÁs
 +ğ
e
->
g‘_d©a
();

346 
	ge
->
£t_d©a
(0);

349 ià(
	gv
.
id
(è< 
	gadjcÚš”
->
	gpivÙ_¡
 && 
	ge
->
	gv”‹xid
 <‡djcontainer->pivot_st) {

350 
	gv
.
»move_edge
(
i
);

354 
	gv
.
£t_d©a
(
v
.
g‘_d©a
(è+ 
ÃwcouÁs
);

362 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

363 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

366 
vid_t
 
i
=
adjcÚš”
->
pivÙ_¡
; 
	gi
 < 
	gadjcÚš”
->
	gpivÙ_’
; i++) {

367 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
, 
Œue
);

369 
	gg¿bbed_edges
 = 0;

370 
	gadjcÚš”
->
ş—r
();

373 
log¡»am
(
LOG_INFO
è<< "Now…ivÙs: " << 
	gadjcÚš”
->
	gpivÙ_¡
 << " " <<‡djcÚš”->
	gpivÙ_’
 << 
	g¡d
::
’dl
;

374 
vid_t
 
	gi
=0; i < 
	ggcÚ‹xt
.
	gnv”tiûs
; i++) {

375 ià(
	gi
 < 
	gadjcÚš”
->
	gpivÙ_’
) {

376 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
, 
Œue
);

386 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

396 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

397 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

398 ià(
adjcÚš”
->
pivÙ_¡
 <ğ
wšdow_’
) {

399 
size_t
 
max_g¿b_edges
 = 
g‘_İtiÚ_lÚg
("membudget_mb", 1024) * 1024 * 1024 / 8;

400 ià(
	gg¿bbed_edges
 < 
	gmax_g¿b_edges
 * 0.8) {

401 
log¡»am
(
LOG_DEBUG
è<< "Wšdow in™, g¿bbed: " << 
	gg¿bbed_edges
 << "ƒdges" << 
	g¡d
::
’dl
;

402 
vid_t
 
	gvid
=
wšdow_¡
; vid <ğ
wšdow_’
; vid++) {

403 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
vid
, 
Œue
);

405 
	gadjcÚš”
->
ex‹nd_pivÙ¿nge
(
wšdow_’
 + 1);

406 ià(
	gwšdow_’
 =ğ
gcÚ‹xt
.
nv”tiûs
) {

408 
gcÚ‹xt
.
£t_Ï¡_™”©iÚ
(gcÚ‹xt.
™”©iÚ
 + 3);

411 
	g¡d
::
cout
 << "ToØmªyƒdges,‡Ì—dy g¿bbed: " << 
g¿bbed_edges
 << 
¡d
::
’dl
;

421 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

429 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

432 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

436 
m‘rics
 
	`m
("triangle-counting");

438 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

439 
n™”s
 = 100000;

440 
boŞ
 
scheduËr
 = 
Œue
;

444 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s_nov®ues
<
EdgeD©aTy³
>(
f’ame
,

445 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

447 ià(
nsh¬ds
 == 1) {

448 
	`log¡»am
(
LOG_FATAL
è<< "TrŸngË couÁšg dÛ nÙ wÜk iÀš-memÜy mode. PËa£ s‘ --nsh¬ds=2" << 
¡d
::
’dl
;

449 
	`ex™
(1);

451 
	`as£¹
(
nsh¬ds
 > 1);

453 
nsh¬ds
 = 
Üd”_by_deg»e
<
EdgeD©aTy³
>(
f’ame
,‚sh¬ds, 
m
);

457 
adjcÚš”
 = 
Ãw
 
	`adjli¡_cÚš”
();

462 
TrŸngËCouÁšgProg¿m
 
´og¿m
;

463 
g¿phchi_dyÇmicg¿ph_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
 + "_degord",

464 
nsh¬ds
, 
scheduËr
, 
m
);

465 
’gše
.
	`£t_’abË_d‘”mši¡ic_·¿Î–ism
(
çl£
);

469 
’gše
.
	`£t_membudg‘_mb
(
¡d
::
	`mš
(
	`g‘_İtiÚ_št
("membudget_mb", 1024), 1024));

470 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

473 
	`m‘rics_»pÜt
(
m
);

476 
size_t
 
ÁrŸngËs
 = 
sum_v”tiûs
<
vid_t
, size_t>(
f’ame
 + "_degÜd", 0, (vid_t)
’gše
.
	`num_v”tiûs
());

477 
¡d
::
cout
 << "Numb” oàŒŸngËs: " << 
ÁrŸngËs
 / 3 << "(" <<‚ŒŸngË << ")" << std::
’dl
;

481 
size_t
 
ex³ùed
 = 
	`g‘_İtiÚ_lÚg
("assertequals", 0);

482 ià(
ex³ùed
 > 0) {

483 
¡d
::
cout
 << "Te¡šgh»suÉ i a ex³ùed: " << (
ÁrŸngËs
 / 3è<< " vs. " << 
ex³ùed
 << std::
’dl
;

484 
	`as£¹
(
ex³ùed
 =ğ
ÁrŸngËs
 / 3);

492 
	}
}

	@wiss_all.hpp

1 
	~<wiss.h
>

2 
	~<wiss_r.h
>

3 
	~<lockquiz.h
>

4 
	~<lockty³.h
>

5 
	~<·ge.h
>

6 
	~<¡_fd.h
>

9 * 
am_”rÜ
(* 
routše
, 
”rÜcode
);

10 * 
am_”rÜmsg
(
”rÜcode
);

11 * 
am_çË¼Ü
(* 
routše
, 
”rÜ
);

13 
am_ü—‹_vŞume
(* 
devÇme
, * 
t™Ë
, 
VŞID
, 
numexts
, 
extsize
);

14 
am_de¡roy_vŞume
(* 
devÇme
);

15 
¡_mouÁ
(* 
devÇme
);

16 
¡_dismouÁ
(* 
devÇme
);

18 
begš_Œªs
();

19 
comm™_Œªs
(
Œªs_id
);

20 
abÜt_Œªs
(
ŒªsId
);

22 
¡_ü—‹fe
(
VŞID
, * 
f’ame
, 
NumPages
, 
Ex‹ÁFlFaùÜ
, 
PageFlFaùÜ
);

23 
¡_de¡royfe
(
VŞID
, * 
f’ame
, 
Œªs_id
, 
lockup
, 
cÚd
);

24 
¡_İ’fe
(
TWO
 
VŞID
, * 
f’ame
, 
mode
);

25 
am_şo£fe
(
f’um
);

26 
¡_»Çme
(
VŞID
, * 
ÃwÇme
, * 
ŞdÇme
, 
Œªs_id
, 
lockup
, 
cÚd
);

28 
¡_f•ages
(
VŞID
, * 
f’ame
);

29 
¡_šdex·ges
(
VŞID
, * 
f’ame
, 
šdexno
);

30 
¡_hash·ges
(
VŞID
, * 
f’ame
, 
šdexno
);

31 
¡_»cÜdÿrd
(
VŞID
, * 
f’ame
);

32 
¡_keyÿrd
(
VŞID
, * 
f’ame
, 
šdexno
);

33 
¡_hashÿrd
(
VŞID
, * 
f’ame
, 
šdexno
);

35 
¡_ü—‹šdex
(
VŞID
, * 
f’ame
, 
TWO
 
šdexno
, 
KEYINFO
 * 
KeyA‰r
, 
FlFaùÜ
, 
ONE
 
Unique
, 
SÜtFe
, 
Œªs_id
, 
lockup
, 
cÚd
);

36 
¡_drİbŒ“
(
VŞID
, * 
f’ame
, 
šdexno
, 
Œªs_id
, 
lockup
, 
cÚd
);

37 
am_İ’šdex
(
VŞID
, * 
f’ame
, 
šdexno
, 
acûssmode
);

38 
¡_š£¹šdex
(
TWO
 
f’um
, 
KEY
 * 
key
, 
RID
 * 
rid±r
, 
Œªs_id
, 
lockup
, 
cÚd
);

39 
¡_d–‘ešdex
(
f’um
, 
KEY
 * 
key
, 
RID
 * 
rid±r
, 
Œªs_id
, 
lockup
, 
cÚd
);

40 
¡_g‘šdex
(
f’um
, 
KEY
 * 
S—rchKey
, 
XCURSOR
 * 
CursÜ
, 
RID
 * 
Fœ¡RID
, 
Œªs_id
, 
lockup
, 
bt_İ”
 
İ”
, 
cÚd
);

42 
¡_ü—‹hash
(
VŞID
, * 
f’ame
, 
hashno
, 
KEYINFO
 * 
KeyA‰r
, 
FlFaùÜ
, 
Unique
, 
Œªs_id
, 
lockup
, 
cÚd
);

43 
¡_de¡royhash
(
VŞID
, * 
f’ame
, 
hashno
, 
Œªs_id
, 
lockup
, 
cÚd
);

44 
¡_İ’hash
(
VŞID
, * 
f’ame
, 
hashno
, 
acûssmode
);

45 
¡_š£¹hash
(
f’um
, 
KEY
 * 
key
, 
RID
 * 
h_rid
, 
Œªs_id
, 
lockup
, 
cÚd
);

46 
¡_d–‘ehash
(
f’um
, 
KEY
 * 
key
, 
RID
 * 
h_rid
, 
Œªs_id
, 
lockup
, 
cÚd
);

47 
¡_g‘hash
(
f’um
, 
KEY
 * 
key
, 
XCURSOR
 * 
CursÜ
, 
RID
 * 
h_rid
, 
Œªs_id
, 
lockup
, 
cÚd
);

48 
¡_Ãxthash
(
f’um
, 
XCURSOR
 * 
CursÜ
, 
RID
 * 
h_rid
, 
Œªs_id
, 
lockup
, 
cÚd
);

50 
am_İ’fesÿn
(
İ’f’um
, 
BOOLEXP
 * 
boŞ—Ãx´
, 
Œªs_id
, 
lockup
, 
LOCKTYPE
 
lockmode
, 
cÚd
);

51 
am_£tsÿn
(
sÿnid
, 
RID
 * 
NewRID
);

53 
am_İ’lÚgsÿn
(
İ’f’um
, 
RID
 * 
rid
, 
Œªs_id
, 
lockup
, 
LOCKTYPE
 
lockmode
, 
cÚd
);

54 
am_£tcursÜ
(
sÿnid
, 
off£t
, 
»loÿtiÚ
);

56 
am_İ’šdexsÿn
(
İ’f’um
, 
šdexf’um
, 
KEYINFO
 * 
šdexkey
, 
KEY
 * 
lb
, KEY * 
ub
, 
BOOLEXP
 * 
boŞ—Ãx´
, 
Œªs_id
, 
lockup
, 
LOCKTYPE
 
lockmode
, 
cÚd
);

57 
am_g‘icursÜ
(
sÿnid
, 
XCURSOR
 * 
XcursÜ
);

58 
am_£tšdexsÿn
(
sÿnid
, 
XCURSOR
 * 
NewXCURSOR
);

60 
am_İ’hashsÿn
(
İ’f’um
, 
hashf’um
, 
KEYINFO
 * 
keyA‰r
, 
KEY
 * 
hashkey
, 
BOOLEXP
 * 
boŞ—Ãx´
, 
Œªs_id
, 
lockup
, 
LOCKTYPE
 
lockmode
, 
cÚd
);

62 
am_»adsÿn
(
sÿnid
, * 
»ÿddr
, 
Ën
);

63 
am_š£¹sÿn
(
sÿnid
, * 
»ÿddr
, 
Ën
, 
RID
 * 
Ãwrid
);

64 
am_d–‘esÿn
(
sÿnid
);

65 
am_upd©esÿn
(
sÿnid
, * 
»ÿdr
, 
Ën
);

66 
am_şo£sÿn
(
sÿnid
);

68 
am_ãtchfœ¡
(
sÿnid
, 
RID
 * 
fœ¡rid
, 
logiÿl_İ
 
ty³
);

69 
am_ãtchÏ¡
(
sÿnid
, 
RID
 * 
Ï¡rid
, 
logiÿl_İ
 
ty³
);

70 
am_ãtchÃxt
(
sÿnid
, 
RID
 * 
ÃxŒid
, 
logiÿl_İ
 
ty³
);

71 
am_ãtch´ev
(
sÿnid
, 
RID
 * 
´evrid
, 
logiÿl_İ
 
ty³
);

73 
¡_fœ¡fe
(
f’um
, 
RID
 * 
fœ¡rid
, 
Œªs_id
, 
lockup
, 
LOCKTYPE
 
mode
, 
cÚd
);

74 
¡_Ãxtfe
(
f’um
, 
RID
 * 
rid±r
, RID * 
ÃxŒid
, 
Œªs_id
, 
lockup
, 
LOCKTYPE
 
mode
, 
cÚd
);

75 
¡_´evfe
(
f’um
, 
RID
 * 
rid±r
, RID * 
´evrid
, 
Œªs_id
, 
lockup
, 
LOCKTYPE
 
mode
, 
cÚd
);

76 
¡_Ï¡fe
(
f’um
, 
RID
 * 
Ï¡rid
, 
Œªs_id
, 
lockup
, 
LOCKTYPE
 
mode
, 
cÚd
);

78 
¡_ü—‹lÚg
(
f’um
, 
RID
 * 
rid±r
, 
Œªs_id
, 
lockup
, 
cÚd
);

79 
¡_de¡roylÚg
(
f’um
, 
RID
 * 
rid±r
, 
Œªs_id
, 
lockup
, 
cÚd
);

80 
am_»adlÚg
(
sÿnid
, * 
»ÿddr
, 
Ëngth
);

81 
am_š£¹lÚg
(
sÿnid
, 
wh”e
, * 
»ÿddr
, 
Ëngth
);

82 
am_d–‘–Úg
(
sÿnid
, 
Ëngth
);

83 
am_upd©–Úg
(
sÿnid
, * 
»ÿddr
, 
Ëngth
);

85 
¡_š£¹»cÜd
(
f’um
, * 
»ÿddr
, 
»ş’
, 
RID
 * 
Ã¬rid
, RID * 
Ãwrid
, 
Œªs_id
, 
lockup
, 
cÚd
);

86 
¡_d–‘”ecÜd
(
f’um
, 
RID
 * 
rid±r
, 
Œªs_id
, 
lockup
, 
cÚd
);

87 
¡_g‘»cÜd
(
f’um
, 
RID
 * 
rid±r
, 
DATAPAGE
 ** 
·g•Œ
, ** 
»ıŒ
, 
Œªs_id
, 
lockup
, 
mode
, 
cÚd
);

88 
¡_»ad»cÜd
(
f’um
, 
RID
 * 
rid±r
, * 
»ÿddr
, 
»ş’
, 
Œªs_id
, 
lockup
, 
LOCKTYPE
 
mode
, 
cÚd
);

89 
¡_wr™”ecÜd
(
f’um
, 
RID
 * 
rid±r
, * 
»ÿddr
, 
»ş’
, 
Œªs_id
, 
lockup
, 
cÚd
);

90 
¡_ex·nd»cÜd
(
f’um
, 
RID
 * 
rid±r
, 
ex·ndamt
, 
Œªs_id
, 
lockup
, 
cÚd
);

91 
¡_­³nd»cÜd
(
f’um
, * 
»ÿddr
, 
»ş’
, 
RID
 * 
Ãwrid
, 
Œªs_id
, 
lockup
, 
cÚd
);

92 
¡_­³ndfe
(
f’um
, * 
»ÿddr
, 
»ş’
, 
RID
 * 
Ãwrid
, 
Œªs_id
, 
lockup
, 
cÚd
);

93 
¡_com·»
(
f’um
, 
RID
 * 
rid±r
, 
»l_İ
 
»ÏtiÚ
, 
FIELDDESC
 * 
f›ld
, * 
cÚ¡ªt
, 
Œªs_id
, 
lockup
, 
cÚd
);

94 
¡_ridcom·»
(
oâ1
, 
RID
 * 
rid±r1
, 
FIELDDESC
 * 
f›ld1
, 
oâ2
, RID * 
rid±r2
, FIELDDESC * 
f›ld2
, * 
»tuºv®ue
, 
Œªs_id
, 
lockup
, 
cÚd
);

97 
¡_pš·ge
(
f’um
, 
PID
 * 
pid±r
, 
DATAPAGE
 ** 
·g•Œ
, 
Œªs_id
, 
lockup
, 
mode
, 
cÚd
);

98 
bf_uÅš·ge
(
f’um
, 
PID
 * 
pid±r
, 
DATAPAGE
 * 
·gebuf
);

99 
¡_»£rv•age
(
f’um
, 
PID
 * 
pid±r
, 
DATAPAGE
 ** 
·g•Œ
, 
Œªs_id
, 
lockup
, 
mode
, 
cÚd
);

100 
bf_»Ëa£·ge
(
f’um
, 
PID
 * 
pid±r
, 
DATAPAGE
 * 
·gebuf
);

101 
¡_ä“size
();

102 
¡_g‘devaddr
(
TWO
 
vŞid
);

103 
¡_g‘»cÜd±r
(
DATAPAGE
 ** 
·g•Œ
, 
¦Ùno
, ** 
»ıŒ
);

105 
bf_»£rve_®loc_·ges
(* 
bËšdex_±r
, ** 
·g•Œ_±r
, 
num_wª‹d_·ges
);

106 
¡_»£rve_lock_·ge
(
f’um
, 
PID
 * 
pid±r
, 
DATAPAGE
 ** 
·g•Œ
, 
Œªs_id
, 
lockup
, 
mode
, 
cÚd
);

108 
¡_­³ndÃwfe
(
f’um
, * 
»ÿddr
, 
»ş’
, 
RID
 * 
Ãwrid
, 
Œªs_id
, 
lockup
, 
cÚd
);

111 
¡_sÜt
(
TWO
 
VŞID
, * 
f’ame
, 
KEYINFO
 * 
keyšfİŒ
, TWO 
suffix
, 
Œªs_id
, 
lockup
, 
cÚd
);

112 
¡_sÜtšto
(
TWO
 
VŞID
, * 
f’ame
, * 
što
, 
KEYINFO
 * 
keyšfİŒ
, TWO 
suffix
, 
Œªs_id
, 
lockup
, 
cÚd
);

116 
wiss_š™
();

117 
wiss_lock_fe
(
ŒªsId
, 
İ’f’um
, 
lockMode
, 
du¿tiÚ
, 
cÚd
);

118 
wiss_fš®
();

	@wiss_handler.hpp

1 #iâdeà
__WISS_HANDLER_HPP__


2 
	#__WISS_HANDLER_HPP__


	)

4 
	~<wiss_®l.hµ
>

5 
	~<funùiÚ®
>

6 
	~<®gÜ™hm
>

7 
	~<s¡»am
>

9 
	#CHECKERR
(
p
,
c
èif(()(c)<0è
	`çË¼Ü
Õ,()(c))

	)

10 
	#BUFFERSIZE
 100

	)

12 şas 
	cwiss_hªdËr
 {

13 
	m´iv©e
:

14 
¡d
::
¡ršg
 
vŞume_Çme
;

15 
	m¡d
::
¡ršg
 
»ÏtiÚ_Çme
;

17 
TWO
 
	mvŞume_id
;

18 
	mdevaddr
;

19 
	m»ÏtiÚ_desütÜ
;

21 
	mŒªsId
;

23 
	m”rÜ
;

25 
	mpublic
:

26 
	$wiss_hªdËr
() {

29 ~
	$wiss_hªdËr
() {

30 
	}
}

34 
¡d
::
¡ršg
 
	$f’ame_g¿phšfo
() {

35 
¡d
::
¡ršg¡»am
 
ss
;

36 
ss
 << 
»ÏtiÚ_Çme
;

37 
ss
 << ".graphinfo";

38  
ss
.
	`¡r
();

39 
	}
}

41 
	g¡d
::
¡ršg
 
	$f’ame_g¿phšdex
() {

42 
¡d
::
¡ršg¡»am
 
ss
;

43 
ss
 << 
»ÏtiÚ_Çme
;

44 
ss
 << ".graphindex";

45  
ss
.
	`¡r
();

46 
	}
}

50 
	$š™Ÿlize_wiss
() {

51 
	`wiss_š™
();

52 
	}
}

54 
	$fš®ize_wiss
() {

55 
	`wiss_fš®
();

56 
	}
}

58 
	$mouÁ_vŞume
(
¡d
::
¡ršg
 
_vŞume_Çme
) {

59 
vŞume_Çme
 = 
_vŞume_Çme
;

61 
vŞume_id
 = 
	`wiss_mouÁ
((*)
vŞume_Çme
.
	`c_¡r
());

62 
	`CHECKERR
("lßd/wiss_mouÁ", 
vŞume_id
);

64 
ŒªsId
 = 
	`begš_Œªs
();

65 
	`´štf
("Ãw¿n§ùiÚ id = %d\n", 
ŒªsId
);

67 
devaddr
 = 
	`wiss_g‘devaddr
(
vŞume_id
);

68 
	}
}

70 
	$dismouÁ_vŞume
() {

72 
”rÜ
 = 
	`comm™_Œªs
(
ŒªsId
);

73 ià(
”rÜ
 != 1)

74 
	`´štf
("”rÜ stu »tuº from comm™_Œª ğ%d\n", 
”rÜ
);

75 
	`´štf
("commit ok\n");

77 
”rÜ
 = 
	`wiss_dismouÁ
((*)
vŞume_Çme
.
	`c_¡r
());

78 
	`CHECKERR
("lßd/wiss_dismouÁ", 
”rÜ
);

79 
	}
}

81 
	$İ’_fe
(
¡d
::
¡ršg
 
_»ÏtiÚ_Çme
) {

82 
»ÏtiÚ_Çme
 = 
_»ÏtiÚ_Çme
;

84 
»ÏtiÚ_desütÜ
 = 
	`wiss_İ’fe
(
vŞume_id
, (*)
»ÏtiÚ_Çme
.
	`c_¡r
(), 
READ
);

85 
	`CHECKERR
("lßd/wiss_İ’fe", 
»ÏtiÚ_desütÜ
);

87 
”rÜ
 = 
	`wiss_lock_fe
(
ŒªsId
, 
»ÏtiÚ_desütÜ
, 
l_S
, 
COMMIT
, 
FALSE
);

88 
	`CHECKERR
("bud/wiss_lock_fe", 
”rÜ
);

89 
	}
}

91 
	$şo£_fe
() {

92 
”rÜ
 = 
	`wiss_şo£fe
(
»ÏtiÚ_desütÜ
);

93 
	`CHECKERR
("lßd/wiss_şo£fe", 
”rÜ
);

94 
	}
}

99 
	$pš_·ge
(
·ge_id
, ** 
±r
) {

100 
PID
 
pid
 = { 
·ge_id
, 
vŞume_id
 };

102 
	`CHECKERR
("lßd/wiss_pš·ge", 
	`wiss_pš·ge
(
»ÏtiÚ_desütÜ
, &
pid
, (
DATAPAGE
 **)
±r
, 
ŒªsId
, 
FALSE
, 
l_S
, FALSE));

103 
	}
}

106 
	$uÅš_·ge
(
·ge_id
, * 
±r
) {

107 
PID
 
pid
 = { 
·ge_id
, 
vŞume_id
 };

109 
	`CHECKERR
("lßd/wiss_uÅš·ge", 
	`wiss_uÅš·ge
(
»ÏtiÚ_desütÜ
, &
pid
, (
DATAPAGE
 *)
±r
));

110 
	}
}

113 
	$»£rve_®loc_·ges
(* 
bËšdex_±r
, ** 
·g•Œ_±r
, 
num_wª‹d_·ges
) {

114 
num_acquœed
 = 
	`wiss_»£rve_®loc_·ges
(
bËšdex_±r
, 
·g•Œ_±r
, 
num_wª‹d_·ges
);

116 
	`CHECKERR
("lßd/wiss_»£rve_®loıages", 
num_acquœed
);

118  
num_acquœed
;

119 
	}
}

122 
	$»£rve_lock_·ge
(
·ge_id
, ** 
±r
) {

123 
PID
 
pid
 = { 
·ge_id
, 
vŞume_id
 };

125 
	`CHECKERR
("lßd/wiss_»£rve_lock_·ge", 
	`wiss_»£rve_lock_·ge
(
»ÏtiÚ_desütÜ
, &
pid
, (
DATAPAGE
 **)
±r
, 
ŒªsId
, 
FALSE
, 
l_S
, FALSE));

126 
	}
}

129 
	$»£rve_·ge
(
·ge_id
, ** 
±r
) {

130 
PID
 
pid
 = { 
·ge_id
, 
vŞume_id
 };

132 
	`CHECKERR
("lßd/wiss_»£rv•age", 
	`wiss_»£rv•age
(
»ÏtiÚ_desütÜ
, &
pid
, (
DATAPAGE
 **)
±r
, 
ŒªsId
, 
FALSE
, 
l_S
, FALSE));

133 
	}
}

136 
	$»Ëa£_·ge
(
·ge_id
, * 
±r
) {

137 
PID
 
pid
 = { 
·ge_id
, 
vŞume_id
 };

139 
	`CHECKERR
("lßd/wiss_»Ëa£·ge", 
	`wiss_»Ëa£·ge
(
»ÏtiÚ_desütÜ
, &
pid
, (
DATAPAGE
 *)
±r
));

140 
	}
}

143 
	$g‘_»cÜd
(* 
·ge_±r
, 
¦Ù_no
, ** 
»ıŒ
) {

144 
Ëngth
 = 
	`wiss_g‘»cÜd±r
((
DATAPAGE
 **)&
·ge_±r
, 
¦Ù_no
, 
»ıŒ
);

145 
	`CHECKERR
("»ad/wiss_g‘»cÜd±r", 
Ëngth
);

147  
Ëngth
;

148 
	}
}

152 
	$g‘_ä“size
() {

153  
	`wiss_ä“size
();

154 
	}
}

156 
	$g‘_vŞume_id
() {

157  
vŞume_id
;

158 
	}
}

160 
	$g‘_devaddr
() {

161  
devaddr
;

162 
	}
}

166 
	$çË¼Ü
(
¡d
::
¡ršg
 
p
, 
e
)

168 
	`´štf
("fatalƒrror. first‡bortheransaction\n");

169 
	`wiss_abÜt_Œªs
(
ŒªsId
);

170 
	`´štf
("”rÜcod%d\n", 
e
);

172 ()
	`wiss_dismouÁ
((*)
vŞume_Çme
.
	`c_¡r
());

174 
	`wiss_fš®
();

176 
	`wiss_çË¼Ü
((*)
p
.
	`c_¡r
(), ()
e
);

177 
	}
}

181 
	$´•roûssšg
(
¡d
::
¡ršg
 
vŞum’ame
, std::¡ršg 
f’ame
, std::¡ršg 
d©ªame
) {

182 *
»Êame
 = (*)
f’ame
.
	`c_¡r
();

184 
maxd©a_by‹
 = 
PAGESIZE
 - 
DPFIXED
 - 12;

185 
maxd©a_štsize
 = 
maxd©a_by‹
 / (
EDGETYPE
) - 2;

186 
maxd©a_štby‹
 = 
maxd©a_štsize
 * (
EDGETYPE
);

188 
e
, 
f1
;

189 
RID
 
rid
;

190 
·g’um
 = 0, 
maxvid
 = -1;

192 
cu¼’t
;

194 
	`mouÁ_vŞume
(
vŞum’ame
);

197 ()
	`wiss_de¡royfe
(
vŞume_id
, 
»Êame
, 
ŒªsId
, 
FALSE
, FALSE);

203 
e
 = 
	`wiss_ü—‹fe
(
vŞume_id
, 
»Êame
, 30, 100, 100);

204 
	`´štf
("»tuº from c»©ef=%d\n", 
e
);

205 
	`CHECKERR
("lßd/wiss_ü—‹fe", 
e
);

209 
cu¼’t
 = 1;

211 
f1
 = 
	`wiss_İ’fe
(
vŞume_id
, 
»Êame
, 
WRITE
);

212 
	`CHECKERR
("lßd/wiss_İ’fe", 
f1
);

214 
e
 = 
	`wiss_lock_fe
(
ŒªsId
, 
f1
, 
l_IX
, 
COMMIT
, 
FALSE
);

215 
	`CHECKERR
("bud/wiss_lock_fe", 
e
);

217 
»ÏtiÚ_Çme
 = 
f’ame
;

219 
FILE
 * 
å
 = 
	`fİ’
(
d©ªame
.
	`c_¡r
(), "rt");

220 
FILE
 * 
åbË
 = 
	`fİ’
(
	`f’ame_g¿phšdex
().
	`c_¡r
(), "wb");

222 
EDGETYPE
 * 
d©a
 = 
Ãw
 EDGETYPE[
maxd©a_štsize
];

223 
´ev_¤cvid
 = 0;

224 
cu¼_¤cvid
 = 0;

225 
»maš_Ëngth
;

226 
»cÜd_size
;

228 
boŞ
 
´ev_ldi
;

229 
boŞ
 
cu¼_ldi
 = 
çl£
;

231 * 
šdex
 = 
Ãw
 [
maxd©a_štsize
];

232 
šdex_tİ
 = 0;

234 
Œue
)

236 
´ev_¤cvid
 = 
cu¼_¤cvid
;

237 
	`ä—d
(&
cu¼_¤cvid
, (), 1, 
å
);

238 
	`ä—d
(&
»maš_Ëngth
, (), 1, 
å
);

240 ià(
	`ãof
(
å
)) ;

242 
´ev_ldi
 = 
cu¼_ldi
;

243 
cu¼_ldi
 = 
»maš_Ëngth
 > 
maxd©a_štsize
;

245 ià(
cu¼_¤cvid
 > 
maxvid
) maxvid = curr_srcvid;

248 
»cÜd_size
 = 
»maš_Ëngth
 > 
maxd©a_štsize
 ? maxdata_intsize :„emain_length;

250 
i
 = 0; i < 
»cÜd_size
; i++) {

251 
	`ä—d
(&
d©a
[
i
], (
EDGETYPE
), 1, 
å
);

254 ià(
»cÜd_size
 > 0) {

255 
¡d
::
	`sÜt
(
d©a
, d©¨+ 
»cÜd_size
, 
Ëss_edge
);

257 ià(
maxvid
 < 
	`g‘_node_id
(
d©a
[
»cÜd_size
 - 1])) maxvid = get_node_id(data[record_size - 1]);

260 ià(
´ev_ldi
 =ğ
Œue
) {

261 
e
 = 
	`wiss_­³ndÃwfe
(
f1
, (*)
d©a
, 
»cÜd_size
 * (
EDGETYPE
), &
rid
, 
ŒªsId
, 
TRUE
, 
FALSE
);

262 
	`CHECKERR
("lßd/wiss_­³ndfe", 
e
);

264 
´ev_ldi
 = 
çl£
;

267 
e
 = 
	`wiss_­³ndfe
(
f1
, (*)
d©a
, 
»cÜd_size
 * (
EDGETYPE
), &
rid
, 
ŒªsId
, 
TRUE
, 
FALSE
);

268 
	`CHECKERR
("lßd/wiss_­³ndfe", 
e
);

271 ià(
rid
.
R¦Ù
 == 0) {

272 ià(
·g’um
 != 0) {

273 
šdex
[
šdex_tİ
++] = 
´ev_¤cvid
;

274 
´ev_¤cvid
 = 
cu¼_¤cvid
;

276 ià(
šdex_tİ
 + 3 > 
maxd©a_štsize
) {

277 
	`fwr™e
(
šdex
, (), 
šdex_tİ
, 
åbË
);

278 
šdex_tİ
 = 0;

282 
·g’um
++;

283 
šdex
[
šdex_tİ
++] = 
rid
.
R·ge
;

284 
šdex
[
šdex_tİ
++] = 
cu¼_¤cvid
;

287 
»maš_Ëngth
 =„emaš_Ëngth - 
»cÜd_size
;

288 } 
»maš_Ëngth
 > 0);

290 ià(
e
 < 
eNOERROR
)

292 
	`´štf
("%dƒ¼Ü„‘uº from‡µ’dfe\n", 
e
);

296 ià((
cu¼’t
 % 10000) == 0)

297 
	`´štf
("TÙ® # oàtu¶e wr™‹Àğ%d\n", 
cu¼’t
);

299 
cu¼’t
++;

302 
šdex
[
šdex_tİ
++] = 
´ev_¤cvid
;

303 
	`fwr™e
(
šdex
, (), 
šdex_tİ
, 
åbË
);

305 
	`fşo£
(
åbË
);

306 
	`fşo£
(
å
);

308 
d–‘e
 
d©a
;

309 
d–‘e
 
šdex
;

311 
e
 = 
	`wiss_şo£fe
(
f1
);

312 
	`CHECKERR
("lßd/wiss_şo£fe", 
e
);

313 
	`´štf
("closefile completed\n");

315 
maxvid
++;

317 
FILE
 * 
åšfo
 = 
	`fİ’
(
	`f’ame_g¿phšfo
().
	`c_¡r
(), "wb");

319 
	`fwr™e
(&
·g’um
, (), 1, 
åšfo
);

320 
	`fwr™e
(&
maxvid
, (), 1, 
åšfo
);

322 
	`fşo£
(
åšfo
);

324 
	`dismouÁ_vŞume
();

325 
	}
}

	@
1
.
0
13
231
algorithm_handler.hpp
attribute_handler.hpp
bitarray_handler.hpp
engine.hpp
index_handler.hpp
information_handler.hpp
parameter_handler.hpp
template.cpp
test.cpp
timer_handler.hpp
trianglecounting.cpp
wiss_all.hpp
wiss_handler.hpp
